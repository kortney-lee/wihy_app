{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{BrowserRouter as Router,Routes,Route,useSearchParams,useNavigate,useLocation}from'react-router-dom';import VHealthSearch from'./components/search/VHealthSearch';import SearchResults from'./components/search/SearchResults';import TestChartsPage from'./pages/TestChartsPage';import{wihyAPI}from'./services/wihyAPI';import{searchCache}from'./services/searchCache';import{fetchNewsFeed,refreshNewsFeed,searchNewsArticles}from'./services/newsService';import{logger}from'./utils/logger';import'./styles/VHealthSearch.css';import'./index.css';import{API_CONFIG}from'./config/apiConfig';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_BASE_URL=API_CONFIG.WIHY_API_URL;// Use the ml.wihy.ai endpoint\nexport const searchFoodDatabase=async query=>{try{logger.apiRequest('Food Database Search',{query});const response=await fetch(\"\".concat(API_BASE_URL,\"/api/food/search?q=\").concat(encodeURIComponent(query)),{method:'GET',headers:{'Content-Type':'application/json'}});if(!response.ok){throw new Error(\"HTTP error! status: \".concat(response.status));}const data=await response.json();logger.apiResponse('Food Database Search',data);return data;}catch(error){console.error('Food database API error:',error);throw error;}};export const foodAPI={searchFood:searchFoodDatabase};// Export news API for use in other components\nexport const newsAPI={fetchNewsFeed,refreshNewsFeed,searchNewsArticles};const ResultsPage=()=>{const[searchParams]=useSearchParams();const navigate=useNavigate();const location=useLocation();const query=searchParams.get('q')||'';const isHealthNews=searchParams.get('type')==='health_news';const category=searchParams.get('category')||'all';const[isLoading,setIsLoading]=useState(false);const[results,setResults]=useState('');const[dataSource,setDataSource]=useState(\"local\");const[citations,setCitations]=useState([]);const[recommendations,setRecommendations]=useState([]);const[disclaimer,setDisclaimer]=useState('');const[apiResponse,setApiResponse]=useState(null);// Track if this is initial load to prevent loading spinner on browser navigation\nconst[isInitialLoad,setIsInitialLoad]=useState(true);// Add ref to prevent duplicate API calls\nconst lastProcessedQuery=useRef('');const isProcessing=useRef(false);// Detect browser navigation type\nconst isBrowserNavigation=()=>{var _performance,_performance$getEntri,_performance$getEntri2;const navigation=(_performance=window.performance)===null||_performance===void 0?void 0:(_performance$getEntri=_performance.getEntriesByType)===null||_performance$getEntri===void 0?void 0:(_performance$getEntri2=_performance$getEntri.call(_performance,'navigation'))===null||_performance$getEntri2===void 0?void 0:_performance$getEntri2[0];return(navigation===null||navigation===void 0?void 0:navigation.type)==='back_forward';};// Fetch results when query changes\nuseEffect(()=>{const fetchResults=async()=>{if(!query&&!isHealthNews){setIsLoading(false);return;}// Create cache key based on type\nconst cacheKey=isHealthNews?\"health_news_\".concat(category):query;// Check if we have fresh data from navigation (e.g., from Header search)\nconst navigationState=location.state;logger.debug('üîç ResultsPage: Checking navigation state',{hasNavigationState:!!navigationState,fromSearch:navigationState===null||navigationState===void 0?void 0:navigationState.fromSearch,hasResults:!!(navigationState!==null&&navigationState!==void 0&&navigationState.results),hasApiResponse:!!(navigationState!==null&&navigationState!==void 0&&navigationState.apiResponse),query:query,cacheKey:cacheKey});if(navigationState!==null&&navigationState!==void 0&&navigationState.fromSearch&&navigationState!==null&&navigationState!==void 0&&navigationState.results){// üîç RESULTS PAGE LOGGING: Navigation state received\nconsole.log('üîç RESULTS PAGE NAVIGATION:',{query:query,timestamp:new Date().toISOString(),fromSearch:navigationState.fromSearch,dataSource:navigationState.dataSource,hasResults:!!navigationState.results,hasApiResponse:!!navigationState.apiResponse,resultType:typeof navigationState.results,component:'App.tsx',action:'navigationStateReceived'});logger.info('üîç ResultsPage: Using navigation state data (no API call needed)',{query,cacheKey});// Show \"Analyzing with AI...\" briefly for user feedback, then display results\nsetIsLoading(true);// Small delay to ensure users see the \"Analyzing with AI...\" feedback\nsetTimeout(()=>{var _navigationState$resu,_navigationState$resu2;setResults(navigationState.results.details||navigationState.results.summary||'No results');setApiResponse(navigationState.apiResponse||null);// Set the API response for ChatWidget (may be null for cached data)\nsetDataSource(navigationState.dataSource||'wihy');setCitations(navigationState.results.sources||[]);setRecommendations(navigationState.results.recommendations||[]);setDisclaimer(navigationState.results.medicalDisclaimer||'');setIsLoading(false);// üîç RESULTS PAGE LOGGING: State updated\nconsole.log('üîç RESULTS PAGE STATE UPDATED:',{query:query,timestamp:new Date().toISOString(),isLoading:false,dataSource:navigationState.dataSource||'wihy',hasCitations:!!((_navigationState$resu=navigationState.results.sources)!==null&&_navigationState$resu!==void 0&&_navigationState$resu.length),hasRecommendations:!!((_navigationState$resu2=navigationState.results.recommendations)!==null&&_navigationState$resu2!==void 0&&_navigationState$resu2.length),hasDisclaimer:!!navigationState.results.medicalDisclaimer,resultLength:(navigationState.results.details||navigationState.results.summary||'').length});},800);// Short delay to show \"Analyzing with AI...\" feedback\nreturn;}// Prevent duplicate processing\nif(isProcessing.current||lastProcessedQuery.current===cacheKey){logger.debug('Skipping duplicate query',{cacheKey});return;}logger.debug('Processing new query',{cacheKey});lastProcessedQuery.current=cacheKey;isProcessing.current=true;logger.debug('Query type analysis',{isHealthNews,isBrowserNavigation:isBrowserNavigation()});// Always check cache first - especially for browser navigation\nconst cachedResult=searchCache.getCachedResult(cacheKey);if(cachedResult){logger.cache('Using cached results',{cacheKey});setResults(cachedResult);setDataSource('local');setIsLoading(false);setCitations([]);setRecommendations([]);setDisclaimer('');setIsInitialLoad(false);isProcessing.current=false;// Reset processing flag\nreturn;// Exit early - no API calls needed\n}// If this is browser navigation and no cache, show placeholder content instead of redirecting\nif(isBrowserNavigation()||!isInitialLoad){logger.debug('Browser navigation detected with no cache - showing placeholder content');setResults('Please perform a new search to see results.');setDataSource('local');setIsLoading(false);setCitations([]);setRecommendations([]);setDisclaimer('');setIsInitialLoad(false);isProcessing.current=false;// Reset processing flag\nreturn;}// Only show loading for genuine new searches (not browser navigation)\nsetIsLoading(true);try{// Use WiHy Unified API for all types of searches\nlogger.apiRequest('WiHy Unified API',{type:isHealthNews?'health_news':'search',query:query||\"health news - \".concat(category)});let wihyResult;if(isHealthNews){// Handle health news requests\nlogger.debug('Fetching health news via WiHy API');const categories=category==='all'?[]:[category];wihyResult=await wihyAPI.getHealthNews(categories,6);}else{// Handle regular search queries (health, nutrition, etc.)\nlogger.debug('Making WiHy API call for query',{query});wihyResult=await wihyAPI.searchHealth(query);}logger.apiResponse('WiHy API result',wihyResult);if(wihyResult.success){const formattedResult=wihyAPI.formatWihyResponse(wihyResult);setResults(formattedResult);setDataSource(\"wihy\");setApiResponse(wihyResult);// Store the original API response\n// Cache the WiHy results (still cache the formatted result for legacy compatibility)\nsearchCache.setCachedResult(cacheKey,formattedResult,window.location.href);setCitations(wihyAPI.extractCitations(wihyResult));setRecommendations(wihyAPI.extractRecommendations(wihyResult));if(isHealthNews){setDisclaimer('Health news provided by WiHy AI. Always consult healthcare professionals for medical advice.');}else{setDisclaimer('This guidance is based on evidence-based health principles. Always consult healthcare professionals for personalized medical advice.');}}else{// Fallback: If WiHy fails, try legacy APIs\nlogger.warn('WiHy API failed, trying fallback methods');await handleFallbackAPIs();}}catch(error){logger.error(\"WiHy API error:\",error);// Try fallback APIs if WiHy fails\ntry{await handleFallbackAPIs();}catch(fallbackError){logger.error(\"All APIs failed:\",fallbackError);// Check for specific error types\nconst errorMessage=error.message||'';const fallbackErrorMessage=fallbackError.message||'';let userFriendlyMessage;if(errorMessage.includes('CORS_ERROR')){userFriendlyMessage=\"Oops! There's a configuration issue preventing us from reaching our AI services. üîß Our team is working on it - please try again later!\";}else if(errorMessage.includes('NETWORK_ERROR')||errorMessage.includes('TIMEOUT_ERROR')){userFriendlyMessage=\"Oops! Looks like we're having some technical difficulties. ü§ñ Please come back in a few minutes while we fix things up!\";}else if(errorMessage.includes('SERVER_ERROR')){userFriendlyMessage=\"Our servers are taking a quick break! ‚òï Please try again in a few minutes.\";}else if(fallbackErrorMessage.includes('fetch')||fallbackErrorMessage.includes('network')||error.name==='TypeError'){userFriendlyMessage=\"Looks like there's a connection hiccup! üì° Please check your internet and try again.\";}else{userFriendlyMessage=\"Sorry, we're experiencing some issues right now. \\n\\n\\uD83C\\uDFE0 You can still use these features:\\n\\u2022  Browse health news (click \\\"I'm Feeling Healthy\\\") \\n\\u2022 \\uD83D\\uDCF7 Upload images for basic analysis\\n\\u2022 \\uD83D\\uDD0D Try visiting /test to see chart examples\\n\\u2022 \\uD83D\\uDCCA View charts in search results sidebar\\n\\nPlease try your search again in a moment! \\uD83D\\uDE05\";}setResults(userFriendlyMessage);setDataSource(\"error\");setCitations([]);setRecommendations([]);setDisclaimer('If this issue persists, please try refreshing the page or contact support.');}}finally{setIsLoading(false);setIsInitialLoad(false);isProcessing.current=false;// Always reset processing flag\n}};// Fallback function for legacy APIs\nconst handleFallbackAPIs=async()=>{if(isHealthNews){logger.debug('Fallback: Fetching health news via newsService');const healthNewsResult=await fetchNewsFeed([category],6);if(healthNewsResult.success&&healthNewsResult.articles){logger.info('Health news fetched successfully');// Format the news articles for display\nconst formattedNews=formatNewsArticles(healthNewsResult.articles);setResults(formattedNews);setDataSource('openai');// Use openai as the display source\n// Cache the health news results\nconst newsKey=\"health_news_\".concat(category);searchCache.setCachedResult(newsKey,formattedNews,window.location.href);setDisclaimer('Health news provided by AI. Always consult healthcare professionals for medical advice.');}else{throw new Error('Failed to fetch health news');}}else{// Try nutrition database for food-related queries\ntry{logger.debug('Fallback: Trying nutrition database');logger.debug('API URL',{url:\"\".concat(API_BASE_URL,\"/api/search/food?q=\").concat(encodeURIComponent(query))});const nutritionResponse=await fetch(\"\".concat(API_BASE_URL,\"/api/search/food?q=\").concat(encodeURIComponent(query)));if(nutritionResponse.ok){const nutritionData=await nutritionResponse.json();logger.apiResponse('Nutrition API',nutritionData);if(nutritionData&&nutritionData.found===true){logger.info('Found nutrition data - using vnutrition source');const resultString=JSON.stringify(nutritionData);setResults(resultString);setDataSource('vnutrition');// Cache the nutrition results\nsearchCache.setCachedResult(query,resultString,window.location.href);return;}}}catch(nutritionError){logger.debug('Nutrition API also failed',{error:nutritionError});}throw new Error('All fallback APIs failed');}};fetchResults();},[query,isHealthNews,category,location.state]);// Added location.state to dependencies\n// Function to format news articles for display\nconst formatNewsArticles=articles=>{let formatted='# Latest Health News\\n\\n';articles.forEach((article,index)=>{formatted+=\"## \".concat(article.title,\"\\n\\n\");formatted+=\"**Source:** \".concat(article.source,\" (\").concat(article.domain,\")\\n\");formatted+=\"**Category:** \".concat(article.category,\"\\n\");formatted+=\"**Published:** \".concat(new Date(article.publishedDate).toLocaleDateString(),\"\\n\");formatted+=\"**Relevance:** \".concat(Math.round(article.relevanceScore*100),\"%\\n\\n\");formatted+=\"\".concat(article.summary,\"\\n\\n\");if(article.tags&&article.tags.length>0){formatted+=\"**Tags:** \".concat(article.tags.join(', '),\"\\n\\n\");}formatted+=\"[Read Full Article](\".concat(article.url,\")\\n\\n\");formatted+='---\\n\\n';});return formatted;};const handleBackToSearch=()=>{navigate('/');};const handleNewSearch=newQuery=>{if(newQuery!==query){// Reset the initial load flag for new searches\nsetIsInitialLoad(true);navigate(\"/results?q=\".concat(encodeURIComponent(newQuery)));}};return/*#__PURE__*/_jsx(SearchResults,{query:isHealthNews?'Latest Health News':query,results:results,onBackToSearch:handleBackToSearch,onNewSearch:handleNewSearch,isLoading:isLoading,dataSource:dataSource,citations:citations,recommendations:recommendations,disclaimer:disclaimer,apiResponse:apiResponse});};// Demo component for development - shows results without API calls\nconst DemoResultsPage=()=>{const sampleQuery=\"Is quinoa healthy?\";const sampleResponse=\"# Comprehensive Health Analysis: Quinoa\\n\\n**Overview:**\\nQuinoa is a nutrient-dense pseudocereal that offers exceptional health benefits. Originally cultivated in the Andes mountains, this superfood has gained worldwide recognition for its complete protein profile and versatility.\\n\\n**Key Health Benefits:**\\n\\u2022 **Complete Protein**: Contains all 9 essential amino acids\\n\\u2022 **High Fiber**: Supports digestive health and blood sugar regulation  \\n\\u2022 **Rich in Minerals**: Excellent source of iron, magnesium, and phosphorus\\n\\u2022 **Gluten-Free**: Safe for those with celiac disease or gluten sensitivity\\n\\u2022 **Low Glycemic Index**: Helps maintain stable blood sugar levels\\n\\n**Nutritional Highlights:**\\n- 8g protein per cooked cup\\n- 5g fiber per serving\\n- Rich in folate, manganese, and antioxidants\\n- Contains heart-healthy monounsaturated fats\\n\\n**Recommendations:**\\n\\u2713 Rinse quinoa before cooking to remove bitter saponins\\n\\u2713 Toast dry quinoa for enhanced nutty flavor\\n\\u2713 Use as a base for salads, bowls, or as a rice substitute\\n\\u2713 Combine with vegetables and healthy fats for optimal nutrition\\n\\nThis analysis is based on peer-reviewed nutritional research and USDA food composition data.\";const sampleApiResponse={success:true,data:{ai_response:{response:sampleResponse},confidence_score:0.92,charts:{nutrition_breakdown:{carbohydrates:39,protein:22,fat:16,fiber:12,minerals:11},health_quality:{chart_type:\"dual_quality\",labels:[\"Food Quality\",\"Research Quality\"],values:[92,88]}}}};return/*#__PURE__*/_jsx(SearchResults,{query:sampleQuery,results:sampleResponse,onBackToSearch:()=>window.location.href='/',onNewSearch:query=>console.log('Demo search:',query),isLoading:false,dataSource:\"local\",citations:['Journal of Nutrition (2024)','USDA Food Database','American Heart Association'],recommendations:['Consult with healthcare professionals for personalized advice','Consider individual dietary restrictions and allergies','Follow evidence-based nutritional guidelines'],disclaimer:\"This is demo data for development purposes. Always consult healthcare professionals for real medical advice.\",apiResponse:sampleApiResponse});};const App=()=>{logger.debug(\"App component rendered\");return/*#__PURE__*/_jsx(Router,{children:/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(VHealthSearch,{})}),/*#__PURE__*/_jsx(Route,{path:\"/results\",element:/*#__PURE__*/_jsx(ResultsPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/test\",element:/*#__PURE__*/_jsx(TestChartsPage,{})}),process.env.NODE_ENV==='development'&&/*#__PURE__*/_jsx(Route,{path:\"/demo\",element:/*#__PURE__*/_jsx(DemoResultsPage,{})})]})});};export default App;","map":{"version":3,"names":["React","useState","useEffect","useRef","BrowserRouter","Router","Routes","Route","useSearchParams","useNavigate","useLocation","VHealthSearch","SearchResults","TestChartsPage","wihyAPI","searchCache","fetchNewsFeed","refreshNewsFeed","searchNewsArticles","logger","API_CONFIG","jsx","_jsx","jsxs","_jsxs","API_BASE_URL","WIHY_API_URL","searchFoodDatabase","query","apiRequest","response","fetch","concat","encodeURIComponent","method","headers","ok","Error","status","data","json","apiResponse","error","console","foodAPI","searchFood","newsAPI","ResultsPage","searchParams","navigate","location","get","isHealthNews","category","isLoading","setIsLoading","results","setResults","dataSource","setDataSource","citations","setCitations","recommendations","setRecommendations","disclaimer","setDisclaimer","setApiResponse","isInitialLoad","setIsInitialLoad","lastProcessedQuery","isProcessing","isBrowserNavigation","_performance","_performance$getEntri","_performance$getEntri2","navigation","window","performance","getEntriesByType","call","type","fetchResults","cacheKey","navigationState","state","debug","hasNavigationState","fromSearch","hasResults","hasApiResponse","log","timestamp","Date","toISOString","resultType","component","action","info","setTimeout","_navigationState$resu","_navigationState$resu2","details","summary","sources","medicalDisclaimer","hasCitations","length","hasRecommendations","hasDisclaimer","resultLength","current","cachedResult","getCachedResult","cache","wihyResult","categories","getHealthNews","searchHealth","success","formattedResult","formatWihyResponse","setCachedResult","href","extractCitations","extractRecommendations","warn","handleFallbackAPIs","fallbackError","errorMessage","message","fallbackErrorMessage","userFriendlyMessage","includes","name","healthNewsResult","articles","formattedNews","formatNewsArticles","newsKey","url","nutritionResponse","nutritionData","found","resultString","JSON","stringify","nutritionError","formatted","forEach","article","index","title","source","domain","publishedDate","toLocaleDateString","Math","round","relevanceScore","tags","join","handleBackToSearch","handleNewSearch","newQuery","onBackToSearch","onNewSearch","DemoResultsPage","sampleQuery","sampleResponse","sampleApiResponse","ai_response","confidence_score","charts","nutrition_breakdown","carbohydrates","protein","fat","fiber","minerals","health_quality","chart_type","labels","values","App","children","path","element","process","env","NODE_ENV"],"sources":["C:/repo/wihy_ui/client/src/App.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { BrowserRouter as Router, Routes, Route, useSearchParams, useNavigate, useLocation } from 'react-router-dom';\r\nimport VHealthSearch from './components/search/VHealthSearch';\r\nimport SearchResults from './components/search/SearchResults';\r\nimport HealthNewsFeed from './components/HealthNewsFeed';\r\nimport TestChartsPage from './pages/TestChartsPage';\r\nimport openaiAPI from './services/openaiAPI';\r\nimport { wihyAPI } from './services/wihyAPI';\r\nimport { searchCache } from './services/searchCache';\r\nimport { fetchNewsFeed, refreshNewsFeed, searchNewsArticles } from './services/newsService';\r\nimport { logger } from './utils/logger';\r\nimport './styles/VHealthSearch.css';\r\nimport './index.css';\r\nimport VHealthApp from './vHealthApp';\r\nimport { API_CONFIG, getApiEndpoint } from './config/apiConfig';\r\n\r\nconst API_BASE_URL = API_CONFIG.WIHY_API_URL; // Use the ml.wihy.ai endpoint\r\n\r\nexport const searchFoodDatabase = async (query: string) => {\r\n  try {\r\n    logger.apiRequest('Food Database Search', { query });\r\n    \r\n    const response = await fetch(`${API_BASE_URL}/api/food/search?q=${encodeURIComponent(query)}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP error! status: ${response.status}`);\r\n    }\r\n\r\n    const data = await response.json();\r\n    logger.apiResponse('Food Database Search', data);\r\n    \r\n    return data;\r\n  } catch (error) {\r\n    console.error('Food database API error:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const foodAPI = {\r\n  searchFood: searchFoodDatabase\r\n};\r\n\r\n// Export news API for use in other components\r\nexport const newsAPI = {\r\n  fetchNewsFeed,\r\n  refreshNewsFeed,\r\n  searchNewsArticles\r\n};\r\n\r\ntype AllowedDataSource = \"error\" | \"openai\" | \"local\" | \"vnutrition\" | \"wihy\";\r\n\r\nconst ResultsPage: React.FC = () => {\r\n  const [searchParams] = useSearchParams();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const query = searchParams.get('q') || '';\r\n  const isHealthNews = searchParams.get('type') === 'health_news';\r\n  const category = searchParams.get('category') || 'all';\r\n  \r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [results, setResults] = useState<string>('');\r\n  const [dataSource, setDataSource] = useState<AllowedDataSource>(\"local\");\r\n  const [citations, setCitations] = useState<string[]>([]);\r\n  const [recommendations, setRecommendations] = useState<string[]>([]);\r\n  const [disclaimer, setDisclaimer] = useState<string>('');\r\n  const [apiResponse, setApiResponse] = useState<any>(null);\r\n  \r\n  // Track if this is initial load to prevent loading spinner on browser navigation\r\n  const [isInitialLoad, setIsInitialLoad] = useState(true);\r\n  \r\n  // Add ref to prevent duplicate API calls\r\n  const lastProcessedQuery = useRef<string>('');\r\n  const isProcessing = useRef<boolean>(false);\r\n  \r\n  // Detect browser navigation type\r\n  const isBrowserNavigation = () => {\r\n    const navigation = (window as any).performance?.getEntriesByType?.('navigation')?.[0];\r\n    return navigation?.type === 'back_forward';\r\n  };\r\n\r\n  // Fetch results when query changes\r\n  useEffect(() => {\r\n    const fetchResults = async () => {\r\n      if (!query && !isHealthNews) {\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n      \r\n      // Create cache key based on type\r\n      const cacheKey = isHealthNews ? `health_news_${category}` : query;\r\n      \r\n      // Check if we have fresh data from navigation (e.g., from Header search)\r\n      const navigationState = location.state as any;\r\n      logger.debug('üîç ResultsPage: Checking navigation state', { \r\n        hasNavigationState: !!navigationState,\r\n        fromSearch: navigationState?.fromSearch,\r\n        hasResults: !!navigationState?.results,\r\n        hasApiResponse: !!navigationState?.apiResponse,\r\n        query: query,\r\n        cacheKey: cacheKey\r\n      });\r\n      \r\n      if (navigationState?.fromSearch && navigationState?.results) {\r\n        // üîç RESULTS PAGE LOGGING: Navigation state received\r\n        console.log('üîç RESULTS PAGE NAVIGATION:', {\r\n          query: query,\r\n          timestamp: new Date().toISOString(),\r\n          fromSearch: navigationState.fromSearch,\r\n          dataSource: navigationState.dataSource,\r\n          hasResults: !!navigationState.results,\r\n          hasApiResponse: !!navigationState.apiResponse,\r\n          resultType: typeof navigationState.results,\r\n          component: 'App.tsx',\r\n          action: 'navigationStateReceived'\r\n        });\r\n        \r\n        logger.info('üîç ResultsPage: Using navigation state data (no API call needed)', { query, cacheKey });\r\n        \r\n        // Show \"Analyzing with AI...\" briefly for user feedback, then display results\r\n        setIsLoading(true);\r\n        \r\n        // Small delay to ensure users see the \"Analyzing with AI...\" feedback\r\n        setTimeout(() => {\r\n          setResults(navigationState.results.details || navigationState.results.summary || 'No results');\r\n          setApiResponse(navigationState.apiResponse || null); // Set the API response for ChatWidget (may be null for cached data)\r\n          setDataSource(navigationState.dataSource || 'wihy');\r\n          setCitations(navigationState.results.sources || []);\r\n          setRecommendations(navigationState.results.recommendations || []);\r\n          setDisclaimer(navigationState.results.medicalDisclaimer || '');\r\n          setIsLoading(false);\r\n          \r\n          // üîç RESULTS PAGE LOGGING: State updated\r\n          console.log('üîç RESULTS PAGE STATE UPDATED:', {\r\n            query: query,\r\n            timestamp: new Date().toISOString(),\r\n            isLoading: false,\r\n            dataSource: navigationState.dataSource || 'wihy',\r\n            hasCitations: !!(navigationState.results.sources?.length),\r\n            hasRecommendations: !!(navigationState.results.recommendations?.length),\r\n            hasDisclaimer: !!(navigationState.results.medicalDisclaimer),\r\n            resultLength: (navigationState.results.details || navigationState.results.summary || '').length\r\n          });\r\n        }, 800); // Short delay to show \"Analyzing with AI...\" feedback\r\n        \r\n        return;\r\n      }\r\n      \r\n      // Prevent duplicate processing\r\n      if (isProcessing.current || lastProcessedQuery.current === cacheKey) {\r\n        logger.debug('Skipping duplicate query', { cacheKey });\r\n        return;\r\n      }\r\n      \r\n      logger.debug('Processing new query', { cacheKey });\r\n      lastProcessedQuery.current = cacheKey;\r\n      isProcessing.current = true;\r\n      \r\n      logger.debug('Query type analysis', { \r\n        isHealthNews, \r\n        isBrowserNavigation: isBrowserNavigation() \r\n      });\r\n      \r\n      // Always check cache first - especially for browser navigation\r\n      const cachedResult = searchCache.getCachedResult(cacheKey);\r\n      if (cachedResult) {\r\n        logger.cache('Using cached results', { cacheKey });\r\n        setResults(cachedResult);\r\n        setDataSource('local');\r\n        setIsLoading(false);\r\n        setCitations([]);\r\n        setRecommendations([]);\r\n        setDisclaimer('');\r\n        setIsInitialLoad(false);\r\n        isProcessing.current = false; // Reset processing flag\r\n        return; // Exit early - no API calls needed\r\n      }\r\n      \r\n      // If this is browser navigation and no cache, show placeholder content instead of redirecting\r\n      if (isBrowserNavigation() || !isInitialLoad) {\r\n        logger.debug('Browser navigation detected with no cache - showing placeholder content');\r\n        setResults('Please perform a new search to see results.');\r\n        setDataSource('local');\r\n        setIsLoading(false);\r\n        setCitations([]);\r\n        setRecommendations([]);\r\n        setDisclaimer('');\r\n        setIsInitialLoad(false);\r\n        isProcessing.current = false; // Reset processing flag\r\n        return;\r\n      }\r\n      \r\n      // Only show loading for genuine new searches (not browser navigation)\r\n      setIsLoading(true);\r\n      \r\n      try {\r\n        // Use WiHy Unified API for all types of searches\r\n        logger.apiRequest('WiHy Unified API', { \r\n          type: isHealthNews ? 'health_news' : 'search',\r\n          query: query || `health news - ${category}` \r\n        });\r\n        \r\n        let wihyResult: any;\r\n        \r\n        if (isHealthNews) {\r\n          // Handle health news requests\r\n          logger.debug('Fetching health news via WiHy API');\r\n          const categories = category === 'all' ? [] : [category];\r\n          wihyResult = await wihyAPI.getHealthNews(categories, 6);\r\n        } else {\r\n          // Handle regular search queries (health, nutrition, etc.)\r\n          logger.debug('Making WiHy API call for query', { query });\r\n          wihyResult = await wihyAPI.searchHealth(query);\r\n        }\r\n        \r\n        logger.apiResponse('WiHy API result', wihyResult);\r\n        \r\n        if (wihyResult.success) {\r\n          const formattedResult = wihyAPI.formatWihyResponse(wihyResult);\r\n          setResults(formattedResult);\r\n          setDataSource(\"wihy\");\r\n          setApiResponse(wihyResult); // Store the original API response\r\n          \r\n          // Cache the WiHy results (still cache the formatted result for legacy compatibility)\r\n          searchCache.setCachedResult(cacheKey, formattedResult, window.location.href);\r\n          \r\n          setCitations(wihyAPI.extractCitations(wihyResult));\r\n          setRecommendations(wihyAPI.extractRecommendations(wihyResult));\r\n          \r\n          if (isHealthNews) {\r\n            setDisclaimer('Health news provided by WiHy AI. Always consult healthcare professionals for medical advice.');\r\n          } else {\r\n            setDisclaimer('This guidance is based on evidence-based health principles. Always consult healthcare professionals for personalized medical advice.');\r\n          }\r\n        } else {\r\n          // Fallback: If WiHy fails, try legacy APIs\r\n          logger.warn('WiHy API failed, trying fallback methods');\r\n          await handleFallbackAPIs();\r\n        }\r\n        \r\n      } catch (error) {\r\n        logger.error(\"WiHy API error:\", error);\r\n        // Try fallback APIs if WiHy fails\r\n        try {\r\n          await handleFallbackAPIs();\r\n        } catch (fallbackError) {\r\n          logger.error(\"All APIs failed:\", fallbackError);\r\n          \r\n          // Check for specific error types\r\n          const errorMessage = error.message || '';\r\n          const fallbackErrorMessage = fallbackError.message || '';\r\n          \r\n          let userFriendlyMessage;\r\n          \r\n          if (errorMessage.includes('CORS_ERROR')) {\r\n            userFriendlyMessage = \"Oops! There's a configuration issue preventing us from reaching our AI services. üîß Our team is working on it - please try again later!\";\r\n          } else if (errorMessage.includes('NETWORK_ERROR') || errorMessage.includes('TIMEOUT_ERROR')) {\r\n            userFriendlyMessage = \"Oops! Looks like we're having some technical difficulties. ü§ñ Please come back in a few minutes while we fix things up!\";\r\n          } else if (errorMessage.includes('SERVER_ERROR')) {\r\n            userFriendlyMessage = \"Our servers are taking a quick break! ‚òï Please try again in a few minutes.\";\r\n          } else if (fallbackErrorMessage.includes('fetch') || \r\n                     fallbackErrorMessage.includes('network') || \r\n                     error.name === 'TypeError') {\r\n            userFriendlyMessage = \"Looks like there's a connection hiccup! üì° Please check your internet and try again.\";\r\n          } else {\r\n            userFriendlyMessage = `Sorry, we're experiencing some issues right now. \r\n\r\nüè† You can still use these features:\r\n‚Ä¢  Browse health news (click \"I'm Feeling Healthy\") \r\n‚Ä¢ üì∑ Upload images for basic analysis\r\n‚Ä¢ üîç Try visiting /test to see chart examples\r\n‚Ä¢ üìä View charts in search results sidebar\r\n\r\nPlease try your search again in a moment! üòÖ`;\r\n          }\r\n          \r\n          setResults(userFriendlyMessage);\r\n          setDataSource(\"error\");\r\n          \r\n          setCitations([]);\r\n          setRecommendations([]);\r\n          setDisclaimer('If this issue persists, please try refreshing the page or contact support.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n        setIsInitialLoad(false);\r\n        isProcessing.current = false; // Always reset processing flag\r\n      }\r\n    };\r\n\r\n    // Fallback function for legacy APIs\r\n    const handleFallbackAPIs = async () => {\r\n      if (isHealthNews) {\r\n        logger.debug('Fallback: Fetching health news via newsService');\r\n        const healthNewsResult = await fetchNewsFeed([category], 6);\r\n        \r\n        if (healthNewsResult.success && healthNewsResult.articles) {\r\n          logger.info('Health news fetched successfully');\r\n          \r\n          // Format the news articles for display\r\n          const formattedNews = formatNewsArticles(healthNewsResult.articles);\r\n          \r\n          setResults(formattedNews);\r\n          setDataSource('openai'); // Use openai as the display source\r\n          \r\n          // Cache the health news results\r\n          const newsKey = `health_news_${category}`;\r\n          searchCache.setCachedResult(newsKey, formattedNews, window.location.href);\r\n          \r\n          setDisclaimer('Health news provided by AI. Always consult healthcare professionals for medical advice.');\r\n        } else {\r\n          throw new Error('Failed to fetch health news');\r\n        }\r\n      } else {\r\n        // Try nutrition database for food-related queries\r\n        try {\r\n          logger.debug('Fallback: Trying nutrition database');\r\n          logger.debug('API URL', { url: `${API_BASE_URL}/api/search/food?q=${encodeURIComponent(query)}` });\r\n          \r\n          const nutritionResponse = await fetch(`${API_BASE_URL}/api/search/food?q=${encodeURIComponent(query)}`);\r\n          \r\n          if (nutritionResponse.ok) {\r\n            const nutritionData = await nutritionResponse.json();\r\n            logger.apiResponse('Nutrition API', nutritionData);\r\n            \r\n            if (nutritionData && nutritionData.found === true) {\r\n              logger.info('Found nutrition data - using vnutrition source');\r\n              const resultString = JSON.stringify(nutritionData);\r\n              setResults(resultString);\r\n              setDataSource('vnutrition');\r\n              \r\n              // Cache the nutrition results\r\n              searchCache.setCachedResult(query, resultString, window.location.href);\r\n              return;\r\n            }\r\n          }\r\n        } catch (nutritionError) {\r\n          logger.debug('Nutrition API also failed', { error: nutritionError });\r\n        }\r\n        \r\n        throw new Error('All fallback APIs failed');\r\n      }\r\n    };\r\n    \r\n    fetchResults();\r\n  }, [query, isHealthNews, category, location.state]); // Added location.state to dependencies\r\n\r\n  // Function to format news articles for display\r\n  const formatNewsArticles = (articles: any[]): string => {\r\n    let formatted = '# Latest Health News\\n\\n';\r\n    \r\n    articles.forEach((article, index) => {\r\n      formatted += `## ${article.title}\\n\\n`;\r\n      formatted += `**Source:** ${article.source} (${article.domain})\\n`;\r\n      formatted += `**Category:** ${article.category}\\n`;\r\n      formatted += `**Published:** ${new Date(article.publishedDate).toLocaleDateString()}\\n`;\r\n      formatted += `**Relevance:** ${Math.round(article.relevanceScore * 100)}%\\n\\n`;\r\n      formatted += `${article.summary}\\n\\n`;\r\n      \r\n      if (article.tags && article.tags.length > 0) {\r\n        formatted += `**Tags:** ${article.tags.join(', ')}\\n\\n`;\r\n      }\r\n      \r\n      formatted += `[Read Full Article](${article.url})\\n\\n`;\r\n      formatted += '---\\n\\n';\r\n    });\r\n    \r\n    return formatted;\r\n  };\r\n\r\n  const handleBackToSearch = () => {\r\n    navigate('/');\r\n  };\r\n\r\n  const handleNewSearch = (newQuery: string) => {\r\n    if (newQuery !== query) {\r\n      // Reset the initial load flag for new searches\r\n      setIsInitialLoad(true);\r\n      navigate(`/results?q=${encodeURIComponent(newQuery)}`);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <SearchResults\r\n      query={isHealthNews ? 'Latest Health News' : query}\r\n      results={results}\r\n      onBackToSearch={handleBackToSearch}\r\n      onNewSearch={handleNewSearch}\r\n      isLoading={isLoading}\r\n      dataSource={dataSource}\r\n      citations={citations}\r\n      recommendations={recommendations}\r\n      disclaimer={disclaimer}\r\n      apiResponse={apiResponse}\r\n    />\r\n  );\r\n};\r\n\r\n// Demo component for development - shows results without API calls\r\nconst DemoResultsPage: React.FC = () => {\r\n  const sampleQuery = \"Is quinoa healthy?\";\r\n  const sampleResponse = `# Comprehensive Health Analysis: Quinoa\r\n\r\n**Overview:**\r\nQuinoa is a nutrient-dense pseudocereal that offers exceptional health benefits. Originally cultivated in the Andes mountains, this superfood has gained worldwide recognition for its complete protein profile and versatility.\r\n\r\n**Key Health Benefits:**\r\n‚Ä¢ **Complete Protein**: Contains all 9 essential amino acids\r\n‚Ä¢ **High Fiber**: Supports digestive health and blood sugar regulation  \r\n‚Ä¢ **Rich in Minerals**: Excellent source of iron, magnesium, and phosphorus\r\n‚Ä¢ **Gluten-Free**: Safe for those with celiac disease or gluten sensitivity\r\n‚Ä¢ **Low Glycemic Index**: Helps maintain stable blood sugar levels\r\n\r\n**Nutritional Highlights:**\r\n- 8g protein per cooked cup\r\n- 5g fiber per serving\r\n- Rich in folate, manganese, and antioxidants\r\n- Contains heart-healthy monounsaturated fats\r\n\r\n**Recommendations:**\r\n‚úì Rinse quinoa before cooking to remove bitter saponins\r\n‚úì Toast dry quinoa for enhanced nutty flavor\r\n‚úì Use as a base for salads, bowls, or as a rice substitute\r\n‚úì Combine with vegetables and healthy fats for optimal nutrition\r\n\r\nThis analysis is based on peer-reviewed nutritional research and USDA food composition data.`;\r\n\r\n  const sampleApiResponse = {\r\n    success: true,\r\n    data: {\r\n      ai_response: {\r\n        response: sampleResponse\r\n      },\r\n      confidence_score: 0.92,\r\n      charts: {\r\n        nutrition_breakdown: {\r\n          carbohydrates: 39,\r\n          protein: 22,\r\n          fat: 16,\r\n          fiber: 12,\r\n          minerals: 11\r\n        },\r\n        health_quality: {\r\n          chart_type: \"dual_quality\",\r\n          labels: [\"Food Quality\", \"Research Quality\"],\r\n          values: [92, 88]\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <SearchResults\r\n      query={sampleQuery}\r\n      results={sampleResponse}\r\n      onBackToSearch={() => window.location.href = '/'}\r\n      onNewSearch={(query) => console.log('Demo search:', query)}\r\n      isLoading={false}\r\n      dataSource=\"local\"\r\n      citations={['Journal of Nutrition (2024)', 'USDA Food Database', 'American Heart Association']}\r\n      recommendations={[\r\n        'Consult with healthcare professionals for personalized advice',\r\n        'Consider individual dietary restrictions and allergies',\r\n        'Follow evidence-based nutritional guidelines'\r\n      ]}\r\n      disclaimer=\"This is demo data for development purposes. Always consult healthcare professionals for real medical advice.\"\r\n      apiResponse={sampleApiResponse}\r\n    />\r\n  );\r\n};\r\n\r\nconst App: React.FC = () => {\r\n  logger.debug(\"App component rendered\");\r\n  \r\n  return (\r\n    <Router>\r\n      <Routes>\r\n        <Route path=\"/\" element={<VHealthSearch />} />\r\n        <Route path=\"/results\" element={<ResultsPage />} />\r\n        <Route path=\"/test\" element={<TestChartsPage />} />\r\n        {/* Demo route - only available in development */}\r\n        {process.env.NODE_ENV === 'development' && (\r\n          <Route path=\"/demo\" element={<DemoResultsPage />} />\r\n        )}\r\n      </Routes>\r\n    </Router>\r\n  );\r\n};\r\n\r\nexport default App;\r\n\r\ninterface ChatGPTResponse {\r\n  details?: string;\r\n  sources?: string[];\r\n  recommendations?: string[];\r\n  medicalDisclaimer?: string;\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}