{"ast":null,"code":"// src/components/ImageUploadModal.tsx\nimport React,{useState,useRef,useCallback}from'react';import'./Spinner.css';import'../../styles/VHealthSearch.css';import{visionAnalysisService}from'../../services/visionAnalysisService';import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const ImageUploadModal=_ref=>{let{isOpen,onClose,onAnalysisComplete,// Updated prop name\ntitle=\"Analyze Image\",subtitle=\"Upload or capture images for comprehensive analysis\"}=_ref;// ALL HOOKS MUST BE CALLED BEFORE ANY CONDITIONAL RETURNS\nconst[isDragging,setIsDragging]=useState(false);const[imageUrl,setImageUrl]=useState('');const[isProcessing,setIsProcessing]=useState(false);const[showCamera,setShowCamera]=useState(false);const[stream,setStream]=useState(null);const[cameraError,setCameraError]=useState('');const videoRef=useRef(null);const canvasRef=useRef(null);// Process file and analyze it with Vision Analysis Service\nconst processFile=useCallback(async file=>{setIsProcessing(true);try{// Use Vision Analysis Service for comprehensive detection\nconst visionResult=await visionAnalysisService.analyzeImage(file);let analysisText='Image analyzed';if(visionResult.success&&visionResult.data){// Format comprehensive analysis results\nanalysisText=visionAnalysisService.formatForDisplay(visionResult);// Also try enhanced WiHy API analysis for additional context\ntry{const{wihyAPI}=await import('../../services/wihyAPI');// Create a detailed query for enhanced analysis\nconst enhancedQuery=\"Analyze this food image comprehensively. \\nVision Analysis Results: \".concat(analysisText,\"\\nProvide detailed health insights, nutritional benefits, potential risks, and recommendations.\");// Use the special analyzeWithWiHy method for enhanced analysis\nconst wihyResult=await wihyAPI.analyzeWithWiHy(enhancedQuery,{health_concerns:['nutrition','food_safety']},'ImageUploadModal');// Check if the result has success property and handle both response types\nconst isSuccessful='success'in wihyResult?wihyResult.success:true;const hasData='data'in wihyResult?wihyResult.data:wihyResult;if(isSuccessful&&hasData){// Format the enhanced analysis\nconst enhancedAnalysis=wihyAPI.formatResponse(wihyResult);analysisText=\"\".concat(analysisText,\"\\n\\n=== Enhanced WiHy Analysis ===\\n\").concat(enhancedAnalysis);}}catch(wihyError){// Fallback to basic scan method\ntry{const{wihyAPI}=await import('../../services/wihyAPI');const basicResult=await wihyAPI.scanFood(file);// Handle both response types\nconst isSuccessful='success'in basicResult?basicResult.success:true;const message='message'in basicResult?basicResult.message:'data'in basicResult&&basicResult.data.ai_response?basicResult.data.ai_response.response:'Analysis completed';if(isSuccessful&&message){analysisText=\"\".concat(analysisText,\"\\n\\nBasic AI Health Analysis: \").concat(message);}}catch(basicError){// Basic WiHy API also not available, using Vision Analysis results only\n}}}else{analysisText=visionResult.error||'Image analysis unavailable';}onAnalysisComplete(analysisText);}catch(error){console.error('❌ Error in processFile:',error);onAnalysisComplete('Analysis failed. Please try again.');}finally{setIsProcessing(false);}},[onAnalysisComplete]);// Camera functions\nconst startCamera=useCallback(async()=>{try{setCameraError('');const mediaStream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment',// Use back camera on mobile\nwidth:{ideal:1280},height:{ideal:720}}});setStream(mediaStream);if(videoRef.current){videoRef.current.srcObject=mediaStream;}}catch(error){console.error('Camera access error:',error);setCameraError('Unable to access camera. Please check permissions.');}},[]);const stopCamera=useCallback(()=>{if(stream){stream.getTracks().forEach(track=>track.stop());setStream(null);}setShowCamera(false);},[stream]);const capturePhoto=useCallback(async()=>{if(!videoRef.current||!canvasRef.current)return;const video=videoRef.current;const canvas=canvasRef.current;const context=canvas.getContext('2d');if(!context)return;// Set canvas dimensions to match video\ncanvas.width=video.videoWidth;canvas.height=video.videoHeight;// Draw current video frame to canvas\ncontext.drawImage(video,0,0,canvas.width,canvas.height);// Convert canvas to blob and then to File\ncanvas.toBlob(async blob=>{if(blob){const file=new File([blob],'camera-capture.jpg',{type:'image/jpeg'});await processFile(file);stopCamera();}},'image/jpeg',0.9);},[processFile,stopCamera]);const handleCameraToggle=useCallback(()=>{if(showCamera){stopCamera();}else{setShowCamera(true);startCamera();}},[showCamera,stopCamera,startCamera]);// Handle file drop\nconst handleDrop=useCallback(async e=>{e.preventDefault();setIsDragging(false);const files=Array.from(e.dataTransfer.files);const imageFile=files.find(file=>file.type.startsWith('image/'));if(imageFile){await processFile(imageFile);}else{alert('Please upload an image file (JPG, PNG, GIF, etc.)');}},[processFile]);// Handle drag events\nconst handleDragOver=useCallback(e=>{e.preventDefault();setIsDragging(true);},[]);const handleDragLeave=useCallback(e=>{e.preventDefault();setIsDragging(false);},[]);// Handle file input\nconst handleFileInput=useCallback(async e=>{var _e$target$files;const file=(_e$target$files=e.target.files)===null||_e$target$files===void 0?void 0:_e$target$files[0];if(file){await processFile(file);}},[processFile]);// Handle URL upload\nconst handleUrlUpload=useCallback(async()=>{if(!imageUrl.trim()){alert('Please enter a valid image URL');return;}setIsProcessing(true);try{const response=await fetch(imageUrl);const blob=await response.blob();if(!blob.type.startsWith('image/')){throw new Error('URL does not point to an image');}const file=new File([blob],'uploaded-image.jpg',{type:blob.type});await processFile(file);}catch(error){console.error('Error loading image from URL:',error);alert('Failed to load image from URL. Please check the URL and try again.');}finally{setIsProcessing(false);}},[imageUrl,processFile]);// Handle modal close\nconst handleClose=useCallback(()=>{if(!isProcessing){stopCamera();// Clean up camera resources\nonClose();setImageUrl('');setIsDragging(false);setShowCamera(false);setCameraError('');}},[isProcessing,stopCamera,onClose]);// Return null if modal is not open (AFTER all hooks are called)\nif(!isOpen)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"photo-modal-overlay \".concat(isOpen?'open':''),onClick:handleClose,children:/*#__PURE__*/_jsxs(\"div\",{className:\"photo-modal\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"simple-upload-container\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"simple-title\",children:\"Analyze any image\"}),!showCamera?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"simple-upload-area \".concat(isDragging?'dragging':'',\" \").concat(isProcessing?'processing':''),onDrop:handleDrop,onDragOver:handleDragOver,onDragLeave:handleDragLeave,children:[/*#__PURE__*/_jsx(\"div\",{className:\"simple-upload-content\",children:isProcessing?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"simple-spinner\",children:/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"})}),/*#__PURE__*/_jsx(\"p\",{className:\"simple-upload-text\",children:\"Analyzing image...\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"simple-upload-icon\",children:/*#__PURE__*/_jsx(\"svg\",{viewBox:\"0 0 24 24\",fill:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z\"})})}),/*#__PURE__*/_jsxs(\"p\",{className:\"simple-upload-text\",children:[isDragging?'Drop image here':'Drag an image here or',' ',/*#__PURE__*/_jsx(\"span\",{className:\"upload-link\",onClick:()=>{var _document$getElementB;return(_document$getElementB=document.getElementById('modal-file-input'))===null||_document$getElementB===void 0?void 0:_document$getElementB.click();},children:\"upload a file\"})]})]})}),/*#__PURE__*/_jsx(\"input\",{id:\"modal-file-input\",type:\"file\",accept:\"image/*\",style:{display:'none'},onChange:handleFileInput,disabled:isProcessing,capture:\"environment\"// Mobile camera hint\n})]}),/*#__PURE__*/_jsx(\"div\",{className:\"camera-toggle-section\",style:{marginBottom:'16px',textAlign:'center',display:'flex',justifyContent:'center',width:'100%'},children:/*#__PURE__*/_jsx(\"button\",{onClick:handleCameraToggle,disabled:isProcessing,style:{background:'#1a73e8',color:'white',border:'none',borderRadius:'24px',padding:'12px 24px',fontSize:'16px',fontWeight:'600',cursor:isProcessing?'not-allowed':'pointer',minWidth:'200px',maxWidth:'280px',boxShadow:'none !important',outline:'none',filter:'none',WebkitBoxShadow:'none',MozBoxShadow:'none'},children:\"Use Camera\"})})]}):/*#__PURE__*//* Camera Section */_jsx(\"div\",{className:\"camera-section\",children:cameraError?/*#__PURE__*/_jsxs(\"div\",{className:\"camera-error\",children:[/*#__PURE__*/_jsx(\"p\",{children:cameraError}),/*#__PURE__*/_jsx(\"button\",{onClick:startCamera,className:\"retry-button\",children:\"Try Again\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"camera-container\",children:[/*#__PURE__*/_jsx(\"video\",{ref:videoRef,autoPlay:true,playsInline:true,className:\"camera-video\"}),stream&&!isProcessing&&/*#__PURE__*/_jsx(\"div\",{className:\"wihy-btn-wrapper\",style:{display:'inline-block',animation:'wiH-border-sweep 2.2s linear infinite',background:'linear-gradient(#fff, #fff) padding-box, linear-gradient(90deg, #fa5f06, #ffffff, #C0C0C0, #4cbb17) border-box',backgroundSize:'100% 100%, 200% 100%',border:'2px solid transparent',borderRadius:'24px',position:'absolute',bottom:'20px',left:'50%',transform:'translateX(-50%)',minWidth:'180px'},children:/*#__PURE__*/_jsx(\"button\",{className:\"analyze-wihy-btn\",onClick:capturePhoto,disabled:isProcessing,style:{background:'transparent',border:'none',borderRadius:'24px',padding:'14px 28px',fontSize:'16px',fontWeight:'600',cursor:'pointer',boxShadow:'none',transform:'none',color:'#1a73e8',width:'100%'},children:\"Capture & Analyze\"})}),isProcessing&&/*#__PURE__*/_jsxs(\"div\",{className:\"camera-processing\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Analyzing image...\"})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'center',width:'100%',marginTop:'20px',marginBottom:'20px'},children:/*#__PURE__*/_jsx(\"button\",{className:\"back-to-upload-button\",onClick:handleCameraToggle,disabled:isProcessing,style:{background:'#f8f9fa',border:'1px solid #dadce0',borderRadius:'24px',padding:'12px 24px',fontSize:'14px',fontWeight:'500',cursor:isProcessing?'not-allowed':'pointer',color:'#5f6368'},children:\"Back to Upload\"})}),/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,style:{display:'none'}})]})})]}),!showCamera&&/*#__PURE__*/_jsxs(\"div\",{className:\"simple-url-section\",style:{marginBottom:'16px',textAlign:'center',display:'flex',flexDirection:'column',alignItems:'center',width:'100%',padding:'0 20px 4px 20px'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"url\",placeholder:\"Paste image link\",className:\"simple-url-input\",value:imageUrl,onChange:e=>setImageUrl(e.target.value),onKeyPress:e=>{if(e.key==='Enter'){handleUrlUpload();}},disabled:isProcessing,style:{marginBottom:'12px',width:'95%',maxWidth:'600px',minWidth:'400px',padding:'12px 24px',borderRadius:'24px',border:'1px solid #dadce0',fontSize:'16px',textAlign:'center',outline:'none',boxShadow:'none !important',WebkitBoxShadow:'none',MozBoxShadow:'none',filter:'none'}}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'center',width:'100%',marginTop:'4px'},children:/*#__PURE__*/_jsx(\"div\",{className:\"wihy-btn-wrapper\",style:{display:'inline-block',animation:'wiH-border-sweep 2.2s linear infinite',background:'linear-gradient(#fff, #fff) padding-box, linear-gradient(90deg, #fa5f06, #ffffff, #C0C0C0, #4cbb17) border-box',backgroundSize:'100% 100%, 200% 100%',border:'2px solid transparent',borderRadius:'28px',minWidth:'220px',maxWidth:'280px',boxShadow:'none !important',WebkitBoxShadow:'none',MozBoxShadow:'none',filter:'none'},children:/*#__PURE__*/_jsx(\"button\",{className:\"analyze-wihy-btn\",onClick:handleUrlUpload,disabled:isProcessing||!imageUrl.trim(),style:{background:'transparent',border:'none',borderRadius:'28px',padding:'12px 24px',fontSize:'16px',fontWeight:'600',cursor:isProcessing||!imageUrl.trim()?'not-allowed':'pointer',color:isProcessing||!imageUrl.trim()?'#9ca3af':'#1a73e8',width:'100%',opacity:isProcessing||!imageUrl.trim()?0.6:1,boxShadow:'none !important',WebkitBoxShadow:'none',MozBoxShadow:'none',filter:'none',outline:'none',display:'flex',alignItems:'center',justifyContent:'center',textAlign:'center'},children:isProcessing?'Analyzing...':'Analyze with WiHy'})})})]})]})});};export default ImageUploadModal;","map":{"version":3,"names":["React","useState","useRef","useCallback","visionAnalysisService","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","ImageUploadModal","_ref","isOpen","onClose","onAnalysisComplete","title","subtitle","isDragging","setIsDragging","imageUrl","setImageUrl","isProcessing","setIsProcessing","showCamera","setShowCamera","stream","setStream","cameraError","setCameraError","videoRef","canvasRef","processFile","file","visionResult","analyzeImage","analysisText","success","data","formatForDisplay","wihyAPI","enhancedQuery","concat","wihyResult","analyzeWithWiHy","health_concerns","isSuccessful","hasData","enhancedAnalysis","formatResponse","wihyError","basicResult","scanFood","message","ai_response","response","basicError","error","console","startCamera","mediaStream","navigator","mediaDevices","getUserMedia","video","facingMode","width","ideal","height","current","srcObject","stopCamera","getTracks","forEach","track","stop","capturePhoto","canvas","context","getContext","videoWidth","videoHeight","drawImage","toBlob","blob","File","type","handleCameraToggle","handleDrop","e","preventDefault","files","Array","from","dataTransfer","imageFile","find","startsWith","alert","handleDragOver","handleDragLeave","handleFileInput","_e$target$files","target","handleUrlUpload","trim","fetch","Error","handleClose","className","onClick","children","stopPropagation","onDrop","onDragOver","onDragLeave","viewBox","fill","d","_document$getElementB","document","getElementById","click","id","accept","style","display","onChange","disabled","capture","marginBottom","textAlign","justifyContent","background","color","border","borderRadius","padding","fontSize","fontWeight","cursor","minWidth","maxWidth","boxShadow","outline","filter","WebkitBoxShadow","MozBoxShadow","ref","autoPlay","playsInline","animation","backgroundSize","position","bottom","left","transform","marginTop","flexDirection","alignItems","placeholder","value","onKeyPress","key","opacity"],"sources":["C:/repo/wihy_ui/client/src/components/ui/ImageUploadModal.tsx"],"sourcesContent":["// src/components/ImageUploadModal.tsx\r\nimport React, { useState, useRef, useCallback } from 'react';\r\nimport './Spinner.css';\r\nimport '../../styles/VHealthSearch.css';\r\nimport { visionAnalysisService } from '../../services/visionAnalysisService';\r\n\r\ninterface ImageUploadModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onAnalysisComplete: (foodName: string) => void; // Changed from onFileSelect\r\n  title?: string;\r\n  subtitle?: string;\r\n}\r\n\r\nconst ImageUploadModal: React.FC<ImageUploadModalProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  onAnalysisComplete, // Updated prop name\r\n  title = \"Analyze Image\",\r\n  subtitle = \"Upload or capture images for comprehensive analysis\"\r\n}) => {\r\n  // ALL HOOKS MUST BE CALLED BEFORE ANY CONDITIONAL RETURNS\r\n  const [isDragging, setIsDragging] = useState(false);\r\n  const [imageUrl, setImageUrl] = useState('');\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [showCamera, setShowCamera] = useState(false);\r\n  const [stream, setStream] = useState<MediaStream | null>(null);\r\n  const [cameraError, setCameraError] = useState<string>('');\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n\r\n  // Process file and analyze it with Vision Analysis Service\r\n  const processFile = useCallback(async (file: File) => {\r\n    setIsProcessing(true);\r\n    \r\n    try {\r\n      // Use Vision Analysis Service for comprehensive detection\r\n      const visionResult = await visionAnalysisService.analyzeImage(file);\r\n      \r\n      let analysisText = 'Image analyzed';\r\n      \r\n      if (visionResult.success && visionResult.data) {\r\n        // Format comprehensive analysis results\r\n        analysisText = visionAnalysisService.formatForDisplay(visionResult);\r\n        \r\n        // Also try enhanced WiHy API analysis for additional context\r\n        try {\r\n          const { wihyAPI } = await import('../../services/wihyAPI');\r\n          \r\n          // Create a detailed query for enhanced analysis\r\n          const enhancedQuery = `Analyze this food image comprehensively. \r\nVision Analysis Results: ${analysisText}\r\nProvide detailed health insights, nutritional benefits, potential risks, and recommendations.`;\r\n          \r\n          // Use the special analyzeWithWiHy method for enhanced analysis\r\n          const wihyResult = await wihyAPI.analyzeWithWiHy(\r\n            enhancedQuery,\r\n            {\r\n              health_concerns: ['nutrition', 'food_safety']\r\n            },\r\n            'ImageUploadModal'\r\n          );\r\n          \r\n          // Check if the result has success property and handle both response types\r\n          const isSuccessful = ('success' in wihyResult) ? wihyResult.success : true;\r\n          const hasData = ('data' in wihyResult) ? wihyResult.data : wihyResult;\r\n          \r\n          if (isSuccessful && hasData) {\r\n            // Format the enhanced analysis\r\n            const enhancedAnalysis = wihyAPI.formatResponse(wihyResult);\r\n            analysisText = `${analysisText}\\n\\n=== Enhanced WiHy Analysis ===\\n${enhancedAnalysis}`;\r\n          }\r\n        } catch (wihyError) {\r\n          // Fallback to basic scan method\r\n          try {\r\n            const { wihyAPI } = await import('../../services/wihyAPI');\r\n            const basicResult = await wihyAPI.scanFood(file);\r\n            \r\n            // Handle both response types\r\n            const isSuccessful = ('success' in basicResult) ? basicResult.success : true;\r\n            const message = ('message' in basicResult) ? basicResult.message : \r\n                          ('data' in basicResult && basicResult.data.ai_response) ? basicResult.data.ai_response.response : \r\n                          'Analysis completed';\r\n            \r\n            if (isSuccessful && message) {\r\n              analysisText = `${analysisText}\\n\\nBasic AI Health Analysis: ${message}`;\r\n            }\r\n          } catch (basicError) {\r\n            // Basic WiHy API also not available, using Vision Analysis results only\r\n          }\r\n        }\r\n      } else {\r\n        analysisText = visionResult.error || 'Image analysis unavailable';\r\n      }\r\n      \r\n      onAnalysisComplete(analysisText);\r\n      \r\n    } catch (error) {\r\n      console.error('❌ Error in processFile:', error);\r\n      onAnalysisComplete('Analysis failed. Please try again.');\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  }, [onAnalysisComplete]);\r\n\r\n  // Camera functions\r\n  const startCamera = useCallback(async () => {\r\n    try {\r\n      setCameraError('');\r\n      const mediaStream = await navigator.mediaDevices.getUserMedia({\r\n        video: { \r\n          facingMode: 'environment', // Use back camera on mobile\r\n          width: { ideal: 1280 },\r\n          height: { ideal: 720 }\r\n        }\r\n      });\r\n      \r\n      setStream(mediaStream);\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = mediaStream;\r\n      }\r\n    } catch (error) {\r\n      console.error('Camera access error:', error);\r\n      setCameraError('Unable to access camera. Please check permissions.');\r\n    }\r\n  }, []);\r\n\r\n  const stopCamera = useCallback(() => {\r\n    if (stream) {\r\n      stream.getTracks().forEach(track => track.stop());\r\n      setStream(null);\r\n    }\r\n    setShowCamera(false);\r\n  }, [stream]);\r\n\r\n  const capturePhoto = useCallback(async () => {\r\n    if (!videoRef.current || !canvasRef.current) return;\r\n\r\n    const video = videoRef.current;\r\n    const canvas = canvasRef.current;\r\n    const context = canvas.getContext('2d');\r\n\r\n    if (!context) return;\r\n\r\n    // Set canvas dimensions to match video\r\n    canvas.width = video.videoWidth;\r\n    canvas.height = video.videoHeight;\r\n\r\n    // Draw current video frame to canvas\r\n    context.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n\r\n    // Convert canvas to blob and then to File\r\n    canvas.toBlob(async (blob) => {\r\n      if (blob) {\r\n        const file = new File([blob], 'camera-capture.jpg', { type: 'image/jpeg' });\r\n        await processFile(file);\r\n        stopCamera();\r\n      }\r\n    }, 'image/jpeg', 0.9);\r\n  }, [processFile, stopCamera]);\r\n\r\n  const handleCameraToggle = useCallback(() => {\r\n    if (showCamera) {\r\n      stopCamera();\r\n    } else {\r\n      setShowCamera(true);\r\n      startCamera();\r\n    }\r\n  }, [showCamera, stopCamera, startCamera]);\r\n\r\n  // Handle file drop\r\n  const handleDrop = useCallback(async (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragging(false);\r\n    \r\n    const files = Array.from(e.dataTransfer.files);\r\n    const imageFile = files.find(file => file.type.startsWith('image/'));\r\n    \r\n    if (imageFile) {\r\n      await processFile(imageFile);\r\n    } else {\r\n      alert('Please upload an image file (JPG, PNG, GIF, etc.)');\r\n    }\r\n  }, [processFile]);\r\n\r\n  // Handle drag events\r\n  const handleDragOver = useCallback((e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragging(true);\r\n  }, []);\r\n\r\n  const handleDragLeave = useCallback((e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragging(false);\r\n  }, []);\r\n\r\n  // Handle file input\r\n  const handleFileInput = useCallback(async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      await processFile(file);\r\n    }\r\n  }, [processFile]);\r\n\r\n  // Handle URL upload\r\n  const handleUrlUpload = useCallback(async () => {\r\n    if (!imageUrl.trim()) {\r\n      alert('Please enter a valid image URL');\r\n      return;\r\n    }\r\n\r\n    setIsProcessing(true);\r\n    try {\r\n      const response = await fetch(imageUrl);\r\n      const blob = await response.blob();\r\n      \r\n      if (!blob.type.startsWith('image/')) {\r\n        throw new Error('URL does not point to an image');\r\n      }\r\n\r\n      const file = new File([blob], 'uploaded-image.jpg', { type: blob.type });\r\n      await processFile(file);\r\n    } catch (error) {\r\n      console.error('Error loading image from URL:', error);\r\n      alert('Failed to load image from URL. Please check the URL and try again.');\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  }, [imageUrl, processFile]);\r\n\r\n  // Handle modal close\r\n  const handleClose = useCallback(() => {\r\n    if (!isProcessing) {\r\n      stopCamera(); // Clean up camera resources\r\n      onClose();\r\n      setImageUrl('');\r\n      setIsDragging(false);\r\n      setShowCamera(false);\r\n      setCameraError('');\r\n    }\r\n  }, [isProcessing, stopCamera, onClose]);\r\n\r\n  // Return null if modal is not open (AFTER all hooks are called)\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className={`photo-modal-overlay ${isOpen ? 'open' : ''}`} onClick={handleClose}>\r\n      <div className=\"photo-modal\" onClick={(e) => e.stopPropagation()}>\r\n        \r\n        {/* Simple Upload Area */}\r\n        <div className=\"simple-upload-container\">\r\n          <h2 className=\"simple-title\">Analyze any image</h2>\r\n          \r\n          {!showCamera ? (\r\n            <>\r\n              <div \r\n                className={`simple-upload-area ${isDragging ? 'dragging' : ''} ${isProcessing ? 'processing' : ''}`}\r\n                onDrop={handleDrop}\r\n                onDragOver={handleDragOver}\r\n                onDragLeave={handleDragLeave}\r\n              >\r\n                <div className=\"simple-upload-content\">\r\n                  {isProcessing ? (\r\n                    <>\r\n                      <div className=\"simple-spinner\">\r\n                        <div className=\"spinner\"></div>\r\n                      </div>\r\n                      <p className=\"simple-upload-text\">Analyzing image...</p>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <div className=\"simple-upload-icon\">\r\n                        <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                          <path d=\"M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z\"/>\r\n                        </svg>\r\n                      </div>\r\n                      <p className=\"simple-upload-text\">\r\n                        {isDragging ? 'Drop image here' : 'Drag an image here or'}{' '}\r\n                        <span \r\n                          className=\"upload-link\"\r\n                          onClick={() => document.getElementById('modal-file-input')?.click()}\r\n                        >\r\n                          upload a file\r\n                        </span>\r\n                      </p>\r\n                    </>\r\n                  )}\r\n                </div>\r\n                \r\n                <input\r\n                  id=\"modal-file-input\"\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  style={{ display: 'none' }}\r\n                  onChange={handleFileInput}\r\n                  disabled={isProcessing}\r\n                  capture=\"environment\" // Mobile camera hint\r\n                />\r\n              </div>\r\n              \r\n              {/* Camera Toggle Button */}\r\n              <div className=\"camera-toggle-section\" style={{ \r\n                marginBottom: '16px', \r\n                textAlign: 'center',\r\n                display: 'flex',\r\n                justifyContent: 'center',\r\n                width: '100%'\r\n              }}>\r\n                <button \r\n                  onClick={handleCameraToggle}\r\n                  disabled={isProcessing}\r\n                  style={{\r\n                    background: '#1a73e8',\r\n                    color: 'white',\r\n                    border: 'none',\r\n                    borderRadius: '24px',\r\n                    padding: '12px 24px',\r\n                    fontSize: '16px',\r\n                    fontWeight: '600',\r\n                    cursor: isProcessing ? 'not-allowed' : 'pointer',\r\n                    minWidth: '200px',\r\n                    maxWidth: '280px',\r\n                    boxShadow: 'none !important',\r\n                    outline: 'none',\r\n                    filter: 'none',\r\n                    WebkitBoxShadow: 'none',\r\n                    MozBoxShadow: 'none'\r\n                  }}\r\n                >\r\n                  Use Camera\r\n                </button>\r\n              </div>\r\n            </>\r\n          ) : (\r\n            /* Camera Section */\r\n            <div className=\"camera-section\">\r\n              {cameraError ? (\r\n                <div className=\"camera-error\">\r\n                  <p>{cameraError}</p>\r\n                  <button onClick={startCamera} className=\"retry-button\">Try Again</button>\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  <div className=\"camera-container\">\r\n                    <video\r\n                      ref={videoRef}\r\n                      autoPlay\r\n                      playsInline\r\n                      className=\"camera-video\"\r\n                    />\r\n                    {stream && !isProcessing && (\r\n                      <div className=\"wihy-btn-wrapper\" style={{\r\n                        display: 'inline-block',\r\n                        animation: 'wiH-border-sweep 2.2s linear infinite',\r\n                        background: 'linear-gradient(#fff, #fff) padding-box, linear-gradient(90deg, #fa5f06, #ffffff, #C0C0C0, #4cbb17) border-box',\r\n                        backgroundSize: '100% 100%, 200% 100%',\r\n                        border: '2px solid transparent',\r\n                        borderRadius: '24px',\r\n                        position: 'absolute',\r\n                        bottom: '20px',\r\n                        left: '50%',\r\n                        transform: 'translateX(-50%)',\r\n                        minWidth: '180px'\r\n                      }}>\r\n                        <button\r\n                          className=\"analyze-wihy-btn\"\r\n                          onClick={capturePhoto}\r\n                          disabled={isProcessing}\r\n                          style={{\r\n                            background: 'transparent',\r\n                            border: 'none',\r\n                            borderRadius: '24px',\r\n                            padding: '14px 28px',\r\n                            fontSize: '16px',\r\n                            fontWeight: '600',\r\n                            cursor: 'pointer',\r\n                            boxShadow: 'none',\r\n                            transform: 'none',\r\n                            color: '#1a73e8',\r\n                            width: '100%'\r\n                          }}\r\n                        >\r\n                          Capture & Analyze\r\n                        </button>\r\n                      </div>\r\n                    )}\r\n                    {isProcessing && (\r\n                      <div className=\"camera-processing\">\r\n                        <div className=\"spinner\"></div>\r\n                        <p>Analyzing image...</p>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  \r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    justifyContent: 'center', \r\n                    width: '100%',\r\n                    marginTop: '20px',\r\n                    marginBottom: '20px'\r\n                  }}>\r\n                    <button \r\n                      className=\"back-to-upload-button\"\r\n                      onClick={handleCameraToggle}\r\n                      disabled={isProcessing}\r\n                      style={{\r\n                        background: '#f8f9fa',\r\n                        border: '1px solid #dadce0',\r\n                        borderRadius: '24px',\r\n                        padding: '12px 24px',\r\n                        fontSize: '14px',\r\n                        fontWeight: '500',\r\n                        cursor: isProcessing ? 'not-allowed' : 'pointer',\r\n                        color: '#5f6368'\r\n                      }}\r\n                    >\r\n                      Back to Upload\r\n                    </button>\r\n                  </div>\r\n                  \r\n                  <canvas\r\n                    ref={canvasRef}\r\n                    style={{ display: 'none' }}\r\n                  />\r\n                </>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n        \r\n        {/* URL Section - Only visible when not in camera mode */}\r\n        {!showCamera && (\r\n          <div className=\"simple-url-section\" style={{ \r\n            marginBottom: '16px', \r\n            textAlign: 'center',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            alignItems: 'center',\r\n            width: '100%',\r\n            padding: '0 20px 4px 20px'\r\n          }}>\r\n          <input\r\n            type=\"url\"\r\n            placeholder=\"Paste image link\"\r\n            className=\"simple-url-input\"\r\n            value={imageUrl}\r\n            onChange={(e) => setImageUrl(e.target.value)}\r\n            onKeyPress={(e) => {\r\n              if (e.key === 'Enter') {\r\n                handleUrlUpload();\r\n              }\r\n            }}\r\n            disabled={isProcessing}\r\n            style={{ \r\n              marginBottom: '12px',\r\n              width: '95%',\r\n              maxWidth: '600px',\r\n              minWidth: '400px',\r\n              padding: '12px 24px',\r\n              borderRadius: '24px',\r\n              border: '1px solid #dadce0',\r\n              fontSize: '16px',\r\n              textAlign: 'center',\r\n              outline: 'none',\r\n              boxShadow: 'none !important',\r\n              WebkitBoxShadow: 'none',\r\n              MozBoxShadow: 'none',\r\n              filter: 'none'\r\n            }}\r\n          />\r\n          <div style={{ \r\n            display: 'flex', \r\n            justifyContent: 'center', \r\n            width: '100%',\r\n            marginTop: '4px'\r\n          }}>\r\n            <div className=\"wihy-btn-wrapper\" style={{\r\n              display: 'inline-block',\r\n              animation: 'wiH-border-sweep 2.2s linear infinite',\r\n              background: 'linear-gradient(#fff, #fff) padding-box, linear-gradient(90deg, #fa5f06, #ffffff, #C0C0C0, #4cbb17) border-box',\r\n              backgroundSize: '100% 100%, 200% 100%',\r\n              border: '2px solid transparent',\r\n              borderRadius: '28px',\r\n              minWidth: '220px',\r\n              maxWidth: '280px',\r\n              boxShadow: 'none !important',\r\n              WebkitBoxShadow: 'none',\r\n              MozBoxShadow: 'none',\r\n              filter: 'none'\r\n            }}>\r\n              <button \r\n                className=\"analyze-wihy-btn\"\r\n                onClick={handleUrlUpload}\r\n                disabled={isProcessing || !imageUrl.trim()}\r\n                style={{\r\n                  background: 'transparent',\r\n                  border: 'none',\r\n                  borderRadius: '28px',\r\n                  padding: '12px 24px',\r\n                  fontSize: '16px',\r\n                  fontWeight: '600',\r\n                  cursor: isProcessing || !imageUrl.trim() ? 'not-allowed' : 'pointer',\r\n                  color: (isProcessing || !imageUrl.trim()) ? '#9ca3af' : '#1a73e8',\r\n                  width: '100%',\r\n                  opacity: (isProcessing || !imageUrl.trim()) ? 0.6 : 1,\r\n                  boxShadow: 'none !important',\r\n                  WebkitBoxShadow: 'none',\r\n                  MozBoxShadow: 'none',\r\n                  filter: 'none',\r\n                  outline: 'none',\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'center',\r\n                  textAlign: 'center'\r\n                }}\r\n              >\r\n                {isProcessing ? 'Analyzing...' : 'Analyze with WiHy'}\r\n              </button>\r\n            </div>\r\n          </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ImageUploadModal;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}