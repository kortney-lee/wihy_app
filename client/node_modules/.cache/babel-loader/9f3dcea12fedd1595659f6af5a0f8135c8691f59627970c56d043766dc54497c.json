{"ast":null,"code":"// src/components/ImageUploadModal.tsx\nimport React,{useState,useRef,useCallback}from'react';import'./Spinner.css';import'../styles/VHealthSearch.css';import{visionAnalysisService}from'../services/visionAnalysisService';import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const ImageUploadModal=_ref=>{let{isOpen,onClose,onAnalysisComplete,// Updated prop name\ntitle=\"Analyze Image\",subtitle=\"Upload or capture images for comprehensive analysis\"}=_ref;// ALL HOOKS MUST BE CALLED BEFORE ANY CONDITIONAL RETURNS\nconst[isDragging,setIsDragging]=useState(false);const[imageUrl,setImageUrl]=useState('');const[isProcessing,setIsProcessing]=useState(false);const[showCamera,setShowCamera]=useState(false);const[stream,setStream]=useState(null);const[cameraError,setCameraError]=useState('');const videoRef=useRef(null);const canvasRef=useRef(null);// Process file and analyze it with Vision Analysis Service\nconst processFile=useCallback(async file=>{console.log('🔍 STEP 1: File received:',{name:file.name,type:file.type,size:file.size});setIsProcessing(true);try{console.log('🔍 STEP 2: Using Vision Analysis Service for comprehensive analysis...');// Use Vision Analysis Service for comprehensive detection\nconst visionResult=await visionAnalysisService.analyzeImage(file);console.log('🔍 STEP 3: Vision analysis result:',visionResult);let analysisText='Image analyzed';if(visionResult.success&&visionResult.data){// Format comprehensive analysis results\nanalysisText=visionAnalysisService.formatForDisplay(visionResult);// Also try the original WiHy API for additional context\ntry{var _wihyResult$data,_wihyResult$data$ai_r;console.log('🔍 STEP 4: Also checking WiHy API for additional context...');const{wihyAPI}=await import('../services/wihyAPI');const wihyResult=await wihyAPI.scanFood(file);if(wihyResult.success&&'data'in wihyResult&&(_wihyResult$data=wihyResult.data)!==null&&_wihyResult$data!==void 0&&(_wihyResult$data$ai_r=_wihyResult$data.ai_response)!==null&&_wihyResult$data$ai_r!==void 0&&_wihyResult$data$ai_r.response){analysisText=\"\".concat(analysisText,\"\\n\\nAI Health Analysis: \").concat(wihyResult.data.ai_response.response);}}catch(wihyError){console.log('ℹ️ WiHy API not available, using Vision Analysis results only');}}else{console.log('❌ Vision analysis failed, falling back to basic analysis');analysisText=visionResult.error||'Image analysis unavailable';}console.log('🔍 STEP 5: Final analysis text:',analysisText);console.log('🔍 STEP 6: Triggering analysis completion...');onAnalysisComplete(analysisText);}catch(error){console.error('❌ Error in processFile:',error);onAnalysisComplete('Analysis failed. Please try again.');}finally{setIsProcessing(false);}},[onAnalysisComplete]);// Camera functions\nconst startCamera=useCallback(async()=>{try{setCameraError('');const mediaStream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment',// Use back camera on mobile\nwidth:{ideal:1280},height:{ideal:720}}});setStream(mediaStream);if(videoRef.current){videoRef.current.srcObject=mediaStream;}}catch(error){console.error('Camera access error:',error);setCameraError('Unable to access camera. Please check permissions.');}},[]);const stopCamera=useCallback(()=>{if(stream){stream.getTracks().forEach(track=>track.stop());setStream(null);}setShowCamera(false);},[stream]);const capturePhoto=useCallback(async()=>{if(!videoRef.current||!canvasRef.current)return;const video=videoRef.current;const canvas=canvasRef.current;const context=canvas.getContext('2d');if(!context)return;// Set canvas dimensions to match video\ncanvas.width=video.videoWidth;canvas.height=video.videoHeight;// Draw current video frame to canvas\ncontext.drawImage(video,0,0,canvas.width,canvas.height);// Convert canvas to blob and then to File\ncanvas.toBlob(async blob=>{if(blob){const file=new File([blob],'camera-capture.jpg',{type:'image/jpeg'});await processFile(file);stopCamera();}},'image/jpeg',0.9);},[processFile,stopCamera]);const handleCameraToggle=useCallback(()=>{if(showCamera){stopCamera();}else{setShowCamera(true);startCamera();}},[showCamera,stopCamera,startCamera]);// Handle file drop\nconst handleDrop=useCallback(async e=>{e.preventDefault();setIsDragging(false);const files=Array.from(e.dataTransfer.files);const imageFile=files.find(file=>file.type.startsWith('image/'));if(imageFile){await processFile(imageFile);}else{alert('Please upload an image file (JPG, PNG, GIF, etc.)');}},[processFile]);// Handle drag events\nconst handleDragOver=useCallback(e=>{e.preventDefault();setIsDragging(true);},[]);const handleDragLeave=useCallback(e=>{e.preventDefault();setIsDragging(false);},[]);// Handle file input\nconst handleFileInput=useCallback(async e=>{var _e$target$files;console.log('📁 File input triggered');const file=(_e$target$files=e.target.files)===null||_e$target$files===void 0?void 0:_e$target$files[0];console.log('📁 Selected file:',file);if(file){await processFile(file);}else{console.log('❌ No file selected');}},[processFile]);// Handle URL upload\nconst handleUrlUpload=useCallback(async()=>{if(!imageUrl.trim()){alert('Please enter a valid image URL');return;}setIsProcessing(true);try{const response=await fetch(imageUrl);const blob=await response.blob();if(!blob.type.startsWith('image/')){throw new Error('URL does not point to an image');}const file=new File([blob],'uploaded-image.jpg',{type:blob.type});await processFile(file);}catch(error){console.error('Error loading image from URL:',error);alert('Failed to load image from URL. Please check the URL and try again.');}finally{setIsProcessing(false);}},[imageUrl,processFile]);// Handle modal close\nconst handleClose=useCallback(()=>{if(!isProcessing){stopCamera();// Clean up camera resources\nonClose();setImageUrl('');setIsDragging(false);setShowCamera(false);setCameraError('');}},[isProcessing,stopCamera,onClose]);// Return null if modal is not open (AFTER all hooks are called)\nif(!isOpen)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"photo-modal-overlay \".concat(isOpen?'open':''),onClick:handleClose,children:/*#__PURE__*/_jsxs(\"div\",{className:\"photo-modal\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"div\",{className:\"modal-header-simple\",children:/*#__PURE__*/_jsx(\"button\",{className:\"modal-close-simple\",onClick:handleClose,\"aria-label\":\"Close\",disabled:isProcessing,children:\"\\xD7\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"simple-upload-container\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"simple-title\",children:\"Analyze any image\"}),!showCamera?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"simple-upload-area \".concat(isDragging?'dragging':'',\" \").concat(isProcessing?'processing':''),onDrop:handleDrop,onDragOver:handleDragOver,onDragLeave:handleDragLeave,children:[/*#__PURE__*/_jsx(\"div\",{className:\"simple-upload-content\",children:isProcessing?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"simple-spinner\",children:/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"})}),/*#__PURE__*/_jsx(\"p\",{className:\"simple-upload-text\",children:\"Analyzing image...\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"simple-upload-icon\",children:/*#__PURE__*/_jsx(\"svg\",{viewBox:\"0 0 24 24\",fill:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z\"})})}),/*#__PURE__*/_jsxs(\"p\",{className:\"simple-upload-text\",children:[isDragging?'Drop image here':'Drag an image here or',' ',/*#__PURE__*/_jsx(\"span\",{className:\"upload-link\",onClick:()=>{var _document$getElementB;return(_document$getElementB=document.getElementById('modal-file-input'))===null||_document$getElementB===void 0?void 0:_document$getElementB.click();},children:\"upload a file\"})]})]})}),/*#__PURE__*/_jsx(\"input\",{id:\"modal-file-input\",type:\"file\",accept:\"image/*\",style:{display:'none'},onChange:handleFileInput,disabled:isProcessing,capture:\"environment\"// Mobile camera hint\n})]}),/*#__PURE__*/_jsx(\"div\",{className:\"camera-toggle-section\",style:{marginBottom:'16px',textAlign:'center',display:'flex',justifyContent:'center',width:'100%'},children:/*#__PURE__*/_jsx(\"div\",{className:\"wihy-btn-wrapper\",style:{display:'inline-block',animation:isProcessing?'none':'wiH-border-sweep 2.2s linear infinite',background:isProcessing?'linear-gradient(#f3f4f6, #f3f4f6)':'linear-gradient(#fff, #fff) padding-box, linear-gradient(90deg, #fa5f06, #ffffff, #C0C0C0, #4cbb17) border-box',backgroundSize:'100% 100%, 200% 100%',border:'2px solid transparent',borderRadius:'28px',minWidth:'240px',width:'60%',maxWidth:'300px'},children:/*#__PURE__*/_jsx(\"button\",{className:\"analyze-wihy-btn\",onClick:handleCameraToggle,disabled:isProcessing,style:{background:'transparent',border:'none',borderRadius:'28px',padding:'18px 36px',fontSize:'20px',fontWeight:'700',cursor:isProcessing?'not-allowed':'pointer',boxShadow:'none',transform:'none',color:'#1a73e8',width:'100%',letterSpacing:'0.5px',textAlign:'center',display:'flex',alignItems:'center',justifyContent:'center'},children:\"Use Camera\"})})})]}):/*#__PURE__*//* Camera Section */_jsx(\"div\",{className:\"camera-section\",children:cameraError?/*#__PURE__*/_jsxs(\"div\",{className:\"camera-error\",children:[/*#__PURE__*/_jsx(\"p\",{children:cameraError}),/*#__PURE__*/_jsx(\"button\",{onClick:startCamera,className:\"retry-button\",children:\"Try Again\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"camera-container\",children:[/*#__PURE__*/_jsx(\"video\",{ref:videoRef,autoPlay:true,playsInline:true,className:\"camera-video\"}),stream&&!isProcessing&&/*#__PURE__*/_jsx(\"div\",{className:\"wihy-btn-wrapper\",style:{display:'inline-block',animation:'wiH-border-sweep 2.2s linear infinite',background:'linear-gradient(#fff, #fff) padding-box, linear-gradient(90deg, #fa5f06, #ffffff, #C0C0C0, #4cbb17) border-box',backgroundSize:'100% 100%, 200% 100%',border:'2px solid transparent',borderRadius:'24px',position:'absolute',bottom:'20px',left:'50%',transform:'translateX(-50%)',minWidth:'180px'},children:/*#__PURE__*/_jsx(\"button\",{className:\"analyze-wihy-btn\",onClick:capturePhoto,disabled:isProcessing,style:{background:'transparent',border:'none',borderRadius:'24px',padding:'14px 28px',fontSize:'16px',fontWeight:'600',cursor:'pointer',boxShadow:'none',transform:'none',color:'#1a73e8',width:'100%'},children:\"Capture & Analyze\"})}),isProcessing&&/*#__PURE__*/_jsxs(\"div\",{className:\"camera-processing\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Analyzing image...\"})]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"back-to-upload-button\",onClick:handleCameraToggle,disabled:isProcessing,style:{background:'#f8f9fa',border:'1px solid #dadce0',borderRadius:'24px',padding:'12px 24px',fontSize:'14px',fontWeight:'500',cursor:isProcessing?'not-allowed':'pointer',color:'#5f6368',marginTop:'20px',marginBottom:'20px'},children:\"Back to Upload\"}),/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,style:{display:'none'}})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"simple-url-section\",style:{marginBottom:'30px',textAlign:'center'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"url\",placeholder:\"Paste image link\",className:\"simple-url-input\",value:imageUrl,onChange:e=>setImageUrl(e.target.value),onKeyPress:e=>{if(e.key==='Enter'){handleUrlUpload();}},disabled:isProcessing,style:{marginBottom:'16px'}}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'center',width:'100%'},children:/*#__PURE__*/_jsx(\"div\",{className:\"wihy-btn-wrapper\",style:{display:'inline-block',animation:isProcessing||!imageUrl.trim()?'none':'wiH-border-sweep 2.2s linear infinite',background:isProcessing||!imageUrl.trim()?'linear-gradient(#f3f4f6, #f3f4f6)':'linear-gradient(#fff, #fff) padding-box, linear-gradient(90deg, #fa5f06, #ffffff, #C0C0C0, #4cbb17) border-box',backgroundSize:'100% 100%, 200% 100%',border:'2px solid transparent',borderRadius:'28px',minWidth:'240px',width:'60%',maxWidth:'300px'},children:/*#__PURE__*/_jsx(\"button\",{className:\"analyze-wihy-btn\",onClick:handleUrlUpload,disabled:isProcessing||!imageUrl.trim(),style:{background:'transparent',border:'none',borderRadius:'28px',padding:'18px 36px',fontSize:'20px',fontWeight:'700',cursor:isProcessing||!imageUrl.trim()?'not-allowed':'pointer',boxShadow:'none',transform:'none',color:isProcessing||!imageUrl.trim()?'#9ca3af':'#1a73e8',width:'100%',letterSpacing:'0.5px',textAlign:'center',display:'flex',alignItems:'center',justifyContent:'center'},children:isProcessing?'Analyzing...':'Analyze with WiHy'})})})]})]})});};export default ImageUploadModal;","map":{"version":3,"names":["React","useState","useRef","useCallback","visionAnalysisService","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","ImageUploadModal","_ref","isOpen","onClose","onAnalysisComplete","title","subtitle","isDragging","setIsDragging","imageUrl","setImageUrl","isProcessing","setIsProcessing","showCamera","setShowCamera","stream","setStream","cameraError","setCameraError","videoRef","canvasRef","processFile","file","console","log","name","type","size","visionResult","analyzeImage","analysisText","success","data","formatForDisplay","_wihyResult$data","_wihyResult$data$ai_r","wihyAPI","wihyResult","scanFood","ai_response","response","concat","wihyError","error","startCamera","mediaStream","navigator","mediaDevices","getUserMedia","video","facingMode","width","ideal","height","current","srcObject","stopCamera","getTracks","forEach","track","stop","capturePhoto","canvas","context","getContext","videoWidth","videoHeight","drawImage","toBlob","blob","File","handleCameraToggle","handleDrop","e","preventDefault","files","Array","from","dataTransfer","imageFile","find","startsWith","alert","handleDragOver","handleDragLeave","handleFileInput","_e$target$files","target","handleUrlUpload","trim","fetch","Error","handleClose","className","onClick","children","stopPropagation","disabled","onDrop","onDragOver","onDragLeave","viewBox","fill","d","_document$getElementB","document","getElementById","click","id","accept","style","display","onChange","capture","marginBottom","textAlign","justifyContent","animation","background","backgroundSize","border","borderRadius","minWidth","maxWidth","padding","fontSize","fontWeight","cursor","boxShadow","transform","color","letterSpacing","alignItems","ref","autoPlay","playsInline","position","bottom","left","marginTop","placeholder","value","onKeyPress","key"],"sources":["C:/repo/wihy_ui/client/src/components/ImageUploadModal.tsx"],"sourcesContent":["// src/components/ImageUploadModal.tsx\r\nimport React, { useState, useRef, useCallback } from 'react';\r\nimport './Spinner.css';\r\nimport '../styles/VHealthSearch.css';\r\nimport { visionAnalysisService } from '../services/visionAnalysisService';\r\n\r\ninterface ImageUploadModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onAnalysisComplete: (foodName: string) => void; // Changed from onFileSelect\r\n  title?: string;\r\n  subtitle?: string;\r\n}\r\n\r\nconst ImageUploadModal: React.FC<ImageUploadModalProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  onAnalysisComplete, // Updated prop name\r\n  title = \"Analyze Image\",\r\n  subtitle = \"Upload or capture images for comprehensive analysis\"\r\n}) => {\r\n  // ALL HOOKS MUST BE CALLED BEFORE ANY CONDITIONAL RETURNS\r\n  const [isDragging, setIsDragging] = useState(false);\r\n  const [imageUrl, setImageUrl] = useState('');\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [showCamera, setShowCamera] = useState(false);\r\n  const [stream, setStream] = useState<MediaStream | null>(null);\r\n  const [cameraError, setCameraError] = useState<string>('');\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n\r\n  // Process file and analyze it with Vision Analysis Service\r\n  const processFile = useCallback(async (file: File) => {\r\n    console.log('🔍 STEP 1: File received:', {\r\n      name: file.name,\r\n      type: file.type,\r\n      size: file.size\r\n    });\r\n    \r\n    setIsProcessing(true);\r\n    \r\n    try {\r\n      console.log('🔍 STEP 2: Using Vision Analysis Service for comprehensive analysis...');\r\n      \r\n      // Use Vision Analysis Service for comprehensive detection\r\n      const visionResult = await visionAnalysisService.analyzeImage(file);\r\n      console.log('🔍 STEP 3: Vision analysis result:', visionResult);\r\n      \r\n      let analysisText = 'Image analyzed';\r\n      \r\n      if (visionResult.success && visionResult.data) {\r\n        // Format comprehensive analysis results\r\n        analysisText = visionAnalysisService.formatForDisplay(visionResult);\r\n        \r\n        // Also try the original WiHy API for additional context\r\n        try {\r\n          console.log('🔍 STEP 4: Also checking WiHy API for additional context...');\r\n          const { wihyAPI } = await import('../services/wihyAPI');\r\n          const wihyResult = await wihyAPI.scanFood(file);\r\n          \r\n          if (wihyResult.success && 'data' in wihyResult && wihyResult.data?.ai_response?.response) {\r\n            analysisText = `${analysisText}\\n\\nAI Health Analysis: ${wihyResult.data.ai_response.response}`;\r\n          }\r\n        } catch (wihyError) {\r\n          console.log('ℹ️ WiHy API not available, using Vision Analysis results only');\r\n        }\r\n      } else {\r\n        console.log('❌ Vision analysis failed, falling back to basic analysis');\r\n        analysisText = visionResult.error || 'Image analysis unavailable';\r\n      }\r\n      \r\n      console.log('🔍 STEP 5: Final analysis text:', analysisText);\r\n      console.log('🔍 STEP 6: Triggering analysis completion...');\r\n      \r\n      onAnalysisComplete(analysisText);\r\n      \r\n    } catch (error) {\r\n      console.error('❌ Error in processFile:', error);\r\n      onAnalysisComplete('Analysis failed. Please try again.');\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  }, [onAnalysisComplete]);\r\n\r\n  // Camera functions\r\n  const startCamera = useCallback(async () => {\r\n    try {\r\n      setCameraError('');\r\n      const mediaStream = await navigator.mediaDevices.getUserMedia({\r\n        video: { \r\n          facingMode: 'environment', // Use back camera on mobile\r\n          width: { ideal: 1280 },\r\n          height: { ideal: 720 }\r\n        }\r\n      });\r\n      \r\n      setStream(mediaStream);\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = mediaStream;\r\n      }\r\n    } catch (error) {\r\n      console.error('Camera access error:', error);\r\n      setCameraError('Unable to access camera. Please check permissions.');\r\n    }\r\n  }, []);\r\n\r\n  const stopCamera = useCallback(() => {\r\n    if (stream) {\r\n      stream.getTracks().forEach(track => track.stop());\r\n      setStream(null);\r\n    }\r\n    setShowCamera(false);\r\n  }, [stream]);\r\n\r\n  const capturePhoto = useCallback(async () => {\r\n    if (!videoRef.current || !canvasRef.current) return;\r\n\r\n    const video = videoRef.current;\r\n    const canvas = canvasRef.current;\r\n    const context = canvas.getContext('2d');\r\n\r\n    if (!context) return;\r\n\r\n    // Set canvas dimensions to match video\r\n    canvas.width = video.videoWidth;\r\n    canvas.height = video.videoHeight;\r\n\r\n    // Draw current video frame to canvas\r\n    context.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n\r\n    // Convert canvas to blob and then to File\r\n    canvas.toBlob(async (blob) => {\r\n      if (blob) {\r\n        const file = new File([blob], 'camera-capture.jpg', { type: 'image/jpeg' });\r\n        await processFile(file);\r\n        stopCamera();\r\n      }\r\n    }, 'image/jpeg', 0.9);\r\n  }, [processFile, stopCamera]);\r\n\r\n  const handleCameraToggle = useCallback(() => {\r\n    if (showCamera) {\r\n      stopCamera();\r\n    } else {\r\n      setShowCamera(true);\r\n      startCamera();\r\n    }\r\n  }, [showCamera, stopCamera, startCamera]);\r\n\r\n  // Handle file drop\r\n  const handleDrop = useCallback(async (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragging(false);\r\n    \r\n    const files = Array.from(e.dataTransfer.files);\r\n    const imageFile = files.find(file => file.type.startsWith('image/'));\r\n    \r\n    if (imageFile) {\r\n      await processFile(imageFile);\r\n    } else {\r\n      alert('Please upload an image file (JPG, PNG, GIF, etc.)');\r\n    }\r\n  }, [processFile]);\r\n\r\n  // Handle drag events\r\n  const handleDragOver = useCallback((e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragging(true);\r\n  }, []);\r\n\r\n  const handleDragLeave = useCallback((e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragging(false);\r\n  }, []);\r\n\r\n  // Handle file input\r\n  const handleFileInput = useCallback(async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    console.log('📁 File input triggered');\r\n    const file = e.target.files?.[0];\r\n    console.log('📁 Selected file:', file);\r\n    if (file) {\r\n      await processFile(file);\r\n    } else {\r\n      console.log('❌ No file selected');\r\n    }\r\n  }, [processFile]);\r\n\r\n  // Handle URL upload\r\n  const handleUrlUpload = useCallback(async () => {\r\n    if (!imageUrl.trim()) {\r\n      alert('Please enter a valid image URL');\r\n      return;\r\n    }\r\n\r\n    setIsProcessing(true);\r\n    try {\r\n      const response = await fetch(imageUrl);\r\n      const blob = await response.blob();\r\n      \r\n      if (!blob.type.startsWith('image/')) {\r\n        throw new Error('URL does not point to an image');\r\n      }\r\n\r\n      const file = new File([blob], 'uploaded-image.jpg', { type: blob.type });\r\n      await processFile(file);\r\n    } catch (error) {\r\n      console.error('Error loading image from URL:', error);\r\n      alert('Failed to load image from URL. Please check the URL and try again.');\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  }, [imageUrl, processFile]);\r\n\r\n  // Handle modal close\r\n  const handleClose = useCallback(() => {\r\n    if (!isProcessing) {\r\n      stopCamera(); // Clean up camera resources\r\n      onClose();\r\n      setImageUrl('');\r\n      setIsDragging(false);\r\n      setShowCamera(false);\r\n      setCameraError('');\r\n    }\r\n  }, [isProcessing, stopCamera, onClose]);\r\n\r\n  // Return null if modal is not open (AFTER all hooks are called)\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className={`photo-modal-overlay ${isOpen ? 'open' : ''}`} onClick={handleClose}>\r\n      <div className=\"photo-modal\" onClick={(e) => e.stopPropagation()}>\r\n        <div className=\"modal-header-simple\">\r\n          <button \r\n            className=\"modal-close-simple\"\r\n            onClick={handleClose}\r\n            aria-label=\"Close\"\r\n            disabled={isProcessing}\r\n          >\r\n            ×\r\n          </button>\r\n        </div>\r\n        \r\n        {/* Simple Upload Area */}\r\n        <div className=\"simple-upload-container\">\r\n          <h2 className=\"simple-title\">Analyze any image</h2>\r\n          \r\n          {!showCamera ? (\r\n            <>\r\n              <div \r\n                className={`simple-upload-area ${isDragging ? 'dragging' : ''} ${isProcessing ? 'processing' : ''}`}\r\n                onDrop={handleDrop}\r\n                onDragOver={handleDragOver}\r\n                onDragLeave={handleDragLeave}\r\n              >\r\n                <div className=\"simple-upload-content\">\r\n                  {isProcessing ? (\r\n                    <>\r\n                      <div className=\"simple-spinner\">\r\n                        <div className=\"spinner\"></div>\r\n                      </div>\r\n                      <p className=\"simple-upload-text\">Analyzing image...</p>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <div className=\"simple-upload-icon\">\r\n                        <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                          <path d=\"M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z\"/>\r\n                        </svg>\r\n                      </div>\r\n                      <p className=\"simple-upload-text\">\r\n                        {isDragging ? 'Drop image here' : 'Drag an image here or'}{' '}\r\n                        <span \r\n                          className=\"upload-link\"\r\n                          onClick={() => document.getElementById('modal-file-input')?.click()}\r\n                        >\r\n                          upload a file\r\n                        </span>\r\n                      </p>\r\n                    </>\r\n                  )}\r\n                </div>\r\n                \r\n                <input\r\n                  id=\"modal-file-input\"\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  style={{ display: 'none' }}\r\n                  onChange={handleFileInput}\r\n                  disabled={isProcessing}\r\n                  capture=\"environment\" // Mobile camera hint\r\n                />\r\n              </div>\r\n              \r\n              {/* Camera Toggle Button */}\r\n              <div className=\"camera-toggle-section\" style={{ \r\n                marginBottom: '16px', \r\n                textAlign: 'center',\r\n                display: 'flex',\r\n                justifyContent: 'center',\r\n                width: '100%'\r\n              }}>\r\n                <div className=\"wihy-btn-wrapper\" style={{\r\n                  display: 'inline-block',\r\n                  animation: isProcessing ? 'none' : 'wiH-border-sweep 2.2s linear infinite',\r\n                  background: isProcessing \r\n                    ? 'linear-gradient(#f3f4f6, #f3f4f6)' \r\n                    : 'linear-gradient(#fff, #fff) padding-box, linear-gradient(90deg, #fa5f06, #ffffff, #C0C0C0, #4cbb17) border-box',\r\n                  backgroundSize: '100% 100%, 200% 100%',\r\n                  border: '2px solid transparent',\r\n                  borderRadius: '28px',\r\n                  minWidth: '240px',\r\n                  width: '60%',\r\n                  maxWidth: '300px'\r\n                }}>\r\n                  <button \r\n                    className=\"analyze-wihy-btn\"\r\n                    onClick={handleCameraToggle}\r\n                    disabled={isProcessing}\r\n                    style={{\r\n                      background: 'transparent',\r\n                      border: 'none',\r\n                      borderRadius: '28px',\r\n                      padding: '18px 36px',\r\n                      fontSize: '20px',\r\n                      fontWeight: '700',\r\n                      cursor: isProcessing ? 'not-allowed' : 'pointer',\r\n                      boxShadow: 'none',\r\n                      transform: 'none',\r\n                      color: '#1a73e8',\r\n                      width: '100%',\r\n                      letterSpacing: '0.5px',\r\n                      textAlign: 'center',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      justifyContent: 'center'\r\n                    }}\r\n                  >\r\n                    Use Camera\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </>\r\n          ) : (\r\n            /* Camera Section */\r\n            <div className=\"camera-section\">\r\n              {cameraError ? (\r\n                <div className=\"camera-error\">\r\n                  <p>{cameraError}</p>\r\n                  <button onClick={startCamera} className=\"retry-button\">Try Again</button>\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  <div className=\"camera-container\">\r\n                    <video\r\n                      ref={videoRef}\r\n                      autoPlay\r\n                      playsInline\r\n                      className=\"camera-video\"\r\n                    />\r\n                    {stream && !isProcessing && (\r\n                      <div className=\"wihy-btn-wrapper\" style={{\r\n                        display: 'inline-block',\r\n                        animation: 'wiH-border-sweep 2.2s linear infinite',\r\n                        background: 'linear-gradient(#fff, #fff) padding-box, linear-gradient(90deg, #fa5f06, #ffffff, #C0C0C0, #4cbb17) border-box',\r\n                        backgroundSize: '100% 100%, 200% 100%',\r\n                        border: '2px solid transparent',\r\n                        borderRadius: '24px',\r\n                        position: 'absolute',\r\n                        bottom: '20px',\r\n                        left: '50%',\r\n                        transform: 'translateX(-50%)',\r\n                        minWidth: '180px'\r\n                      }}>\r\n                        <button\r\n                          className=\"analyze-wihy-btn\"\r\n                          onClick={capturePhoto}\r\n                          disabled={isProcessing}\r\n                          style={{\r\n                            background: 'transparent',\r\n                            border: 'none',\r\n                            borderRadius: '24px',\r\n                            padding: '14px 28px',\r\n                            fontSize: '16px',\r\n                            fontWeight: '600',\r\n                            cursor: 'pointer',\r\n                            boxShadow: 'none',\r\n                            transform: 'none',\r\n                            color: '#1a73e8',\r\n                            width: '100%'\r\n                          }}\r\n                        >\r\n                          Capture & Analyze\r\n                        </button>\r\n                      </div>\r\n                    )}\r\n                    {isProcessing && (\r\n                      <div className=\"camera-processing\">\r\n                        <div className=\"spinner\"></div>\r\n                        <p>Analyzing image...</p>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  \r\n                  <button \r\n                    className=\"back-to-upload-button\"\r\n                    onClick={handleCameraToggle}\r\n                    disabled={isProcessing}\r\n                    style={{\r\n                      background: '#f8f9fa',\r\n                      border: '1px solid #dadce0',\r\n                      borderRadius: '24px',\r\n                      padding: '12px 24px',\r\n                      fontSize: '14px',\r\n                      fontWeight: '500',\r\n                      cursor: isProcessing ? 'not-allowed' : 'pointer',\r\n                      color: '#5f6368',\r\n                      marginTop: '20px',\r\n                      marginBottom: '20px'\r\n                    }}\r\n                  >\r\n                    Back to Upload\r\n                  </button>\r\n                  \r\n                  <canvas\r\n                    ref={canvasRef}\r\n                    style={{ display: 'none' }}\r\n                  />\r\n                </>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n        \r\n        <div className=\"simple-url-section\" style={{ marginBottom: '30px', textAlign: 'center' }}>\r\n          <input\r\n            type=\"url\"\r\n            placeholder=\"Paste image link\"\r\n            className=\"simple-url-input\"\r\n            value={imageUrl}\r\n            onChange={(e) => setImageUrl(e.target.value)}\r\n            onKeyPress={(e) => {\r\n              if (e.key === 'Enter') {\r\n                handleUrlUpload();\r\n              }\r\n            }}\r\n            disabled={isProcessing}\r\n            style={{ marginBottom: '16px' }}\r\n          />\r\n          <div style={{ \r\n            display: 'flex', \r\n            justifyContent: 'center', \r\n            width: '100%' \r\n          }}>\r\n            <div className=\"wihy-btn-wrapper\" style={{\r\n              display: 'inline-block',\r\n              animation: (isProcessing || !imageUrl.trim()) ? 'none' : 'wiH-border-sweep 2.2s linear infinite',\r\n              background: (isProcessing || !imageUrl.trim()) \r\n                ? 'linear-gradient(#f3f4f6, #f3f4f6)' \r\n                : 'linear-gradient(#fff, #fff) padding-box, linear-gradient(90deg, #fa5f06, #ffffff, #C0C0C0, #4cbb17) border-box',\r\n              backgroundSize: '100% 100%, 200% 100%',\r\n              border: '2px solid transparent',\r\n              borderRadius: '28px',\r\n              minWidth: '240px',\r\n              width: '60%',\r\n              maxWidth: '300px'\r\n            }}>\r\n              <button \r\n                className=\"analyze-wihy-btn\"\r\n                onClick={handleUrlUpload}\r\n                disabled={isProcessing || !imageUrl.trim()}\r\n                style={{\r\n                  background: 'transparent',\r\n                  border: 'none',\r\n                  borderRadius: '28px',\r\n                  padding: '18px 36px',\r\n                  fontSize: '20px',\r\n                  fontWeight: '700',\r\n                  cursor: isProcessing || !imageUrl.trim() ? 'not-allowed' : 'pointer',\r\n                  boxShadow: 'none',\r\n                  transform: 'none',\r\n                  color: (isProcessing || !imageUrl.trim()) ? '#9ca3af' : '#1a73e8',\r\n                  width: '100%',\r\n                  letterSpacing: '0.5px',\r\n                  textAlign: 'center',\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'center'\r\n                }}\r\n              >\r\n                {isProcessing ? 'Analyzing...' : 'Analyze with WiHy'}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ImageUploadModal;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}