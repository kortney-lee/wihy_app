{"ast":null,"code":"import React,{useState,useRef,useEffect}from'react';import{useNavigate}from'react-router-dom';import'./VHealthSearch.css';import ImageUploadModal from'./components/ImageUploadModal';import MultiAuthLogin from'./components/shared/components/MultiAuthLogin';import{healthSearchService}from'./services/healthSearchService';import HealthNewsFeed from'./components/HealthNewsFeed';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const VHealthSearch=()=>{const[searchQuery,setSearchQuery]=useState('');const[isListening,setIsListening]=useState(false);const[isUploadModalOpen,setIsUploadModalOpen]=useState(false);const[isLoading,setIsLoading]=useState(false);const[imageError,setImageError]=useState(false);const[loadingMessage,setLoadingMessage]=useState('Searching...');const[showFeelingHealthyContent,setShowFeelingHealthyContent]=useState(false);const navigate=useNavigate();const searchInputRef=useRef(null);const recognitionRef=useRef(null);const progressFromMessage=msg=>{if(msg.includes('Initializing'))return 10;if(msg.includes('Checking cache'))return 25;if(msg.includes('Analyzing with AI'))return 55;if(msg.includes('Processing results'))return 75;if(msg.includes('Results ready')||msg.includes('Response ready'))return 95;if(msg.includes('Processing image'))return 35;if(msg.includes('Checking nutrition'))return 45;if(msg.includes('Analyzing nutrition'))return 60;if(msg.includes('Processing nutrition'))return 80;if(msg.includes('complete'))return 95;if(msg.includes('failed'))return 100;// will close shortly\nreturn 40;// default midpoint\n};const handleUserChange=user=>{console.log('User changed:',user);};const handleSignIn=user=>{console.log('User signed in:',user);};const handleSignOut=()=>{console.log('User signed out');};// Simplified search handler\nconst handleSearch=async()=>{if(!searchQuery.trim()||isLoading)return;setIsLoading(true);setLoadingMessage('Initializing search...');try{// Step 1: Check database cache first\nsetLoadingMessage('Checking cache...');try{const response=await fetch(\"http://localhost:5000/api/cache/get?q=\".concat(encodeURIComponent(searchQuery)));if(response.ok){const cachedData=await response.json();console.log('Using cached results from database');setLoadingMessage('Loading cached results...');await new Promise(resolve=>setTimeout(resolve,300));setIsLoading(false);navigate(\"/results?q=\".concat(encodeURIComponent(searchQuery),\"&cached=true\"));return;}}catch(cacheError){console.log('No cache found, proceeding with API call');}// Step 2: Get fresh results from API\nsetLoadingMessage('Analyzing with AI...');console.log('Getting fresh results for:',searchQuery);try{const searchResults=await healthSearchService.searchHealthInfo(searchQuery);console.log('Health search results received:',searchResults);const isValidResult=searchResults&&typeof searchResults==='object'&&searchResults!==null&&(searchResults.summary||searchResults.details||Object.keys(searchResults).length>0);if(isValidResult){console.log('Valid results confirmed');// Step 3: Save to database cache (async, don't wait)\nsetLoadingMessage('Caching results...');fetch('http://localhost:5000/api/cache/save',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({query:searchQuery,results:searchResults,source:'openai'})}).then(response=>{if(response.ok){console.log('Results saved to database cache');}else{console.warn('Failed to save to cache');}}).catch(err=>{console.warn('Cache save error:',err);});setLoadingMessage('Results ready!');await new Promise(resolve=>setTimeout(resolve,300));setIsLoading(false);console.log('Navigating to results page');navigate(\"/results?q=\".concat(encodeURIComponent(searchQuery)));return;}else{throw new Error('Invalid results from API');}}catch(apiError){console.error('Health search service failed:',apiError);// Step 4: Try similar results as fallback\nsetLoadingMessage('Searching for similar results...');try{const similarResponse=await fetch(\"http://localhost:5000/api/cache/similar?q=\".concat(encodeURIComponent(searchQuery)));if(similarResponse.ok){const similarResults=await similarResponse.json();if(similarResults.length>0){console.log('Using similar cached results');setLoadingMessage('Loading similar results...');await new Promise(resolve=>setTimeout(resolve,300));setIsLoading(false);navigate(\"/results?q=\".concat(encodeURIComponent(searchQuery),\"&similar=true\"));return;}}}catch(similarError){console.warn('Similar results search failed:',similarError);}setLoadingMessage('No results found. Please try a different search.');setTimeout(()=>{setIsLoading(false);setLoadingMessage('Searching...');},3000);return;}}catch(error){console.error(\"Search error:\",error);setLoadingMessage('Search failed. Please try again.');setTimeout(()=>{setIsLoading(false);setLoadingMessage('Searching...');},2000);}};const handleAnalysisComplete=async foodName=>{if(!foodName||isLoading){setIsUploadModalOpen(false);return;}setIsLoading(true);setLoadingMessage('Processing image analysis...');try{console.log(\"Image analysis completed, food detected:\",foodName);setSearchQuery(foodName);// Step 1: Check database cache for nutrition data\nsetLoadingMessage('Checking nutrition database...');try{const response=await fetch(\"http://localhost:5000/api/cache/get?q=\".concat(encodeURIComponent(foodName)));if(response.ok){const cachedData=await response.json();console.log('Using cached nutrition data');setLoadingMessage('Loading cached nutrition data...');await new Promise(resolve=>setTimeout(resolve,300));setIsLoading(false);navigate(\"/results?q=\".concat(encodeURIComponent(foodName),\"&cached=true\"));return;}}catch(cacheError){console.log('No cached nutrition data found');}// Step 2: Get fresh nutrition data\nsetLoadingMessage('Analyzing nutrition content...');try{const nutritionResults=await healthSearchService.searchHealthInfo(foodName);const isValidResult=nutritionResults&&typeof nutritionResults==='object'&&nutritionResults!==null&&(nutritionResults.summary||nutritionResults.details||Object.keys(nutritionResults).length>0);if(isValidResult){// Step 3: Save to database cache (async, don't wait)\nsetLoadingMessage('Caching nutrition data...');fetch('http://localhost:5000/api/cache/save',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({query:foodName,results:nutritionResults,source:'image-analysis'})}).then(response=>{if(response.ok){console.log('Nutrition data saved to cache');}else{console.warn('Failed to save nutrition data to cache');}}).catch(err=>{console.warn('Nutrition cache save error:',err);});setLoadingMessage('Nutrition analysis complete!');await new Promise(resolve=>setTimeout(resolve,300));setIsLoading(false);navigate(\"/results?q=\".concat(encodeURIComponent(foodName)));return;}else{throw new Error('Invalid nutrition results');}}catch(nutritionError){console.error('Nutrition analysis failed:',nutritionError);// Try similar results as fallback\ntry{const similarResponse=await fetch(\"http://localhost:5000/api/cache/similar?q=\".concat(encodeURIComponent(foodName)));if(similarResponse.ok){const similarResults=await similarResponse.json();if(similarResults.length>0){console.log('Using similar nutrition data');setLoadingMessage('Loading similar nutrition data...');await new Promise(resolve=>setTimeout(resolve,300));setIsLoading(false);navigate(\"/results?q=\".concat(encodeURIComponent(foodName),\"&similar=true\"));return;}}}catch(similarError){console.warn('Similar nutrition search failed:',similarError);}setLoadingMessage('Could not analyze this food item. Please try again.');setTimeout(()=>{setIsLoading(false);setLoadingMessage('Searching...');},3000);return;}}catch(error){console.error(\"Error processing analyzed food:\",error);setLoadingMessage('Analysis failed. Please try again.');setTimeout(()=>{setIsLoading(false);setLoadingMessage('Searching...');},2000);}finally{setIsUploadModalOpen(false);}};// Reset loading state on component unmount\nuseEffect(()=>{return()=>{setIsLoading(false);setLoadingMessage('Searching...');};},[]);const LoadingOverlay=_ref=>{let{message,progress}=_ref;return/*#__PURE__*/_jsx(\"div\",{style:{position:'fixed',top:0,left:0,right:0,bottom:0,backgroundColor:'rgba(0, 0, 0, 0.5)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:9999},children:/*#__PURE__*/_jsxs(\"div\",{style:{backgroundColor:'white',borderRadius:'12px',padding:'40px',textAlign:'center',minWidth:'320px',boxShadow:'0 10px 25px rgba(0, 0, 0, 0.2)'},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'48px',height:'48px',border:'4px solid #e5e7eb',borderTop:'4px solid #3b82f6',borderRadius:'50%',animation:'spin 1s linear infinite',margin:'0 auto 24px auto'}}),/*#__PURE__*/_jsx(\"h3\",{style:{margin:'0 0 8px 0',fontSize:'24px',fontWeight:'600',color:'#1f2937'},children:\"Loading Content\"}),/*#__PURE__*/_jsx(\"p\",{style:{margin:'0 0 24px 0',fontSize:'16px',color:'#6b7280'},children:\"Please wait while we process your request...\"}),/*#__PURE__*/_jsx(\"div\",{style:{width:'100%',height:'8px',backgroundColor:'#e5e7eb',borderRadius:'4px',overflow:'hidden',marginBottom:'12px'},children:/*#__PURE__*/_jsx(\"div\",{style:{width:\"\".concat(progress,\"%\"),height:'100%',backgroundColor:'#3b82f6',borderRadius:'4px',transition:'width 0.3s ease'}})}),/*#__PURE__*/_jsxs(\"p\",{style:{margin:0,fontSize:'14px',color:'#6b7280'},children:[progress,\"% Complete\"]})]})});};return/*#__PURE__*/_jsxs(\"div\",{className:\"search-landing\",children:[isLoading&&/*#__PURE__*/_jsx(LoadingOverlay,{message:loadingMessage,progress:progressFromMessage(loadingMessage)}),/*#__PURE__*/_jsx(MultiAuthLogin,{position:\"top-right\",className:\"main-login-button\",onUserChange:handleUserChange,onSignIn:handleSignIn,onSignOut:handleSignOut}),/*#__PURE__*/_jsxs(\"div\",{className:\"search-container-centered\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"logo-container\",children:!imageError?/*#__PURE__*/_jsx(\"img\",{src:\"/assets/293a2ef6-826c-4ec9-9b26-c2abf3bb894f.png\",alt:\"What is Healthy?\",className:\"search-logo-image\",onError:()=>setImageError(true),onLoad:()=>setImageError(false)}):/*#__PURE__*/_jsx(\"h1\",{className:\"search-logo\",children:\"What is Healthy?\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"search-input-container\",children:[/*#__PURE__*/_jsx(\"form\",{onSubmit:e=>{e.preventDefault();handleSearch();},children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:searchQuery,onChange:e=>setSearchQuery(e.target.value),onKeyPress:e=>e.key==='Enter'&&handleSearch(),placeholder:\"Ask anything about health...\",className:\"search-input\",autoFocus:true,disabled:isLoading})}),/*#__PURE__*/_jsxs(\"div\",{className:\"search-icons\",children:[searchQuery&&!isLoading&&/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setSearchQuery(''),className:\"icon-button clear-button\",\"aria-label\":\"Clear all\",children:/*#__PURE__*/_jsx(\"svg\",{viewBox:\"0 0 24 24\",fill:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\"})})}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setIsUploadModalOpen(true),className:\"icon-button\",\"aria-label\":\"Upload image\",disabled:isLoading,children:/*#__PURE__*/_jsx(\"svg\",{viewBox:\"0 0 24 24\",fill:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z\"})})}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>{if(isLoading)return;if(!('webkitSpeechRecognition'in window)){alert('Speech recognition not supported in this browser');return;}if(!recognitionRef.current){const recognition=new window.webkitSpeechRecognition();recognition.continuous=false;recognition.interimResults=false;recognition.lang='en-US';recognition.onstart=()=>setIsListening(true);recognition.onresult=event=>{const transcript=event.results[0][0].transcript;setSearchQuery(transcript);setIsListening(false);};recognition.onerror=()=>setIsListening(false);recognition.onend=()=>setIsListening(false);recognitionRef.current=recognition;}if(!isListening){recognitionRef.current.start();}else{recognitionRef.current.stop();setIsListening(false);}},className:\"icon-button \".concat(isListening?'listening':''),\"aria-label\":isListening?'Stop listening':'Start voice input',disabled:isLoading,children:/*#__PURE__*/_jsxs(\"svg\",{viewBox:\"0 0 24 24\",fill:\"currentColor\",children:[/*#__PURE__*/_jsx(\"path\",{d:\"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.28c3.39-.49 6-3.3 6-6.72h-2z\"})]})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"search-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.preventDefault();handleSearch();},className:\"search-btn primary\",disabled:!searchQuery.trim()||isLoading,children:isLoading?loadingMessage:'Analyze Nutrition'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{if(isLoading)return;if(showFeelingHealthyContent){// If news is showing, close it and set \"What is Healthy?\" in search\nsetShowFeelingHealthyContent(false);setSearchQuery('What is Healthy?');}else{// Show the news feed\nsetShowFeelingHealthyContent(true);}},className:\"search-btn secondary\",type:\"button\",style:{color:'#000000'},disabled:isLoading,children:\"I'm Feeling Healthy\"})]})]}),showFeelingHealthyContent&&/*#__PURE__*/_jsx(\"div\",{className:\"feeling-healthy-section\",onClick:e=>{// Close if clicking on the background, not the content\nif(e.target===e.currentTarget){setShowFeelingHealthyContent(false);setSearchQuery('What is Healthy?');}},children:/*#__PURE__*/_jsx(\"div\",{onClick:e=>e.stopPropagation(),children:/*#__PURE__*/_jsx(HealthNewsFeed,{maxArticles:6})})}),/*#__PURE__*/_jsx(ImageUploadModal,{isOpen:isUploadModalOpen,onClose:()=>setIsUploadModalOpen(false),onAnalysisComplete:handleAnalysisComplete,title:\"Upload Image\",subtitle:\"Upload Image for Analysis\"})]});};export default VHealthSearch;/* Add this CSS to your styles\r\n@keyframes spin {\r\n  0% { transform: rotate(0deg); }\r\n  100% { transform: rotate(360deg); }\r\n}\r\n*/","map":{"version":3,"names":["React","useState","useRef","useEffect","useNavigate","ImageUploadModal","MultiAuthLogin","healthSearchService","HealthNewsFeed","jsx","_jsx","jsxs","_jsxs","VHealthSearch","searchQuery","setSearchQuery","isListening","setIsListening","isUploadModalOpen","setIsUploadModalOpen","isLoading","setIsLoading","imageError","setImageError","loadingMessage","setLoadingMessage","showFeelingHealthyContent","setShowFeelingHealthyContent","navigate","searchInputRef","recognitionRef","progressFromMessage","msg","includes","handleUserChange","user","console","log","handleSignIn","handleSignOut","handleSearch","trim","response","fetch","concat","encodeURIComponent","ok","cachedData","json","Promise","resolve","setTimeout","cacheError","searchResults","searchHealthInfo","isValidResult","summary","details","Object","keys","length","method","headers","body","JSON","stringify","query","results","source","then","warn","catch","err","Error","apiError","error","similarResponse","similarResults","similarError","handleAnalysisComplete","foodName","nutritionResults","nutritionError","LoadingOverlay","_ref","message","progress","style","position","top","left","right","bottom","backgroundColor","display","alignItems","justifyContent","zIndex","children","borderRadius","padding","textAlign","minWidth","boxShadow","width","height","border","borderTop","animation","margin","fontSize","fontWeight","color","overflow","marginBottom","transition","className","onUserChange","onSignIn","onSignOut","src","alt","onError","onLoad","onSubmit","e","preventDefault","type","value","onChange","target","onKeyPress","key","placeholder","autoFocus","disabled","onClick","viewBox","fill","d","window","alert","current","recognition","webkitSpeechRecognition","continuous","interimResults","lang","onstart","onresult","event","transcript","onerror","onend","start","stop","currentTarget","stopPropagation","maxArticles","isOpen","onClose","onAnalysisComplete","title","subtitle"],"sources":["C:/vHealth/vhealth/client/src/VHealthSearch.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport './VHealthSearch.css';\r\nimport ImageUploadModal from './components/ImageUploadModal';\r\nimport MultiAuthLogin from './components/shared/components/MultiAuthLogin';\r\nimport { healthSearchService } from './services/healthSearchService';\r\nimport { searchCache } from './services/searchCache';\r\nimport { foodAnalysisService } from './components/foodAnalysisService';\r\nimport HealthNewsFeed from './components/HealthNewsFeed';\r\n\r\nconst VHealthSearch: React.FC = () => {\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [isListening, setIsListening] = useState(false);\r\n  const [isUploadModalOpen, setIsUploadModalOpen] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [imageError, setImageError] = useState(false);\r\n  const [loadingMessage, setLoadingMessage] = useState('Searching...');\r\n  const [showFeelingHealthyContent, setShowFeelingHealthyContent] = useState(false);\r\n  \r\n  const navigate = useNavigate();\r\n  const searchInputRef = useRef<HTMLInputElement>(null);\r\n  const recognitionRef = useRef<any>(null);\r\n\r\n  const progressFromMessage = (msg: string) => {\r\n    if (msg.includes('Initializing')) return 10;\r\n    if (msg.includes('Checking cache')) return 25;\r\n    if (msg.includes('Analyzing with AI')) return 55;\r\n    if (msg.includes('Processing results')) return 75;\r\n    if (msg.includes('Results ready') || msg.includes('Response ready')) return 95;\r\n\r\n    if (msg.includes('Processing image')) return 35;\r\n    if (msg.includes('Checking nutrition')) return 45;\r\n    if (msg.includes('Analyzing nutrition')) return 60;\r\n    if (msg.includes('Processing nutrition')) return 80;\r\n    if (msg.includes('complete')) return 95;\r\n\r\n    if (msg.includes('failed')) return 100; // will close shortly\r\n    return 40; // default midpoint\r\n  };\r\n\r\n  const handleUserChange = (user: any) => {\r\n    console.log('User changed:', user);\r\n  };\r\n\r\n  const handleSignIn = (user: any) => {\r\n    console.log('User signed in:', user);\r\n  };\r\n\r\n  const handleSignOut = () => {\r\n    console.log('User signed out');\r\n  };\r\n\r\n  // Simplified search handler\r\n  const handleSearch = async () => {\r\n    if (!searchQuery.trim() || isLoading) return;\r\n    \r\n    setIsLoading(true);\r\n    setLoadingMessage('Initializing search...');\r\n    \r\n    try {\r\n      // Step 1: Check database cache first\r\n      setLoadingMessage('Checking cache...');\r\n      \r\n      try {\r\n        const response = await fetch(`http://localhost:5000/api/cache/get?q=${encodeURIComponent(searchQuery)}`);\r\n        \r\n        if (response.ok) {\r\n          const cachedData = await response.json();\r\n          console.log('Using cached results from database');\r\n          setLoadingMessage('Loading cached results...');\r\n          await new Promise(resolve => setTimeout(resolve, 300));\r\n          \r\n          setIsLoading(false);\r\n          navigate(`/results?q=${encodeURIComponent(searchQuery)}&cached=true`);\r\n          return;\r\n        }\r\n      } catch (cacheError) {\r\n        console.log('No cache found, proceeding with API call');\r\n      }\r\n\r\n      // Step 2: Get fresh results from API\r\n      setLoadingMessage('Analyzing with AI...');\r\n      console.log('Getting fresh results for:', searchQuery);\r\n      \r\n      try {\r\n        const searchResults = await healthSearchService.searchHealthInfo(searchQuery);\r\n        console.log('Health search results received:', searchResults);\r\n        \r\n        const isValidResult = searchResults && \r\n          typeof searchResults === 'object' && \r\n          searchResults !== null &&\r\n          (searchResults.summary || searchResults.details || Object.keys(searchResults).length > 0);\r\n        \r\n        if (isValidResult) {\r\n          console.log('Valid results confirmed');\r\n          \r\n          // Step 3: Save to database cache (async, don't wait)\r\n          setLoadingMessage('Caching results...');\r\n          \r\n          fetch('http://localhost:5000/api/cache/save', {\r\n            method: 'POST',\r\n            headers: {\r\n              'Content-Type': 'application/json',\r\n            },\r\n            body: JSON.stringify({\r\n              query: searchQuery,\r\n              results: searchResults,\r\n              source: 'openai'\r\n            })\r\n          }).then(response => {\r\n            if (response.ok) {\r\n              console.log('Results saved to database cache');\r\n            } else {\r\n              console.warn('Failed to save to cache');\r\n            }\r\n          }).catch(err => {\r\n            console.warn('Cache save error:', err);\r\n          });\r\n          \r\n          setLoadingMessage('Results ready!');\r\n          await new Promise(resolve => setTimeout(resolve, 300));\r\n          \r\n          setIsLoading(false);\r\n          console.log('Navigating to results page');\r\n          navigate(`/results?q=${encodeURIComponent(searchQuery)}`);\r\n          return;\r\n        } else {\r\n          throw new Error('Invalid results from API');\r\n        }\r\n        \r\n      } catch (apiError) {\r\n        console.error('Health search service failed:', apiError);\r\n        \r\n        // Step 4: Try similar results as fallback\r\n        setLoadingMessage('Searching for similar results...');\r\n        \r\n        try {\r\n          const similarResponse = await fetch(`http://localhost:5000/api/cache/similar?q=${encodeURIComponent(searchQuery)}`);\r\n          \r\n          if (similarResponse.ok) {\r\n            const similarResults = await similarResponse.json();\r\n            \r\n            if (similarResults.length > 0) {\r\n              console.log('Using similar cached results');\r\n              setLoadingMessage('Loading similar results...');\r\n              await new Promise(resolve => setTimeout(resolve, 300));\r\n              \r\n              setIsLoading(false);\r\n              navigate(`/results?q=${encodeURIComponent(searchQuery)}&similar=true`);\r\n              return;\r\n            }\r\n          }\r\n        } catch (similarError) {\r\n          console.warn('Similar results search failed:', similarError);\r\n        }\r\n        \r\n        setLoadingMessage('No results found. Please try a different search.');\r\n        setTimeout(() => {\r\n          setIsLoading(false);\r\n          setLoadingMessage('Searching...');\r\n        }, 3000);\r\n        return;\r\n      }\r\n        \r\n    } catch (error) {\r\n      console.error(\"Search error:\", error);\r\n      setLoadingMessage('Search failed. Please try again.');\r\n      \r\n      setTimeout(() => {\r\n        setIsLoading(false);\r\n        setLoadingMessage('Searching...');\r\n      }, 2000);\r\n    }\r\n  };\r\n\r\n  const handleAnalysisComplete = async (foodName: string): Promise<void> => {\r\n    if (!foodName || isLoading) {\r\n      setIsUploadModalOpen(false);\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setLoadingMessage('Processing image analysis...');\r\n    \r\n    try {\r\n      console.log(\"Image analysis completed, food detected:\", foodName);\r\n      setSearchQuery(foodName);\r\n      \r\n      // Step 1: Check database cache for nutrition data\r\n      setLoadingMessage('Checking nutrition database...');\r\n      \r\n      try {\r\n        const response = await fetch(`http://localhost:5000/api/cache/get?q=${encodeURIComponent(foodName)}`);\r\n        \r\n        if (response.ok) {\r\n          const cachedData = await response.json();\r\n          console.log('Using cached nutrition data');\r\n          setLoadingMessage('Loading cached nutrition data...');\r\n          await new Promise(resolve => setTimeout(resolve, 300));\r\n          \r\n          setIsLoading(false);\r\n          navigate(`/results?q=${encodeURIComponent(foodName)}&cached=true`);\r\n          return;\r\n        }\r\n      } catch (cacheError) {\r\n        console.log('No cached nutrition data found');\r\n      }\r\n      \r\n      // Step 2: Get fresh nutrition data\r\n      setLoadingMessage('Analyzing nutrition content...');\r\n      \r\n      try {\r\n        const nutritionResults = await healthSearchService.searchHealthInfo(foodName);\r\n        \r\n        const isValidResult = nutritionResults && \r\n          typeof nutritionResults === 'object' && \r\n          nutritionResults !== null &&\r\n          (nutritionResults.summary || nutritionResults.details || Object.keys(nutritionResults).length > 0);\r\n        \r\n        if (isValidResult) {\r\n          // Step 3: Save to database cache (async, don't wait)\r\n          setLoadingMessage('Caching nutrition data...');\r\n          \r\n          fetch('http://localhost:5000/api/cache/save', {\r\n            method: 'POST',\r\n            headers: {\r\n              'Content-Type': 'application/json',\r\n            },\r\n            body: JSON.stringify({\r\n              query: foodName,\r\n              results: nutritionResults,\r\n              source: 'image-analysis'\r\n            })\r\n          }).then(response => {\r\n            if (response.ok) {\r\n              console.log('Nutrition data saved to cache');\r\n            } else {\r\n              console.warn('Failed to save nutrition data to cache');\r\n            }\r\n          }).catch(err => {\r\n            console.warn('Nutrition cache save error:', err);\r\n          });\r\n          \r\n          setLoadingMessage('Nutrition analysis complete!');\r\n          await new Promise(resolve => setTimeout(resolve, 300));\r\n          \r\n          setIsLoading(false);\r\n          navigate(`/results?q=${encodeURIComponent(foodName)}`);\r\n          return;\r\n        } else {\r\n          throw new Error('Invalid nutrition results');\r\n        }\r\n        \r\n      } catch (nutritionError) {\r\n        console.error('Nutrition analysis failed:', nutritionError);\r\n        \r\n        // Try similar results as fallback\r\n        try {\r\n          const similarResponse = await fetch(`http://localhost:5000/api/cache/similar?q=${encodeURIComponent(foodName)}`);\r\n          \r\n          if (similarResponse.ok) {\r\n            const similarResults = await similarResponse.json();\r\n            \r\n            if (similarResults.length > 0) {\r\n              console.log('Using similar nutrition data');\r\n              setLoadingMessage('Loading similar nutrition data...');\r\n              await new Promise(resolve => setTimeout(resolve, 300));\r\n              \r\n              setIsLoading(false);\r\n              navigate(`/results?q=${encodeURIComponent(foodName)}&similar=true`);\r\n              return;\r\n            }\r\n          }\r\n        } catch (similarError) {\r\n          console.warn('Similar nutrition search failed:', similarError);\r\n        }\r\n        \r\n        setLoadingMessage('Could not analyze this food item. Please try again.');\r\n        setTimeout(() => {\r\n          setIsLoading(false);\r\n          setLoadingMessage('Searching...');\r\n        }, 3000);\r\n        return;\r\n      }\r\n      \r\n    } catch (error) {\r\n      console.error(\"Error processing analyzed food:\", error);\r\n      setLoadingMessage('Analysis failed. Please try again.');\r\n      \r\n      setTimeout(() => {\r\n        setIsLoading(false);\r\n        setLoadingMessage('Searching...');\r\n      }, 2000);\r\n    } finally {\r\n      setIsUploadModalOpen(false);\r\n    }\r\n  };\r\n\r\n  // Reset loading state on component unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      setIsLoading(false);\r\n      setLoadingMessage('Searching...');\r\n    };\r\n  }, []);\r\n\r\n  const LoadingOverlay: React.FC<{ message: string; progress: number }> = ({ message, progress }) => (\r\n    <div style={{\r\n      position: 'fixed',\r\n      top: 0,\r\n      left: 0,\r\n      right: 0,\r\n      bottom: 0,\r\n      backgroundColor: 'rgba(0, 0, 0, 0.5)',\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      zIndex: 9999\r\n    }}>\r\n      <div style={{\r\n        backgroundColor: 'white',\r\n        borderRadius: '12px',\r\n        padding: '40px',\r\n        textAlign: 'center',\r\n        minWidth: '320px',\r\n        boxShadow: '0 10px 25px rgba(0, 0, 0, 0.2)'\r\n      }}>\r\n        {/* Spinner */}\r\n        <div style={{\r\n          width: '48px',\r\n          height: '48px',\r\n          border: '4px solid #e5e7eb',\r\n          borderTop: '4px solid #3b82f6',\r\n          borderRadius: '50%',\r\n          animation: 'spin 1s linear infinite',\r\n          margin: '0 auto 24px auto'\r\n        }} />\r\n        \r\n        {/* Title */}\r\n        <h3 style={{\r\n          margin: '0 0 8px 0',\r\n          fontSize: '24px',\r\n          fontWeight: '600',\r\n          color: '#1f2937'\r\n        }}>\r\n          Loading Content\r\n        </h3>\r\n        \r\n        {/* Subtitle */}\r\n        <p style={{\r\n          margin: '0 0 24px 0',\r\n          fontSize: '16px',\r\n          color: '#6b7280'\r\n        }}>\r\n          Please wait while we process your request...\r\n        </p>\r\n        \r\n        {/* Progress Bar */}\r\n        <div style={{\r\n          width: '100%',\r\n          height: '8px',\r\n          backgroundColor: '#e5e7eb',\r\n          borderRadius: '4px',\r\n          overflow: 'hidden',\r\n          marginBottom: '12px'\r\n        }}>\r\n          <div style={{\r\n            width: `${progress}%`,\r\n            height: '100%',\r\n            backgroundColor: '#3b82f6',\r\n            borderRadius: '4px',\r\n            transition: 'width 0.3s ease'\r\n          }} />\r\n        </div>\r\n        \r\n        {/* Progress Text */}\r\n        <p style={{\r\n          margin: 0,\r\n          fontSize: '14px',\r\n          color: '#6b7280'\r\n        }}>\r\n          {progress}% Complete\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className=\"search-landing\">\r\n      {isLoading && (\r\n        <LoadingOverlay \r\n          message={loadingMessage}\r\n          progress={progressFromMessage(loadingMessage)}\r\n        />\r\n      )}\r\n      \r\n      <MultiAuthLogin \r\n        position=\"top-right\"\r\n        className=\"main-login-button\"\r\n        onUserChange={handleUserChange}\r\n        onSignIn={handleSignIn}\r\n        onSignOut={handleSignOut}\r\n      />\r\n\r\n      <div className=\"search-container-centered\">\r\n        <div className=\"logo-container\">\r\n          {!imageError ? (\r\n            <img \r\n              src=\"/assets/293a2ef6-826c-4ec9-9b26-c2abf3bb894f.png\"\r\n              alt=\"What is Healthy?\"\r\n              className=\"search-logo-image\"\r\n              onError={() => setImageError(true)}\r\n              onLoad={() => setImageError(false)}\r\n            />\r\n          ) : (\r\n            <h1 className=\"search-logo\">\r\n              What is Healthy?\r\n            </h1>\r\n          )}\r\n        </div>\r\n        \r\n        <div className=\"search-input-container\">\r\n          <form onSubmit={(e) => { \r\n            e.preventDefault();\r\n            handleSearch();\r\n          }}>\r\n            <input\r\n              type=\"text\"\r\n              value={searchQuery}\r\n              onChange={(e) => setSearchQuery(e.target.value)}\r\n              onKeyPress={(e) => e.key === 'Enter' && handleSearch()}\r\n              placeholder=\"Ask anything about health...\"\r\n              className=\"search-input\"\r\n              autoFocus\r\n              disabled={isLoading}\r\n            />\r\n          </form>\r\n\r\n          <div className=\"search-icons\">\r\n            {searchQuery && !isLoading && (\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setSearchQuery('')}\r\n                className=\"icon-button clear-button\"\r\n                aria-label=\"Clear all\"\r\n              >\r\n                <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                  <path d=\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\"/>\r\n                </svg>\r\n              </button>\r\n            )}\r\n            \r\n            <button\r\n              type=\"button\"\r\n              onClick={() => setIsUploadModalOpen(true)}\r\n              className=\"icon-button\"\r\n              aria-label=\"Upload image\"\r\n              disabled={isLoading}\r\n            >\r\n              <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                <path d=\"M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z\"/>\r\n              </svg>\r\n            </button>\r\n            \r\n            <button\r\n              type=\"button\"\r\n              onClick={() => {\r\n                if (isLoading) return;\r\n                \r\n                if (!('webkitSpeechRecognition' in window)) {\r\n                  alert('Speech recognition not supported in this browser');\r\n                  return;\r\n                }\r\n\r\n                if (!recognitionRef.current) {\r\n                  const recognition = new (window as any).webkitSpeechRecognition();\r\n                  recognition.continuous = false;\r\n                  recognition.interimResults = false;\r\n                  recognition.lang = 'en-US';\r\n\r\n                  recognition.onstart = () => setIsListening(true);\r\n                  recognition.onresult = (event: any) => {\r\n                    const transcript = event.results[0][0].transcript;\r\n                    setSearchQuery(transcript);\r\n                    setIsListening(false);\r\n                  };\r\n                  recognition.onerror = () => setIsListening(false);\r\n                  recognition.onend = () => setIsListening(false);\r\n\r\n                  recognitionRef.current = recognition;\r\n                }\r\n\r\n                if (!isListening) {\r\n                  recognitionRef.current.start();\r\n                } else {\r\n                  recognitionRef.current.stop();\r\n                  setIsListening(false);\r\n                }\r\n              }}\r\n              className={`icon-button ${isListening ? 'listening' : ''}`}\r\n              aria-label={isListening ? 'Stop listening' : 'Start voice input'}\r\n              disabled={isLoading}\r\n            >\r\n              <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                <path d=\"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z\"/>\r\n                <path d=\"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.28c3.39-.49 6-3.3 6-6.72h-2z\"/>\r\n              </svg>\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"search-buttons\">\r\n          <button \r\n            onClick={(e) => {\r\n              e.preventDefault();\r\n              handleSearch();\r\n            }}\r\n            className=\"search-btn primary\"\r\n            disabled={!searchQuery.trim() || isLoading}\r\n          >\r\n            {isLoading ? loadingMessage : 'Analyze Nutrition'}\r\n          </button>\r\n          \r\n          <button \r\n            onClick={() => {\r\n              if (isLoading) return;\r\n              \r\n              if (showFeelingHealthyContent) {\r\n                // If news is showing, close it and set \"What is Healthy?\" in search\r\n                setShowFeelingHealthyContent(false);\r\n                setSearchQuery('What is Healthy?');\r\n              } else {\r\n                // Show the news feed\r\n                setShowFeelingHealthyContent(true);\r\n              }\r\n            }}\r\n            className=\"search-btn secondary\"\r\n            type=\"button\"\r\n            style={{ color: '#000000' }}\r\n            disabled={isLoading}\r\n          >\r\n            I'm Feeling Healthy\r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n      {showFeelingHealthyContent && (\r\n        <div \r\n          className=\"feeling-healthy-section\"\r\n          onClick={(e) => {\r\n            // Close if clicking on the background, not the content\r\n            if (e.target === e.currentTarget) {\r\n              setShowFeelingHealthyContent(false);\r\n              setSearchQuery('What is Healthy?');\r\n            }\r\n          }}\r\n        >\r\n          <div onClick={(e) => e.stopPropagation()}>\r\n            <HealthNewsFeed maxArticles={6} />\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <ImageUploadModal\r\n        isOpen={isUploadModalOpen}\r\n        onClose={() => setIsUploadModalOpen(false)}\r\n        onAnalysisComplete={handleAnalysisComplete}\r\n        title=\"Upload Image\"\r\n        subtitle=\"Upload Image for Analysis\"\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VHealthSearch;\r\n\r\n/* Add this CSS to your styles\r\n@keyframes spin {\r\n  0% { transform: rotate(0deg); }\r\n  100% { transform: rotate(360deg); }\r\n}\r\n*/"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,MAAM,CAAEC,SAAS,KAAQ,OAAO,CAC1D,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,MAAO,qBAAqB,CAC5B,MAAO,CAAAC,gBAAgB,KAAM,+BAA+B,CAC5D,MAAO,CAAAC,cAAc,KAAM,+CAA+C,CAC1E,OAASC,mBAAmB,KAAQ,gCAAgC,CAGpE,MAAO,CAAAC,cAAc,KAAM,6BAA6B,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEzD,KAAM,CAAAC,aAAuB,CAAGA,CAAA,GAAM,CACpC,KAAM,CAACC,WAAW,CAAEC,cAAc,CAAC,CAAGd,QAAQ,CAAC,EAAE,CAAC,CAClD,KAAM,CAACe,WAAW,CAAEC,cAAc,CAAC,CAAGhB,QAAQ,CAAC,KAAK,CAAC,CACrD,KAAM,CAACiB,iBAAiB,CAAEC,oBAAoB,CAAC,CAAGlB,QAAQ,CAAC,KAAK,CAAC,CACjE,KAAM,CAACmB,SAAS,CAAEC,YAAY,CAAC,CAAGpB,QAAQ,CAAC,KAAK,CAAC,CACjD,KAAM,CAACqB,UAAU,CAAEC,aAAa,CAAC,CAAGtB,QAAQ,CAAC,KAAK,CAAC,CACnD,KAAM,CAACuB,cAAc,CAAEC,iBAAiB,CAAC,CAAGxB,QAAQ,CAAC,cAAc,CAAC,CACpE,KAAM,CAACyB,yBAAyB,CAAEC,4BAA4B,CAAC,CAAG1B,QAAQ,CAAC,KAAK,CAAC,CAEjF,KAAM,CAAA2B,QAAQ,CAAGxB,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAAyB,cAAc,CAAG3B,MAAM,CAAmB,IAAI,CAAC,CACrD,KAAM,CAAA4B,cAAc,CAAG5B,MAAM,CAAM,IAAI,CAAC,CAExC,KAAM,CAAA6B,mBAAmB,CAAIC,GAAW,EAAK,CAC3C,GAAIA,GAAG,CAACC,QAAQ,CAAC,cAAc,CAAC,CAAE,MAAO,GAAE,CAC3C,GAAID,GAAG,CAACC,QAAQ,CAAC,gBAAgB,CAAC,CAAE,MAAO,GAAE,CAC7C,GAAID,GAAG,CAACC,QAAQ,CAAC,mBAAmB,CAAC,CAAE,MAAO,GAAE,CAChD,GAAID,GAAG,CAACC,QAAQ,CAAC,oBAAoB,CAAC,CAAE,MAAO,GAAE,CACjD,GAAID,GAAG,CAACC,QAAQ,CAAC,eAAe,CAAC,EAAID,GAAG,CAACC,QAAQ,CAAC,gBAAgB,CAAC,CAAE,MAAO,GAAE,CAE9E,GAAID,GAAG,CAACC,QAAQ,CAAC,kBAAkB,CAAC,CAAE,MAAO,GAAE,CAC/C,GAAID,GAAG,CAACC,QAAQ,CAAC,oBAAoB,CAAC,CAAE,MAAO,GAAE,CACjD,GAAID,GAAG,CAACC,QAAQ,CAAC,qBAAqB,CAAC,CAAE,MAAO,GAAE,CAClD,GAAID,GAAG,CAACC,QAAQ,CAAC,sBAAsB,CAAC,CAAE,MAAO,GAAE,CACnD,GAAID,GAAG,CAACC,QAAQ,CAAC,UAAU,CAAC,CAAE,MAAO,GAAE,CAEvC,GAAID,GAAG,CAACC,QAAQ,CAAC,QAAQ,CAAC,CAAE,MAAO,IAAG,CAAE;AACxC,MAAO,GAAE,CAAE;AACb,CAAC,CAED,KAAM,CAAAC,gBAAgB,CAAIC,IAAS,EAAK,CACtCC,OAAO,CAACC,GAAG,CAAC,eAAe,CAAEF,IAAI,CAAC,CACpC,CAAC,CAED,KAAM,CAAAG,YAAY,CAAIH,IAAS,EAAK,CAClCC,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAEF,IAAI,CAAC,CACtC,CAAC,CAED,KAAM,CAAAI,aAAa,CAAGA,CAAA,GAAM,CAC1BH,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAC,CAChC,CAAC,CAED;AACA,KAAM,CAAAG,YAAY,CAAG,KAAAA,CAAA,GAAY,CAC/B,GAAI,CAAC1B,WAAW,CAAC2B,IAAI,CAAC,CAAC,EAAIrB,SAAS,CAAE,OAEtCC,YAAY,CAAC,IAAI,CAAC,CAClBI,iBAAiB,CAAC,wBAAwB,CAAC,CAE3C,GAAI,CACF;AACAA,iBAAiB,CAAC,mBAAmB,CAAC,CAEtC,GAAI,CACF,KAAM,CAAAiB,QAAQ,CAAG,KAAM,CAAAC,KAAK,0CAAAC,MAAA,CAA0CC,kBAAkB,CAAC/B,WAAW,CAAC,CAAE,CAAC,CAExG,GAAI4B,QAAQ,CAACI,EAAE,CAAE,CACf,KAAM,CAAAC,UAAU,CAAG,KAAM,CAAAL,QAAQ,CAACM,IAAI,CAAC,CAAC,CACxCZ,OAAO,CAACC,GAAG,CAAC,oCAAoC,CAAC,CACjDZ,iBAAiB,CAAC,2BAA2B,CAAC,CAC9C,KAAM,IAAI,CAAAwB,OAAO,CAACC,OAAO,EAAIC,UAAU,CAACD,OAAO,CAAE,GAAG,CAAC,CAAC,CAEtD7B,YAAY,CAAC,KAAK,CAAC,CACnBO,QAAQ,eAAAgB,MAAA,CAAeC,kBAAkB,CAAC/B,WAAW,CAAC,gBAAc,CAAC,CACrE,OACF,CACF,CAAE,MAAOsC,UAAU,CAAE,CACnBhB,OAAO,CAACC,GAAG,CAAC,0CAA0C,CAAC,CACzD,CAEA;AACAZ,iBAAiB,CAAC,sBAAsB,CAAC,CACzCW,OAAO,CAACC,GAAG,CAAC,4BAA4B,CAAEvB,WAAW,CAAC,CAEtD,GAAI,CACF,KAAM,CAAAuC,aAAa,CAAG,KAAM,CAAA9C,mBAAmB,CAAC+C,gBAAgB,CAACxC,WAAW,CAAC,CAC7EsB,OAAO,CAACC,GAAG,CAAC,iCAAiC,CAAEgB,aAAa,CAAC,CAE7D,KAAM,CAAAE,aAAa,CAAGF,aAAa,EACjC,MAAO,CAAAA,aAAa,GAAK,QAAQ,EACjCA,aAAa,GAAK,IAAI,GACrBA,aAAa,CAACG,OAAO,EAAIH,aAAa,CAACI,OAAO,EAAIC,MAAM,CAACC,IAAI,CAACN,aAAa,CAAC,CAACO,MAAM,CAAG,CAAC,CAAC,CAE3F,GAAIL,aAAa,CAAE,CACjBnB,OAAO,CAACC,GAAG,CAAC,yBAAyB,CAAC,CAEtC;AACAZ,iBAAiB,CAAC,oBAAoB,CAAC,CAEvCkB,KAAK,CAAC,sCAAsC,CAAE,CAC5CkB,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CAAC,CACDC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CACnBC,KAAK,CAAEpD,WAAW,CAClBqD,OAAO,CAAEd,aAAa,CACtBe,MAAM,CAAE,QACV,CAAC,CACH,CAAC,CAAC,CAACC,IAAI,CAAC3B,QAAQ,EAAI,CAClB,GAAIA,QAAQ,CAACI,EAAE,CAAE,CACfV,OAAO,CAACC,GAAG,CAAC,iCAAiC,CAAC,CAChD,CAAC,IAAM,CACLD,OAAO,CAACkC,IAAI,CAAC,yBAAyB,CAAC,CACzC,CACF,CAAC,CAAC,CAACC,KAAK,CAACC,GAAG,EAAI,CACdpC,OAAO,CAACkC,IAAI,CAAC,mBAAmB,CAAEE,GAAG,CAAC,CACxC,CAAC,CAAC,CAEF/C,iBAAiB,CAAC,gBAAgB,CAAC,CACnC,KAAM,IAAI,CAAAwB,OAAO,CAACC,OAAO,EAAIC,UAAU,CAACD,OAAO,CAAE,GAAG,CAAC,CAAC,CAEtD7B,YAAY,CAAC,KAAK,CAAC,CACnBe,OAAO,CAACC,GAAG,CAAC,4BAA4B,CAAC,CACzCT,QAAQ,eAAAgB,MAAA,CAAeC,kBAAkB,CAAC/B,WAAW,CAAC,CAAE,CAAC,CACzD,OACF,CAAC,IAAM,CACL,KAAM,IAAI,CAAA2D,KAAK,CAAC,0BAA0B,CAAC,CAC7C,CAEF,CAAE,MAAOC,QAAQ,CAAE,CACjBtC,OAAO,CAACuC,KAAK,CAAC,+BAA+B,CAAED,QAAQ,CAAC,CAExD;AACAjD,iBAAiB,CAAC,kCAAkC,CAAC,CAErD,GAAI,CACF,KAAM,CAAAmD,eAAe,CAAG,KAAM,CAAAjC,KAAK,8CAAAC,MAAA,CAA8CC,kBAAkB,CAAC/B,WAAW,CAAC,CAAE,CAAC,CAEnH,GAAI8D,eAAe,CAAC9B,EAAE,CAAE,CACtB,KAAM,CAAA+B,cAAc,CAAG,KAAM,CAAAD,eAAe,CAAC5B,IAAI,CAAC,CAAC,CAEnD,GAAI6B,cAAc,CAACjB,MAAM,CAAG,CAAC,CAAE,CAC7BxB,OAAO,CAACC,GAAG,CAAC,8BAA8B,CAAC,CAC3CZ,iBAAiB,CAAC,4BAA4B,CAAC,CAC/C,KAAM,IAAI,CAAAwB,OAAO,CAACC,OAAO,EAAIC,UAAU,CAACD,OAAO,CAAE,GAAG,CAAC,CAAC,CAEtD7B,YAAY,CAAC,KAAK,CAAC,CACnBO,QAAQ,eAAAgB,MAAA,CAAeC,kBAAkB,CAAC/B,WAAW,CAAC,iBAAe,CAAC,CACtE,OACF,CACF,CACF,CAAE,MAAOgE,YAAY,CAAE,CACrB1C,OAAO,CAACkC,IAAI,CAAC,gCAAgC,CAAEQ,YAAY,CAAC,CAC9D,CAEArD,iBAAiB,CAAC,kDAAkD,CAAC,CACrE0B,UAAU,CAAC,IAAM,CACf9B,YAAY,CAAC,KAAK,CAAC,CACnBI,iBAAiB,CAAC,cAAc,CAAC,CACnC,CAAC,CAAE,IAAI,CAAC,CACR,OACF,CAEF,CAAE,MAAOkD,KAAK,CAAE,CACdvC,OAAO,CAACuC,KAAK,CAAC,eAAe,CAAEA,KAAK,CAAC,CACrClD,iBAAiB,CAAC,kCAAkC,CAAC,CAErD0B,UAAU,CAAC,IAAM,CACf9B,YAAY,CAAC,KAAK,CAAC,CACnBI,iBAAiB,CAAC,cAAc,CAAC,CACnC,CAAC,CAAE,IAAI,CAAC,CACV,CACF,CAAC,CAED,KAAM,CAAAsD,sBAAsB,CAAG,KAAO,CAAAC,QAAgB,EAAoB,CACxE,GAAI,CAACA,QAAQ,EAAI5D,SAAS,CAAE,CAC1BD,oBAAoB,CAAC,KAAK,CAAC,CAC3B,OACF,CAEAE,YAAY,CAAC,IAAI,CAAC,CAClBI,iBAAiB,CAAC,8BAA8B,CAAC,CAEjD,GAAI,CACFW,OAAO,CAACC,GAAG,CAAC,0CAA0C,CAAE2C,QAAQ,CAAC,CACjEjE,cAAc,CAACiE,QAAQ,CAAC,CAExB;AACAvD,iBAAiB,CAAC,gCAAgC,CAAC,CAEnD,GAAI,CACF,KAAM,CAAAiB,QAAQ,CAAG,KAAM,CAAAC,KAAK,0CAAAC,MAAA,CAA0CC,kBAAkB,CAACmC,QAAQ,CAAC,CAAE,CAAC,CAErG,GAAItC,QAAQ,CAACI,EAAE,CAAE,CACf,KAAM,CAAAC,UAAU,CAAG,KAAM,CAAAL,QAAQ,CAACM,IAAI,CAAC,CAAC,CACxCZ,OAAO,CAACC,GAAG,CAAC,6BAA6B,CAAC,CAC1CZ,iBAAiB,CAAC,kCAAkC,CAAC,CACrD,KAAM,IAAI,CAAAwB,OAAO,CAACC,OAAO,EAAIC,UAAU,CAACD,OAAO,CAAE,GAAG,CAAC,CAAC,CAEtD7B,YAAY,CAAC,KAAK,CAAC,CACnBO,QAAQ,eAAAgB,MAAA,CAAeC,kBAAkB,CAACmC,QAAQ,CAAC,gBAAc,CAAC,CAClE,OACF,CACF,CAAE,MAAO5B,UAAU,CAAE,CACnBhB,OAAO,CAACC,GAAG,CAAC,gCAAgC,CAAC,CAC/C,CAEA;AACAZ,iBAAiB,CAAC,gCAAgC,CAAC,CAEnD,GAAI,CACF,KAAM,CAAAwD,gBAAgB,CAAG,KAAM,CAAA1E,mBAAmB,CAAC+C,gBAAgB,CAAC0B,QAAQ,CAAC,CAE7E,KAAM,CAAAzB,aAAa,CAAG0B,gBAAgB,EACpC,MAAO,CAAAA,gBAAgB,GAAK,QAAQ,EACpCA,gBAAgB,GAAK,IAAI,GACxBA,gBAAgB,CAACzB,OAAO,EAAIyB,gBAAgB,CAACxB,OAAO,EAAIC,MAAM,CAACC,IAAI,CAACsB,gBAAgB,CAAC,CAACrB,MAAM,CAAG,CAAC,CAAC,CAEpG,GAAIL,aAAa,CAAE,CACjB;AACA9B,iBAAiB,CAAC,2BAA2B,CAAC,CAE9CkB,KAAK,CAAC,sCAAsC,CAAE,CAC5CkB,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CAAC,CACDC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CACnBC,KAAK,CAAEc,QAAQ,CACfb,OAAO,CAAEc,gBAAgB,CACzBb,MAAM,CAAE,gBACV,CAAC,CACH,CAAC,CAAC,CAACC,IAAI,CAAC3B,QAAQ,EAAI,CAClB,GAAIA,QAAQ,CAACI,EAAE,CAAE,CACfV,OAAO,CAACC,GAAG,CAAC,+BAA+B,CAAC,CAC9C,CAAC,IAAM,CACLD,OAAO,CAACkC,IAAI,CAAC,wCAAwC,CAAC,CACxD,CACF,CAAC,CAAC,CAACC,KAAK,CAACC,GAAG,EAAI,CACdpC,OAAO,CAACkC,IAAI,CAAC,6BAA6B,CAAEE,GAAG,CAAC,CAClD,CAAC,CAAC,CAEF/C,iBAAiB,CAAC,8BAA8B,CAAC,CACjD,KAAM,IAAI,CAAAwB,OAAO,CAACC,OAAO,EAAIC,UAAU,CAACD,OAAO,CAAE,GAAG,CAAC,CAAC,CAEtD7B,YAAY,CAAC,KAAK,CAAC,CACnBO,QAAQ,eAAAgB,MAAA,CAAeC,kBAAkB,CAACmC,QAAQ,CAAC,CAAE,CAAC,CACtD,OACF,CAAC,IAAM,CACL,KAAM,IAAI,CAAAP,KAAK,CAAC,2BAA2B,CAAC,CAC9C,CAEF,CAAE,MAAOS,cAAc,CAAE,CACvB9C,OAAO,CAACuC,KAAK,CAAC,4BAA4B,CAAEO,cAAc,CAAC,CAE3D;AACA,GAAI,CACF,KAAM,CAAAN,eAAe,CAAG,KAAM,CAAAjC,KAAK,8CAAAC,MAAA,CAA8CC,kBAAkB,CAACmC,QAAQ,CAAC,CAAE,CAAC,CAEhH,GAAIJ,eAAe,CAAC9B,EAAE,CAAE,CACtB,KAAM,CAAA+B,cAAc,CAAG,KAAM,CAAAD,eAAe,CAAC5B,IAAI,CAAC,CAAC,CAEnD,GAAI6B,cAAc,CAACjB,MAAM,CAAG,CAAC,CAAE,CAC7BxB,OAAO,CAACC,GAAG,CAAC,8BAA8B,CAAC,CAC3CZ,iBAAiB,CAAC,mCAAmC,CAAC,CACtD,KAAM,IAAI,CAAAwB,OAAO,CAACC,OAAO,EAAIC,UAAU,CAACD,OAAO,CAAE,GAAG,CAAC,CAAC,CAEtD7B,YAAY,CAAC,KAAK,CAAC,CACnBO,QAAQ,eAAAgB,MAAA,CAAeC,kBAAkB,CAACmC,QAAQ,CAAC,iBAAe,CAAC,CACnE,OACF,CACF,CACF,CAAE,MAAOF,YAAY,CAAE,CACrB1C,OAAO,CAACkC,IAAI,CAAC,kCAAkC,CAAEQ,YAAY,CAAC,CAChE,CAEArD,iBAAiB,CAAC,qDAAqD,CAAC,CACxE0B,UAAU,CAAC,IAAM,CACf9B,YAAY,CAAC,KAAK,CAAC,CACnBI,iBAAiB,CAAC,cAAc,CAAC,CACnC,CAAC,CAAE,IAAI,CAAC,CACR,OACF,CAEF,CAAE,MAAOkD,KAAK,CAAE,CACdvC,OAAO,CAACuC,KAAK,CAAC,iCAAiC,CAAEA,KAAK,CAAC,CACvDlD,iBAAiB,CAAC,oCAAoC,CAAC,CAEvD0B,UAAU,CAAC,IAAM,CACf9B,YAAY,CAAC,KAAK,CAAC,CACnBI,iBAAiB,CAAC,cAAc,CAAC,CACnC,CAAC,CAAE,IAAI,CAAC,CACV,CAAC,OAAS,CACRN,oBAAoB,CAAC,KAAK,CAAC,CAC7B,CACF,CAAC,CAED;AACAhB,SAAS,CAAC,IAAM,CACd,MAAO,IAAM,CACXkB,YAAY,CAAC,KAAK,CAAC,CACnBI,iBAAiB,CAAC,cAAc,CAAC,CACnC,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAA0D,cAA+D,CAAGC,IAAA,MAAC,CAAEC,OAAO,CAAEC,QAAS,CAAC,CAAAF,IAAA,oBAC5F1E,IAAA,QAAK6E,KAAK,CAAE,CACVC,QAAQ,CAAE,OAAO,CACjBC,GAAG,CAAE,CAAC,CACNC,IAAI,CAAE,CAAC,CACPC,KAAK,CAAE,CAAC,CACRC,MAAM,CAAE,CAAC,CACTC,eAAe,CAAE,oBAAoB,CACrCC,OAAO,CAAE,MAAM,CACfC,UAAU,CAAE,QAAQ,CACpBC,cAAc,CAAE,QAAQ,CACxBC,MAAM,CAAE,IACV,CAAE,CAAAC,QAAA,cACAtF,KAAA,QAAK2E,KAAK,CAAE,CACVM,eAAe,CAAE,OAAO,CACxBM,YAAY,CAAE,MAAM,CACpBC,OAAO,CAAE,MAAM,CACfC,SAAS,CAAE,QAAQ,CACnBC,QAAQ,CAAE,OAAO,CACjBC,SAAS,CAAE,gCACb,CAAE,CAAAL,QAAA,eAEAxF,IAAA,QAAK6E,KAAK,CAAE,CACViB,KAAK,CAAE,MAAM,CACbC,MAAM,CAAE,MAAM,CACdC,MAAM,CAAE,mBAAmB,CAC3BC,SAAS,CAAE,mBAAmB,CAC9BR,YAAY,CAAE,KAAK,CACnBS,SAAS,CAAE,yBAAyB,CACpCC,MAAM,CAAE,kBACV,CAAE,CAAE,CAAC,cAGLnG,IAAA,OAAI6E,KAAK,CAAE,CACTsB,MAAM,CAAE,WAAW,CACnBC,QAAQ,CAAE,MAAM,CAChBC,UAAU,CAAE,KAAK,CACjBC,KAAK,CAAE,SACT,CAAE,CAAAd,QAAA,CAAC,iBAEH,CAAI,CAAC,cAGLxF,IAAA,MAAG6E,KAAK,CAAE,CACRsB,MAAM,CAAE,YAAY,CACpBC,QAAQ,CAAE,MAAM,CAChBE,KAAK,CAAE,SACT,CAAE,CAAAd,QAAA,CAAC,8CAEH,CAAG,CAAC,cAGJxF,IAAA,QAAK6E,KAAK,CAAE,CACViB,KAAK,CAAE,MAAM,CACbC,MAAM,CAAE,KAAK,CACbZ,eAAe,CAAE,SAAS,CAC1BM,YAAY,CAAE,KAAK,CACnBc,QAAQ,CAAE,QAAQ,CAClBC,YAAY,CAAE,MAChB,CAAE,CAAAhB,QAAA,cACAxF,IAAA,QAAK6E,KAAK,CAAE,CACViB,KAAK,IAAA5D,MAAA,CAAK0C,QAAQ,KAAG,CACrBmB,MAAM,CAAE,MAAM,CACdZ,eAAe,CAAE,SAAS,CAC1BM,YAAY,CAAE,KAAK,CACnBgB,UAAU,CAAE,iBACd,CAAE,CAAE,CAAC,CACF,CAAC,cAGNvG,KAAA,MAAG2E,KAAK,CAAE,CACRsB,MAAM,CAAE,CAAC,CACTC,QAAQ,CAAE,MAAM,CAChBE,KAAK,CAAE,SACT,CAAE,CAAAd,QAAA,EACCZ,QAAQ,CAAC,YACZ,EAAG,CAAC,EACD,CAAC,CACH,CAAC,EACP,CAED,mBACE1E,KAAA,QAAKwG,SAAS,CAAC,gBAAgB,CAAAlB,QAAA,EAC5B9E,SAAS,eACRV,IAAA,CAACyE,cAAc,EACbE,OAAO,CAAE7D,cAAe,CACxB8D,QAAQ,CAAEvD,mBAAmB,CAACP,cAAc,CAAE,CAC/C,CACF,cAEDd,IAAA,CAACJ,cAAc,EACbkF,QAAQ,CAAC,WAAW,CACpB4B,SAAS,CAAC,mBAAmB,CAC7BC,YAAY,CAAEnF,gBAAiB,CAC/BoF,QAAQ,CAAEhF,YAAa,CACvBiF,SAAS,CAAEhF,aAAc,CAC1B,CAAC,cAEF3B,KAAA,QAAKwG,SAAS,CAAC,2BAA2B,CAAAlB,QAAA,eACxCxF,IAAA,QAAK0G,SAAS,CAAC,gBAAgB,CAAAlB,QAAA,CAC5B,CAAC5E,UAAU,cACVZ,IAAA,QACE8G,GAAG,CAAC,kDAAkD,CACtDC,GAAG,CAAC,kBAAkB,CACtBL,SAAS,CAAC,mBAAmB,CAC7BM,OAAO,CAAEA,CAAA,GAAMnG,aAAa,CAAC,IAAI,CAAE,CACnCoG,MAAM,CAAEA,CAAA,GAAMpG,aAAa,CAAC,KAAK,CAAE,CACpC,CAAC,cAEFb,IAAA,OAAI0G,SAAS,CAAC,aAAa,CAAAlB,QAAA,CAAC,kBAE5B,CAAI,CACL,CACE,CAAC,cAENtF,KAAA,QAAKwG,SAAS,CAAC,wBAAwB,CAAAlB,QAAA,eACrCxF,IAAA,SAAMkH,QAAQ,CAAGC,CAAC,EAAK,CACrBA,CAAC,CAACC,cAAc,CAAC,CAAC,CAClBtF,YAAY,CAAC,CAAC,CAChB,CAAE,CAAA0D,QAAA,cACAxF,IAAA,UACEqH,IAAI,CAAC,MAAM,CACXC,KAAK,CAAElH,WAAY,CACnBmH,QAAQ,CAAGJ,CAAC,EAAK9G,cAAc,CAAC8G,CAAC,CAACK,MAAM,CAACF,KAAK,CAAE,CAChDG,UAAU,CAAGN,CAAC,EAAKA,CAAC,CAACO,GAAG,GAAK,OAAO,EAAI5F,YAAY,CAAC,CAAE,CACvD6F,WAAW,CAAC,8BAA8B,CAC1CjB,SAAS,CAAC,cAAc,CACxBkB,SAAS,MACTC,QAAQ,CAAEnH,SAAU,CACrB,CAAC,CACE,CAAC,cAEPR,KAAA,QAAKwG,SAAS,CAAC,cAAc,CAAAlB,QAAA,EAC1BpF,WAAW,EAAI,CAACM,SAAS,eACxBV,IAAA,WACEqH,IAAI,CAAC,QAAQ,CACbS,OAAO,CAAEA,CAAA,GAAMzH,cAAc,CAAC,EAAE,CAAE,CAClCqG,SAAS,CAAC,0BAA0B,CACpC,aAAW,WAAW,CAAAlB,QAAA,cAEtBxF,IAAA,QAAK+H,OAAO,CAAC,WAAW,CAACC,IAAI,CAAC,cAAc,CAAAxC,QAAA,cAC1CxF,IAAA,SAAMiI,CAAC,CAAC,uGAAuG,CAAC,CAAC,CAC9G,CAAC,CACA,CACT,cAEDjI,IAAA,WACEqH,IAAI,CAAC,QAAQ,CACbS,OAAO,CAAEA,CAAA,GAAMrH,oBAAoB,CAAC,IAAI,CAAE,CAC1CiG,SAAS,CAAC,aAAa,CACvB,aAAW,cAAc,CACzBmB,QAAQ,CAAEnH,SAAU,CAAA8E,QAAA,cAEpBxF,IAAA,QAAK+H,OAAO,CAAC,WAAW,CAACC,IAAI,CAAC,cAAc,CAAAxC,QAAA,cAC1CxF,IAAA,SAAMiI,CAAC,CAAC,2JAA2J,CAAC,CAAC,CAClK,CAAC,CACA,CAAC,cAETjI,IAAA,WACEqH,IAAI,CAAC,QAAQ,CACbS,OAAO,CAAEA,CAAA,GAAM,CACb,GAAIpH,SAAS,CAAE,OAEf,GAAI,EAAE,yBAAyB,EAAI,CAAAwH,MAAM,CAAC,CAAE,CAC1CC,KAAK,CAAC,kDAAkD,CAAC,CACzD,OACF,CAEA,GAAI,CAAC/G,cAAc,CAACgH,OAAO,CAAE,CAC3B,KAAM,CAAAC,WAAW,CAAG,GAAK,CAAAH,MAAM,CAASI,uBAAuB,CAAC,CAAC,CACjED,WAAW,CAACE,UAAU,CAAG,KAAK,CAC9BF,WAAW,CAACG,cAAc,CAAG,KAAK,CAClCH,WAAW,CAACI,IAAI,CAAG,OAAO,CAE1BJ,WAAW,CAACK,OAAO,CAAG,IAAMnI,cAAc,CAAC,IAAI,CAAC,CAChD8H,WAAW,CAACM,QAAQ,CAAIC,KAAU,EAAK,CACrC,KAAM,CAAAC,UAAU,CAAGD,KAAK,CAACnF,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAACoF,UAAU,CACjDxI,cAAc,CAACwI,UAAU,CAAC,CAC1BtI,cAAc,CAAC,KAAK,CAAC,CACvB,CAAC,CACD8H,WAAW,CAACS,OAAO,CAAG,IAAMvI,cAAc,CAAC,KAAK,CAAC,CACjD8H,WAAW,CAACU,KAAK,CAAG,IAAMxI,cAAc,CAAC,KAAK,CAAC,CAE/Ca,cAAc,CAACgH,OAAO,CAAGC,WAAW,CACtC,CAEA,GAAI,CAAC/H,WAAW,CAAE,CAChBc,cAAc,CAACgH,OAAO,CAACY,KAAK,CAAC,CAAC,CAChC,CAAC,IAAM,CACL5H,cAAc,CAACgH,OAAO,CAACa,IAAI,CAAC,CAAC,CAC7B1I,cAAc,CAAC,KAAK,CAAC,CACvB,CACF,CAAE,CACFmG,SAAS,gBAAAxE,MAAA,CAAiB5B,WAAW,CAAG,WAAW,CAAG,EAAE,CAAG,CAC3D,aAAYA,WAAW,CAAG,gBAAgB,CAAG,mBAAoB,CACjEuH,QAAQ,CAAEnH,SAAU,CAAA8E,QAAA,cAEpBtF,KAAA,QAAK6H,OAAO,CAAC,WAAW,CAACC,IAAI,CAAC,cAAc,CAAAxC,QAAA,eAC1CxF,IAAA,SAAMiI,CAAC,CAAC,8EAA8E,CAAC,CAAC,cACxFjI,IAAA,SAAMiI,CAAC,CAAC,qGAAqG,CAAC,CAAC,EAC5G,CAAC,CACA,CAAC,EACN,CAAC,EACH,CAAC,cAEN/H,KAAA,QAAKwG,SAAS,CAAC,gBAAgB,CAAAlB,QAAA,eAC7BxF,IAAA,WACE8H,OAAO,CAAGX,CAAC,EAAK,CACdA,CAAC,CAACC,cAAc,CAAC,CAAC,CAClBtF,YAAY,CAAC,CAAC,CAChB,CAAE,CACF4E,SAAS,CAAC,oBAAoB,CAC9BmB,QAAQ,CAAE,CAACzH,WAAW,CAAC2B,IAAI,CAAC,CAAC,EAAIrB,SAAU,CAAA8E,QAAA,CAE1C9E,SAAS,CAAGI,cAAc,CAAG,mBAAmB,CAC3C,CAAC,cAETd,IAAA,WACE8H,OAAO,CAAEA,CAAA,GAAM,CACb,GAAIpH,SAAS,CAAE,OAEf,GAAIM,yBAAyB,CAAE,CAC7B;AACAC,4BAA4B,CAAC,KAAK,CAAC,CACnCZ,cAAc,CAAC,kBAAkB,CAAC,CACpC,CAAC,IAAM,CACL;AACAY,4BAA4B,CAAC,IAAI,CAAC,CACpC,CACF,CAAE,CACFyF,SAAS,CAAC,sBAAsB,CAChCW,IAAI,CAAC,QAAQ,CACbxC,KAAK,CAAE,CAAEyB,KAAK,CAAE,SAAU,CAAE,CAC5BuB,QAAQ,CAAEnH,SAAU,CAAA8E,QAAA,CACrB,qBAED,CAAQ,CAAC,EACN,CAAC,EACH,CAAC,CAELxE,yBAAyB,eACxBhB,IAAA,QACE0G,SAAS,CAAC,yBAAyB,CACnCoB,OAAO,CAAGX,CAAC,EAAK,CACd;AACA,GAAIA,CAAC,CAACK,MAAM,GAAKL,CAAC,CAAC+B,aAAa,CAAE,CAChCjI,4BAA4B,CAAC,KAAK,CAAC,CACnCZ,cAAc,CAAC,kBAAkB,CAAC,CACpC,CACF,CAAE,CAAAmF,QAAA,cAEFxF,IAAA,QAAK8H,OAAO,CAAGX,CAAC,EAAKA,CAAC,CAACgC,eAAe,CAAC,CAAE,CAAA3D,QAAA,cACvCxF,IAAA,CAACF,cAAc,EAACsJ,WAAW,CAAE,CAAE,CAAE,CAAC,CAC/B,CAAC,CACH,CACN,cAEDpJ,IAAA,CAACL,gBAAgB,EACf0J,MAAM,CAAE7I,iBAAkB,CAC1B8I,OAAO,CAAEA,CAAA,GAAM7I,oBAAoB,CAAC,KAAK,CAAE,CAC3C8I,kBAAkB,CAAElF,sBAAuB,CAC3CmF,KAAK,CAAC,cAAc,CACpBC,QAAQ,CAAC,2BAA2B,CACrC,CAAC,EACC,CAAC,CAEV,CAAC,CAED,cAAe,CAAAtJ,aAAa,CAE5B;AACA;AACA;AACA;AACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}