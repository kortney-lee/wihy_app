{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{BrowserRouter as Router,Routes,Route,useSearchParams,useNavigate,useLocation}from'react-router-dom';import VHealthSearch from'./components/search/VHealthSearch';import SearchResults from'./components/search/SearchResults';import TestChartsPage from'./pages/TestChartsPage';import{wihyAPI}from'./services/wihyAPI';import{searchCache}from'./services/searchCache';import{fetchNewsFeed,refreshNewsFeed,searchNewsArticles}from'./services/newsService';import{logger}from'./utils/logger';import'./styles/VHealthSearch.css';import'./index.css';import{API_CONFIG}from'./config/apiConfig';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_BASE_URL=API_CONFIG.WIHY_API_URL;// Use the ml.wihy.ai endpoint\nexport const searchFoodDatabase=async query=>{try{logger.apiRequest('Food Database Search',{query});const response=await fetch(\"\".concat(API_BASE_URL,\"/api/food/search?q=\").concat(encodeURIComponent(query)),{method:'GET',headers:{'Content-Type':'application/json'}});if(!response.ok){throw new Error(\"HTTP error! status: \".concat(response.status));}const data=await response.json();logger.apiResponse('Food Database Search',data);return data;}catch(error){console.error('Food database API error:',error);throw error;}};export const foodAPI={searchFood:searchFoodDatabase};// Export news API for use in other components\nexport const newsAPI={fetchNewsFeed,refreshNewsFeed,searchNewsArticles};const ResultsPage=()=>{const[searchParams]=useSearchParams();const navigate=useNavigate();const location=useLocation();const query=searchParams.get('q')||'';const isHealthNews=searchParams.get('type')==='health_news';const category=searchParams.get('category')||'all';const[isLoading,setIsLoading]=useState(false);const[results,setResults]=useState('');const[dataSource,setDataSource]=useState(\"local\");const[citations,setCitations]=useState([]);const[recommendations,setRecommendations]=useState([]);const[disclaimer,setDisclaimer]=useState('');const[apiResponse,setApiResponse]=useState(null);// Track if this is initial load to prevent loading spinner on browser navigation\nconst[isInitialLoad,setIsInitialLoad]=useState(true);// Add ref to prevent duplicate API calls\nconst lastProcessedQuery=useRef('');const isProcessing=useRef(false);// Detect browser navigation type\nconst isBrowserNavigation=()=>{var _performance,_performance$getEntri,_performance$getEntri2;const navigation=(_performance=window.performance)===null||_performance===void 0?void 0:(_performance$getEntri=_performance.getEntriesByType)===null||_performance$getEntri===void 0?void 0:(_performance$getEntri2=_performance$getEntri.call(_performance,'navigation'))===null||_performance$getEntri2===void 0?void 0:_performance$getEntri2[0];return(navigation===null||navigation===void 0?void 0:navigation.type)==='back_forward';};// Fetch results when query changes\nuseEffect(()=>{const fetchResults=async()=>{if(!query&&!isHealthNews){setIsLoading(false);return;}// Create cache key based on type\nconst cacheKey=isHealthNews?\"health_news_\".concat(category):query;// Check if we have fresh data from navigation (e.g., from Header search)\nconst navigationState=location.state;logger.debug('🔍 ResultsPage: Checking navigation state',{hasNavigationState:!!navigationState,fromSearch:navigationState===null||navigationState===void 0?void 0:navigationState.fromSearch,hasResults:!!(navigationState!==null&&navigationState!==void 0&&navigationState.results),hasApiResponse:!!(navigationState!==null&&navigationState!==void 0&&navigationState.apiResponse),query:query,cacheKey:cacheKey});if(navigationState!==null&&navigationState!==void 0&&navigationState.fromSearch&&navigationState!==null&&navigationState!==void 0&&navigationState.results){logger.info('🔍 ResultsPage: Using navigation state data (no API call needed)',{query,cacheKey});setResults(navigationState.results.details||navigationState.results.summary||'No results');setApiResponse(navigationState.apiResponse||null);// Set the API response for ChatWidget (may be null for cached data)\nsetDataSource(navigationState.dataSource||'wihy');setCitations(navigationState.results.sources||[]);setRecommendations(navigationState.results.recommendations||[]);setDisclaimer(navigationState.results.medicalDisclaimer||'');setIsLoading(false);return;}// Prevent duplicate processing\nif(isProcessing.current||lastProcessedQuery.current===cacheKey){logger.debug('Skipping duplicate query',{cacheKey});return;}logger.debug('Processing new query',{cacheKey});lastProcessedQuery.current=cacheKey;isProcessing.current=true;logger.debug('Query type analysis',{isHealthNews,isBrowserNavigation:isBrowserNavigation()});// Always check cache first - especially for browser navigation\nconst cachedResult=searchCache.getCachedResult(cacheKey);if(cachedResult){logger.cache('Using cached results',{cacheKey});setResults(cachedResult);setDataSource('local');setIsLoading(false);setCitations([]);setRecommendations([]);setDisclaimer('');setIsInitialLoad(false);isProcessing.current=false;// Reset processing flag\nreturn;// Exit early - no API calls needed\n}// If this is browser navigation and no cache, show placeholder content instead of redirecting\nif(isBrowserNavigation()||!isInitialLoad){logger.debug('Browser navigation detected with no cache - showing placeholder content');setResults('Please perform a new search to see results.');setDataSource('local');setIsLoading(false);setCitations([]);setRecommendations([]);setDisclaimer('');setIsInitialLoad(false);isProcessing.current=false;// Reset processing flag\nreturn;}// Only show loading for genuine new searches (not browser navigation)\nsetIsLoading(true);try{// Use WiHy Unified API for all types of searches\nlogger.apiRequest('WiHy Unified API',{type:isHealthNews?'health_news':'search',query:query||\"health news - \".concat(category)});let wihyResult;if(isHealthNews){// Handle health news requests\nlogger.debug('Fetching health news via WiHy API');const categories=category==='all'?[]:[category];wihyResult=await wihyAPI.getHealthNews(categories,6);}else{// Handle regular search queries (health, nutrition, etc.)\nlogger.debug('Making WiHy API call for query',{query});wihyResult=await wihyAPI.searchHealth(query);}logger.apiResponse('WiHy API result',wihyResult);if(wihyResult.success){const formattedResult=wihyAPI.formatWihyResponse(wihyResult);setResults(formattedResult);setDataSource(\"wihy\");setApiResponse(wihyResult);// Store the original API response\n// Cache the WiHy results (still cache the formatted result for legacy compatibility)\nsearchCache.setCachedResult(cacheKey,formattedResult,window.location.href);setCitations(wihyAPI.extractCitations(wihyResult));setRecommendations(wihyAPI.extractRecommendations(wihyResult));if(isHealthNews){setDisclaimer('Health news provided by WiHy AI. Always consult healthcare professionals for medical advice.');}else{setDisclaimer('This guidance is based on evidence-based health principles. Always consult healthcare professionals for personalized medical advice.');}}else{// Fallback: If WiHy fails, try legacy APIs\nlogger.warn('WiHy API failed, trying fallback methods');await handleFallbackAPIs();}}catch(error){logger.error(\"WiHy API error:\",error);// Try fallback APIs if WiHy fails\ntry{await handleFallbackAPIs();}catch(fallbackError){logger.error(\"All APIs failed:\",fallbackError);// Check for specific error types\nconst errorMessage=error.message||'';const fallbackErrorMessage=fallbackError.message||'';let userFriendlyMessage;if(errorMessage.includes('CORS_ERROR')){userFriendlyMessage=\"Oops! There's a configuration issue preventing us from reaching our AI services. 🔧 Our team is working on it - please try again later!\";}else if(errorMessage.includes('NETWORK_ERROR')||errorMessage.includes('TIMEOUT_ERROR')){userFriendlyMessage=\"Oops! Looks like we're having some technical difficulties. 🤖 Please come back in a few minutes while we fix things up!\";}else if(errorMessage.includes('SERVER_ERROR')){userFriendlyMessage=\"Our servers are taking a quick break! ☕ Please try again in a few minutes.\";}else if(fallbackErrorMessage.includes('fetch')||fallbackErrorMessage.includes('network')||error.name==='TypeError'){userFriendlyMessage=\"Looks like there's a connection hiccup! 📡 Please check your internet and try again.\";}else{userFriendlyMessage=\"Sorry, we're experiencing some issues right now. \\n\\n\\uD83C\\uDFE0 You can still use these features:\\n\\u2022  Browse health news (click \\\"I'm Feeling Healthy\\\") \\n\\u2022 \\uD83D\\uDCF7 Upload images for basic analysis\\n\\u2022 \\uD83D\\uDD0D Try visiting /test to see chart examples\\n\\u2022 \\uD83D\\uDCCA View charts in search results sidebar\\n\\nPlease try your search again in a moment! \\uD83D\\uDE05\";}setResults(userFriendlyMessage);setDataSource(\"error\");setCitations([]);setRecommendations([]);setDisclaimer('If this issue persists, please try refreshing the page or contact support.');}}finally{setIsLoading(false);setIsInitialLoad(false);isProcessing.current=false;// Always reset processing flag\n}};// Fallback function for legacy APIs\nconst handleFallbackAPIs=async()=>{if(isHealthNews){logger.debug('Fallback: Fetching health news via newsService');const healthNewsResult=await fetchNewsFeed([category],6);if(healthNewsResult.success&&healthNewsResult.articles){logger.info('Health news fetched successfully');// Format the news articles for display\nconst formattedNews=formatNewsArticles(healthNewsResult.articles);setResults(formattedNews);setDataSource('openai');// Use openai as the display source\n// Cache the health news results\nconst newsKey=\"health_news_\".concat(category);searchCache.setCachedResult(newsKey,formattedNews,window.location.href);setDisclaimer('Health news provided by AI. Always consult healthcare professionals for medical advice.');}else{throw new Error('Failed to fetch health news');}}else{// Try nutrition database for food-related queries\ntry{logger.debug('Fallback: Trying nutrition database');logger.debug('API URL',{url:\"\".concat(API_BASE_URL,\"/api/search/food?q=\").concat(encodeURIComponent(query))});const nutritionResponse=await fetch(\"\".concat(API_BASE_URL,\"/api/search/food?q=\").concat(encodeURIComponent(query)));if(nutritionResponse.ok){const nutritionData=await nutritionResponse.json();logger.apiResponse('Nutrition API',nutritionData);if(nutritionData&&nutritionData.found===true){logger.info('Found nutrition data - using vnutrition source');const resultString=JSON.stringify(nutritionData);setResults(resultString);setDataSource('vnutrition');// Cache the nutrition results\nsearchCache.setCachedResult(query,resultString,window.location.href);return;}}}catch(nutritionError){logger.debug('Nutrition API also failed',{error:nutritionError});}throw new Error('All fallback APIs failed');}};fetchResults();},[query,isHealthNews,category,location.state]);// Added location.state to dependencies\n// Function to format news articles for display\nconst formatNewsArticles=articles=>{let formatted='# Latest Health News\\n\\n';articles.forEach((article,index)=>{formatted+=\"## \".concat(article.title,\"\\n\\n\");formatted+=\"**Source:** \".concat(article.source,\" (\").concat(article.domain,\")\\n\");formatted+=\"**Category:** \".concat(article.category,\"\\n\");formatted+=\"**Published:** \".concat(new Date(article.publishedDate).toLocaleDateString(),\"\\n\");formatted+=\"**Relevance:** \".concat(Math.round(article.relevanceScore*100),\"%\\n\\n\");formatted+=\"\".concat(article.summary,\"\\n\\n\");if(article.tags&&article.tags.length>0){formatted+=\"**Tags:** \".concat(article.tags.join(', '),\"\\n\\n\");}formatted+=\"[Read Full Article](\".concat(article.url,\")\\n\\n\");formatted+='---\\n\\n';});return formatted;};const handleBackToSearch=()=>{navigate('/');};const handleNewSearch=newQuery=>{if(newQuery!==query){// Reset the initial load flag for new searches\nsetIsInitialLoad(true);navigate(\"/results?q=\".concat(encodeURIComponent(newQuery)));}};return/*#__PURE__*/_jsx(SearchResults,{query:isHealthNews?'Latest Health News':query,results:results,onBackToSearch:handleBackToSearch,onNewSearch:handleNewSearch,isLoading:isLoading,dataSource:dataSource,citations:citations,recommendations:recommendations,disclaimer:disclaimer,apiResponse:apiResponse});};const App=()=>{logger.debug(\"App component rendered\");return/*#__PURE__*/_jsx(Router,{children:/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(VHealthSearch,{})}),/*#__PURE__*/_jsx(Route,{path:\"/results\",element:/*#__PURE__*/_jsx(ResultsPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/test\",element:/*#__PURE__*/_jsx(TestChartsPage,{})})]})});};export default App;","map":{"version":3,"names":["React","useState","useEffect","useRef","BrowserRouter","Router","Routes","Route","useSearchParams","useNavigate","useLocation","VHealthSearch","SearchResults","TestChartsPage","wihyAPI","searchCache","fetchNewsFeed","refreshNewsFeed","searchNewsArticles","logger","API_CONFIG","jsx","_jsx","jsxs","_jsxs","API_BASE_URL","WIHY_API_URL","searchFoodDatabase","query","apiRequest","response","fetch","concat","encodeURIComponent","method","headers","ok","Error","status","data","json","apiResponse","error","console","foodAPI","searchFood","newsAPI","ResultsPage","searchParams","navigate","location","get","isHealthNews","category","isLoading","setIsLoading","results","setResults","dataSource","setDataSource","citations","setCitations","recommendations","setRecommendations","disclaimer","setDisclaimer","setApiResponse","isInitialLoad","setIsInitialLoad","lastProcessedQuery","isProcessing","isBrowserNavigation","_performance","_performance$getEntri","_performance$getEntri2","navigation","window","performance","getEntriesByType","call","type","fetchResults","cacheKey","navigationState","state","debug","hasNavigationState","fromSearch","hasResults","hasApiResponse","info","details","summary","sources","medicalDisclaimer","current","cachedResult","getCachedResult","cache","wihyResult","categories","getHealthNews","searchHealth","success","formattedResult","formatWihyResponse","setCachedResult","href","extractCitations","extractRecommendations","warn","handleFallbackAPIs","fallbackError","errorMessage","message","fallbackErrorMessage","userFriendlyMessage","includes","name","healthNewsResult","articles","formattedNews","formatNewsArticles","newsKey","url","nutritionResponse","nutritionData","found","resultString","JSON","stringify","nutritionError","formatted","forEach","article","index","title","source","domain","Date","publishedDate","toLocaleDateString","Math","round","relevanceScore","tags","length","join","handleBackToSearch","handleNewSearch","newQuery","onBackToSearch","onNewSearch","App","children","path","element"],"sources":["C:/repo/wihy_ui/client/src/App.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { BrowserRouter as Router, Routes, Route, useSearchParams, useNavigate, useLocation } from 'react-router-dom';\r\nimport VHealthSearch from './components/search/VHealthSearch';\r\nimport SearchResults from './components/search/SearchResults';\r\nimport HealthNewsFeed from './components/HealthNewsFeed';\r\nimport TestChartsPage from './pages/TestChartsPage';\r\nimport openaiAPI from './services/openaiAPI';\r\nimport { wihyAPI } from './services/wihyAPI';\r\nimport { searchCache } from './services/searchCache';\r\nimport { fetchNewsFeed, refreshNewsFeed, searchNewsArticles } from './services/newsService';\r\nimport { logger } from './utils/logger';\r\nimport './styles/VHealthSearch.css';\r\nimport './index.css';\r\nimport VHealthApp from './vHealthApp';\r\nimport { API_CONFIG, getApiEndpoint } from './config/apiConfig';\r\n\r\nconst API_BASE_URL = API_CONFIG.WIHY_API_URL; // Use the ml.wihy.ai endpoint\r\n\r\nexport const searchFoodDatabase = async (query: string) => {\r\n  try {\r\n    logger.apiRequest('Food Database Search', { query });\r\n    \r\n    const response = await fetch(`${API_BASE_URL}/api/food/search?q=${encodeURIComponent(query)}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP error! status: ${response.status}`);\r\n    }\r\n\r\n    const data = await response.json();\r\n    logger.apiResponse('Food Database Search', data);\r\n    \r\n    return data;\r\n  } catch (error) {\r\n    console.error('Food database API error:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const foodAPI = {\r\n  searchFood: searchFoodDatabase\r\n};\r\n\r\n// Export news API for use in other components\r\nexport const newsAPI = {\r\n  fetchNewsFeed,\r\n  refreshNewsFeed,\r\n  searchNewsArticles\r\n};\r\n\r\ntype AllowedDataSource = \"error\" | \"openai\" | \"local\" | \"vnutrition\" | \"wihy\";\r\n\r\nconst ResultsPage: React.FC = () => {\r\n  const [searchParams] = useSearchParams();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const query = searchParams.get('q') || '';\r\n  const isHealthNews = searchParams.get('type') === 'health_news';\r\n  const category = searchParams.get('category') || 'all';\r\n  \r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [results, setResults] = useState<string>('');\r\n  const [dataSource, setDataSource] = useState<AllowedDataSource>(\"local\");\r\n  const [citations, setCitations] = useState<string[]>([]);\r\n  const [recommendations, setRecommendations] = useState<string[]>([]);\r\n  const [disclaimer, setDisclaimer] = useState<string>('');\r\n  const [apiResponse, setApiResponse] = useState<any>(null);\r\n  \r\n  // Track if this is initial load to prevent loading spinner on browser navigation\r\n  const [isInitialLoad, setIsInitialLoad] = useState(true);\r\n  \r\n  // Add ref to prevent duplicate API calls\r\n  const lastProcessedQuery = useRef<string>('');\r\n  const isProcessing = useRef<boolean>(false);\r\n  \r\n  // Detect browser navigation type\r\n  const isBrowserNavigation = () => {\r\n    const navigation = (window as any).performance?.getEntriesByType?.('navigation')?.[0];\r\n    return navigation?.type === 'back_forward';\r\n  };\r\n\r\n  // Fetch results when query changes\r\n  useEffect(() => {\r\n    const fetchResults = async () => {\r\n      if (!query && !isHealthNews) {\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n      \r\n      // Create cache key based on type\r\n      const cacheKey = isHealthNews ? `health_news_${category}` : query;\r\n      \r\n      // Check if we have fresh data from navigation (e.g., from Header search)\r\n      const navigationState = location.state as any;\r\n      logger.debug('🔍 ResultsPage: Checking navigation state', { \r\n        hasNavigationState: !!navigationState,\r\n        fromSearch: navigationState?.fromSearch,\r\n        hasResults: !!navigationState?.results,\r\n        hasApiResponse: !!navigationState?.apiResponse,\r\n        query: query,\r\n        cacheKey: cacheKey\r\n      });\r\n      \r\n      if (navigationState?.fromSearch && navigationState?.results) {\r\n        logger.info('🔍 ResultsPage: Using navigation state data (no API call needed)', { query, cacheKey });\r\n        setResults(navigationState.results.details || navigationState.results.summary || 'No results');\r\n        setApiResponse(navigationState.apiResponse || null); // Set the API response for ChatWidget (may be null for cached data)\r\n        setDataSource(navigationState.dataSource || 'wihy');\r\n        setCitations(navigationState.results.sources || []);\r\n        setRecommendations(navigationState.results.recommendations || []);\r\n        setDisclaimer(navigationState.results.medicalDisclaimer || '');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n      \r\n      // Prevent duplicate processing\r\n      if (isProcessing.current || lastProcessedQuery.current === cacheKey) {\r\n        logger.debug('Skipping duplicate query', { cacheKey });\r\n        return;\r\n      }\r\n      \r\n      logger.debug('Processing new query', { cacheKey });\r\n      lastProcessedQuery.current = cacheKey;\r\n      isProcessing.current = true;\r\n      \r\n      logger.debug('Query type analysis', { \r\n        isHealthNews, \r\n        isBrowserNavigation: isBrowserNavigation() \r\n      });\r\n      \r\n      // Always check cache first - especially for browser navigation\r\n      const cachedResult = searchCache.getCachedResult(cacheKey);\r\n      if (cachedResult) {\r\n        logger.cache('Using cached results', { cacheKey });\r\n        setResults(cachedResult);\r\n        setDataSource('local');\r\n        setIsLoading(false);\r\n        setCitations([]);\r\n        setRecommendations([]);\r\n        setDisclaimer('');\r\n        setIsInitialLoad(false);\r\n        isProcessing.current = false; // Reset processing flag\r\n        return; // Exit early - no API calls needed\r\n      }\r\n      \r\n      // If this is browser navigation and no cache, show placeholder content instead of redirecting\r\n      if (isBrowserNavigation() || !isInitialLoad) {\r\n        logger.debug('Browser navigation detected with no cache - showing placeholder content');\r\n        setResults('Please perform a new search to see results.');\r\n        setDataSource('local');\r\n        setIsLoading(false);\r\n        setCitations([]);\r\n        setRecommendations([]);\r\n        setDisclaimer('');\r\n        setIsInitialLoad(false);\r\n        isProcessing.current = false; // Reset processing flag\r\n        return;\r\n      }\r\n      \r\n      // Only show loading for genuine new searches (not browser navigation)\r\n      setIsLoading(true);\r\n      \r\n      try {\r\n        // Use WiHy Unified API for all types of searches\r\n        logger.apiRequest('WiHy Unified API', { \r\n          type: isHealthNews ? 'health_news' : 'search',\r\n          query: query || `health news - ${category}` \r\n        });\r\n        \r\n        let wihyResult: any;\r\n        \r\n        if (isHealthNews) {\r\n          // Handle health news requests\r\n          logger.debug('Fetching health news via WiHy API');\r\n          const categories = category === 'all' ? [] : [category];\r\n          wihyResult = await wihyAPI.getHealthNews(categories, 6);\r\n        } else {\r\n          // Handle regular search queries (health, nutrition, etc.)\r\n          logger.debug('Making WiHy API call for query', { query });\r\n          wihyResult = await wihyAPI.searchHealth(query);\r\n        }\r\n        \r\n        logger.apiResponse('WiHy API result', wihyResult);\r\n        \r\n        if (wihyResult.success) {\r\n          const formattedResult = wihyAPI.formatWihyResponse(wihyResult);\r\n          setResults(formattedResult);\r\n          setDataSource(\"wihy\");\r\n          setApiResponse(wihyResult); // Store the original API response\r\n          \r\n          // Cache the WiHy results (still cache the formatted result for legacy compatibility)\r\n          searchCache.setCachedResult(cacheKey, formattedResult, window.location.href);\r\n          \r\n          setCitations(wihyAPI.extractCitations(wihyResult));\r\n          setRecommendations(wihyAPI.extractRecommendations(wihyResult));\r\n          \r\n          if (isHealthNews) {\r\n            setDisclaimer('Health news provided by WiHy AI. Always consult healthcare professionals for medical advice.');\r\n          } else {\r\n            setDisclaimer('This guidance is based on evidence-based health principles. Always consult healthcare professionals for personalized medical advice.');\r\n          }\r\n        } else {\r\n          // Fallback: If WiHy fails, try legacy APIs\r\n          logger.warn('WiHy API failed, trying fallback methods');\r\n          await handleFallbackAPIs();\r\n        }\r\n        \r\n      } catch (error) {\r\n        logger.error(\"WiHy API error:\", error);\r\n        // Try fallback APIs if WiHy fails\r\n        try {\r\n          await handleFallbackAPIs();\r\n        } catch (fallbackError) {\r\n          logger.error(\"All APIs failed:\", fallbackError);\r\n          \r\n          // Check for specific error types\r\n          const errorMessage = error.message || '';\r\n          const fallbackErrorMessage = fallbackError.message || '';\r\n          \r\n          let userFriendlyMessage;\r\n          \r\n          if (errorMessage.includes('CORS_ERROR')) {\r\n            userFriendlyMessage = \"Oops! There's a configuration issue preventing us from reaching our AI services. 🔧 Our team is working on it - please try again later!\";\r\n          } else if (errorMessage.includes('NETWORK_ERROR') || errorMessage.includes('TIMEOUT_ERROR')) {\r\n            userFriendlyMessage = \"Oops! Looks like we're having some technical difficulties. 🤖 Please come back in a few minutes while we fix things up!\";\r\n          } else if (errorMessage.includes('SERVER_ERROR')) {\r\n            userFriendlyMessage = \"Our servers are taking a quick break! ☕ Please try again in a few minutes.\";\r\n          } else if (fallbackErrorMessage.includes('fetch') || \r\n                     fallbackErrorMessage.includes('network') || \r\n                     error.name === 'TypeError') {\r\n            userFriendlyMessage = \"Looks like there's a connection hiccup! 📡 Please check your internet and try again.\";\r\n          } else {\r\n            userFriendlyMessage = `Sorry, we're experiencing some issues right now. \r\n\r\n🏠 You can still use these features:\r\n•  Browse health news (click \"I'm Feeling Healthy\") \r\n• 📷 Upload images for basic analysis\r\n• 🔍 Try visiting /test to see chart examples\r\n• 📊 View charts in search results sidebar\r\n\r\nPlease try your search again in a moment! 😅`;\r\n          }\r\n          \r\n          setResults(userFriendlyMessage);\r\n          setDataSource(\"error\");\r\n          \r\n          setCitations([]);\r\n          setRecommendations([]);\r\n          setDisclaimer('If this issue persists, please try refreshing the page or contact support.');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n        setIsInitialLoad(false);\r\n        isProcessing.current = false; // Always reset processing flag\r\n      }\r\n    };\r\n\r\n    // Fallback function for legacy APIs\r\n    const handleFallbackAPIs = async () => {\r\n      if (isHealthNews) {\r\n        logger.debug('Fallback: Fetching health news via newsService');\r\n        const healthNewsResult = await fetchNewsFeed([category], 6);\r\n        \r\n        if (healthNewsResult.success && healthNewsResult.articles) {\r\n          logger.info('Health news fetched successfully');\r\n          \r\n          // Format the news articles for display\r\n          const formattedNews = formatNewsArticles(healthNewsResult.articles);\r\n          \r\n          setResults(formattedNews);\r\n          setDataSource('openai'); // Use openai as the display source\r\n          \r\n          // Cache the health news results\r\n          const newsKey = `health_news_${category}`;\r\n          searchCache.setCachedResult(newsKey, formattedNews, window.location.href);\r\n          \r\n          setDisclaimer('Health news provided by AI. Always consult healthcare professionals for medical advice.');\r\n        } else {\r\n          throw new Error('Failed to fetch health news');\r\n        }\r\n      } else {\r\n        // Try nutrition database for food-related queries\r\n        try {\r\n          logger.debug('Fallback: Trying nutrition database');\r\n          logger.debug('API URL', { url: `${API_BASE_URL}/api/search/food?q=${encodeURIComponent(query)}` });\r\n          \r\n          const nutritionResponse = await fetch(`${API_BASE_URL}/api/search/food?q=${encodeURIComponent(query)}`);\r\n          \r\n          if (nutritionResponse.ok) {\r\n            const nutritionData = await nutritionResponse.json();\r\n            logger.apiResponse('Nutrition API', nutritionData);\r\n            \r\n            if (nutritionData && nutritionData.found === true) {\r\n              logger.info('Found nutrition data - using vnutrition source');\r\n              const resultString = JSON.stringify(nutritionData);\r\n              setResults(resultString);\r\n              setDataSource('vnutrition');\r\n              \r\n              // Cache the nutrition results\r\n              searchCache.setCachedResult(query, resultString, window.location.href);\r\n              return;\r\n            }\r\n          }\r\n        } catch (nutritionError) {\r\n          logger.debug('Nutrition API also failed', { error: nutritionError });\r\n        }\r\n        \r\n        throw new Error('All fallback APIs failed');\r\n      }\r\n    };\r\n    \r\n    fetchResults();\r\n  }, [query, isHealthNews, category, location.state]); // Added location.state to dependencies\r\n\r\n  // Function to format news articles for display\r\n  const formatNewsArticles = (articles: any[]): string => {\r\n    let formatted = '# Latest Health News\\n\\n';\r\n    \r\n    articles.forEach((article, index) => {\r\n      formatted += `## ${article.title}\\n\\n`;\r\n      formatted += `**Source:** ${article.source} (${article.domain})\\n`;\r\n      formatted += `**Category:** ${article.category}\\n`;\r\n      formatted += `**Published:** ${new Date(article.publishedDate).toLocaleDateString()}\\n`;\r\n      formatted += `**Relevance:** ${Math.round(article.relevanceScore * 100)}%\\n\\n`;\r\n      formatted += `${article.summary}\\n\\n`;\r\n      \r\n      if (article.tags && article.tags.length > 0) {\r\n        formatted += `**Tags:** ${article.tags.join(', ')}\\n\\n`;\r\n      }\r\n      \r\n      formatted += `[Read Full Article](${article.url})\\n\\n`;\r\n      formatted += '---\\n\\n';\r\n    });\r\n    \r\n    return formatted;\r\n  };\r\n\r\n  const handleBackToSearch = () => {\r\n    navigate('/');\r\n  };\r\n\r\n  const handleNewSearch = (newQuery: string) => {\r\n    if (newQuery !== query) {\r\n      // Reset the initial load flag for new searches\r\n      setIsInitialLoad(true);\r\n      navigate(`/results?q=${encodeURIComponent(newQuery)}`);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <SearchResults\r\n      query={isHealthNews ? 'Latest Health News' : query}\r\n      results={results}\r\n      onBackToSearch={handleBackToSearch}\r\n      onNewSearch={handleNewSearch}\r\n      isLoading={isLoading}\r\n      dataSource={dataSource}\r\n      citations={citations}\r\n      recommendations={recommendations}\r\n      disclaimer={disclaimer}\r\n      apiResponse={apiResponse}\r\n    />\r\n  );\r\n};\r\n\r\nconst App: React.FC = () => {\r\n  logger.debug(\"App component rendered\");\r\n  \r\n  return (\r\n    <Router>\r\n      <Routes>\r\n        <Route path=\"/\" element={<VHealthSearch />} />\r\n        <Route path=\"/results\" element={<ResultsPage />} />\r\n        <Route path=\"/test\" element={<TestChartsPage />} />\r\n      </Routes>\r\n    </Router>\r\n  );\r\n};\r\n\r\nexport default App;\r\n\r\ninterface ChatGPTResponse {\r\n  details?: string;\r\n  sources?: string[];\r\n  recommendations?: string[];\r\n  medicalDisclaimer?: string;\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}