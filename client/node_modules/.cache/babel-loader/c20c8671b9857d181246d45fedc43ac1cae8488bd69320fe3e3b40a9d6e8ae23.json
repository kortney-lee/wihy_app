{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{BrowserRouter as Router,Routes,Route,useSearchParams,useNavigate}from'react-router-dom';import VHealthSearch from'./VHealthSearch';import SearchResults from'./SearchResults';import{wihyAPI}from'./services/wihyAPI';import{searchCache}from'./services/searchCache';import{fetchNewsFeed,refreshNewsFeed,searchNewsArticles}from'./services/newsService';import{logger}from'./utils/logger';import'./styles/VHealthSearch.css';import'./index.css';import{API_CONFIG}from'./config/apiConfig';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_BASE_URL=API_CONFIG.BASE_URL.replace(/\\/api$/,'');// Remove /api suffix\nexport const searchFoodDatabase=async query=>{try{logger.apiRequest('Food Database Search',{query});const response=await fetch(\"\".concat(API_BASE_URL,\"/api/food/search?q=\").concat(encodeURIComponent(query)),{method:'GET',headers:{'Content-Type':'application/json'}});if(!response.ok){throw new Error(\"HTTP error! status: \".concat(response.status));}const data=await response.json();logger.apiResponse('Food Database Search',data);return data;}catch(error){console.error('Food database API error:',error);throw error;}};export const foodAPI={searchFood:searchFoodDatabase};// Export news API for use in other components\nexport const newsAPI={fetchNewsFeed,refreshNewsFeed,searchNewsArticles};const ResultsPage=()=>{const[searchParams]=useSearchParams();const navigate=useNavigate();const query=searchParams.get('q')||'';const isHealthNews=searchParams.get('type')==='health_news';const category=searchParams.get('category')||'all';const[isLoading,setIsLoading]=useState(false);const[results,setResults]=useState('');const[dataSource,setDataSource]=useState(\"local\");const[citations,setCitations]=useState([]);const[recommendations,setRecommendations]=useState([]);const[disclaimer,setDisclaimer]=useState('');// Track if this is initial load to prevent loading spinner on browser navigation\nconst[isInitialLoad,setIsInitialLoad]=useState(true);// Add ref to prevent duplicate API calls\nconst lastProcessedQuery=useRef('');const isProcessing=useRef(false);// Detect browser navigation type\nconst isBrowserNavigation=()=>{var _performance,_performance$getEntri,_performance$getEntri2;const navigation=(_performance=window.performance)===null||_performance===void 0?void 0:(_performance$getEntri=_performance.getEntriesByType)===null||_performance$getEntri===void 0?void 0:(_performance$getEntri2=_performance$getEntri.call(_performance,'navigation'))===null||_performance$getEntri2===void 0?void 0:_performance$getEntri2[0];return(navigation===null||navigation===void 0?void 0:navigation.type)==='back_forward';};// Fetch results when query changes\nuseEffect(()=>{const fetchResults=async()=>{if(!query&&!isHealthNews){setIsLoading(false);return;}// Create cache key based on type\nconst cacheKey=isHealthNews?\"health_news_\".concat(category):query;// Prevent duplicate processing\nif(isProcessing.current||lastProcessedQuery.current===cacheKey){logger.debug('Skipping duplicate query',{cacheKey});return;}logger.debug('Processing new query',{cacheKey});lastProcessedQuery.current=cacheKey;isProcessing.current=true;logger.debug('Query type analysis',{isHealthNews,isBrowserNavigation:isBrowserNavigation()});// Always check cache first - especially for browser navigation\nconst cachedResult=searchCache.getCachedResult(cacheKey);if(cachedResult){logger.cache('Using cached results',{cacheKey});setResults(cachedResult);setDataSource('local');setIsLoading(false);setCitations([]);setRecommendations([]);setDisclaimer('');setIsInitialLoad(false);isProcessing.current=false;// Reset processing flag\nreturn;// Exit early - no API calls needed\n}// If this is browser navigation and no cache, redirect to search page\nif(isBrowserNavigation()||!isInitialLoad){logger.debug('Browser navigation detected with no cache - redirecting to search');isProcessing.current=false;// Reset processing flag\nnavigate('/');return;}// Only show loading for genuine new searches (not browser navigation)\nsetIsLoading(true);try{// Use WiHy Unified API for all types of searches\nlogger.apiRequest('WiHy Unified API',{type:isHealthNews?'health_news':'search',query:query||\"health news - \".concat(category)});let wihyResult;if(isHealthNews){// Handle health news requests\nlogger.debug('Fetching health news via WiHy API');const categories=category==='all'?[]:[category];wihyResult=await wihyAPI.getHealthNews(categories,6);}else{// Handle regular search queries (health, nutrition, etc.)\nlogger.debug('Making WiHy API call for query',{query});wihyResult=await wihyAPI.searchHealth(query);}logger.apiResponse('WiHy API result',wihyResult);if(wihyResult.success){const formattedResult=wihyAPI.formatWihyResponse(wihyResult);setResults(formattedResult);setDataSource(\"wihy\");// Cache the WiHy results\nsearchCache.setCachedResult(cacheKey,formattedResult,window.location.href);setCitations(wihyAPI.extractCitations(wihyResult));setRecommendations(wihyAPI.extractRecommendations(wihyResult));if(isHealthNews){setDisclaimer('Health news provided by WiHy AI. Always consult healthcare professionals for medical advice.');}else{setDisclaimer('This guidance is based on evidence-based health principles. Always consult healthcare professionals for personalized medical advice.');}}else{// Fallback: If WiHy fails, try legacy APIs\nlogger.warn('WiHy API failed, trying fallback methods');await handleFallbackAPIs();}}catch(error){console.error(\"WiHy API error:\",error);// Try fallback APIs if WiHy fails\ntry{await handleFallbackAPIs();}catch(fallbackError){console.error(\"All APIs failed:\",fallbackError);const errorMessage=\"Sorry, there was an error processing your request.\";setResults(errorMessage);setDataSource(\"error\");setCitations([]);setRecommendations([]);setDisclaimer('');}}finally{setIsLoading(false);setIsInitialLoad(false);isProcessing.current=false;// Always reset processing flag\n}};// Fallback function for legacy APIs\nconst handleFallbackAPIs=async()=>{if(isHealthNews){logger.debug('Fallback: Fetching health news via newsService');const healthNewsResult=await fetchNewsFeed([category],6);if(healthNewsResult.success&&healthNewsResult.articles){logger.info('Health news fetched successfully');// Format the news articles for display\nconst formattedNews=formatNewsArticles(healthNewsResult.articles);setResults(formattedNews);setDataSource('openai');// Use openai as the display source\n// Cache the health news results\nconst newsKey=\"health_news_\".concat(category);searchCache.setCachedResult(newsKey,formattedNews,window.location.href);setDisclaimer('Health news provided by AI. Always consult healthcare professionals for medical advice.');}else{throw new Error(healthNewsResult.message||'Failed to fetch health news');}}else{// Try nutrition database for food-related queries\ntry{logger.debug('Fallback: Trying nutrition database');logger.debug('API URL',{url:\"\".concat(API_BASE_URL,\"/api/search/food?q=\").concat(encodeURIComponent(query))});const nutritionResponse=await fetch(\"\".concat(API_BASE_URL,\"/api/search/food?q=\").concat(encodeURIComponent(query)));if(nutritionResponse.ok){const nutritionData=await nutritionResponse.json();logger.apiResponse('Nutrition API',nutritionData);if(nutritionData&&nutritionData.found===true){logger.info('Found nutrition data - using vnutrition source');const resultString=JSON.stringify(nutritionData);setResults(resultString);setDataSource('vnutrition');// Cache the nutrition results\nsearchCache.setCachedResult(query,resultString,window.location.href);return;}}}catch(nutritionError){logger.debug('Nutrition API also failed',{error:nutritionError});}throw new Error('All fallback APIs failed');}};fetchResults();},[query,isHealthNews,category]);// Removed 'navigate' from dependencies\n// Function to format news articles for display\nconst formatNewsArticles=articles=>{let formatted='# Latest Health News\\n\\n';articles.forEach((article,index)=>{formatted+=\"## \".concat(article.title,\"\\n\\n\");formatted+=\"**Source:** \".concat(article.source,\" (\").concat(article.domain,\")\\n\");formatted+=\"**Category:** \".concat(article.category,\"\\n\");formatted+=\"**Published:** \".concat(new Date(article.publishedDate).toLocaleDateString(),\"\\n\");formatted+=\"**Relevance:** \".concat(Math.round(article.relevanceScore*100),\"%\\n\\n\");formatted+=\"\".concat(article.summary,\"\\n\\n\");if(article.tags&&article.tags.length>0){formatted+=\"**Tags:** \".concat(article.tags.join(', '),\"\\n\\n\");}formatted+=\"[Read Full Article](\".concat(article.url,\")\\n\\n\");formatted+='---\\n\\n';});return formatted;};const handleBackToSearch=()=>{navigate('/');};const handleNewSearch=newQuery=>{if(newQuery!==query){// Reset the initial load flag for new searches\nsetIsInitialLoad(true);navigate(\"/results?q=\".concat(encodeURIComponent(newQuery)));}};return/*#__PURE__*/_jsx(SearchResults,{query:isHealthNews?'Latest Health News':query,results:results,onBackToSearch:handleBackToSearch,onNewSearch:handleNewSearch,isLoading:isLoading,dataSource:dataSource,citations:citations,recommendations:recommendations,disclaimer:disclaimer});};const App=()=>{logger.debug(\"App component rendered\");return/*#__PURE__*/_jsx(Router,{children:/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(VHealthSearch,{})}),/*#__PURE__*/_jsx(Route,{path:\"/results\",element:/*#__PURE__*/_jsx(ResultsPage,{})})]})});};export default App;","map":{"version":3,"names":["React","useState","useEffect","useRef","BrowserRouter","Router","Routes","Route","useSearchParams","useNavigate","VHealthSearch","SearchResults","wihyAPI","searchCache","fetchNewsFeed","refreshNewsFeed","searchNewsArticles","logger","API_CONFIG","jsx","_jsx","jsxs","_jsxs","API_BASE_URL","BASE_URL","replace","searchFoodDatabase","query","apiRequest","response","fetch","concat","encodeURIComponent","method","headers","ok","Error","status","data","json","apiResponse","error","console","foodAPI","searchFood","newsAPI","ResultsPage","searchParams","navigate","get","isHealthNews","category","isLoading","setIsLoading","results","setResults","dataSource","setDataSource","citations","setCitations","recommendations","setRecommendations","disclaimer","setDisclaimer","isInitialLoad","setIsInitialLoad","lastProcessedQuery","isProcessing","isBrowserNavigation","_performance","_performance$getEntri","_performance$getEntri2","navigation","window","performance","getEntriesByType","call","type","fetchResults","cacheKey","current","debug","cachedResult","getCachedResult","cache","wihyResult","categories","getHealthNews","searchHealth","success","formattedResult","formatWihyResponse","setCachedResult","location","href","extractCitations","extractRecommendations","warn","handleFallbackAPIs","fallbackError","errorMessage","healthNewsResult","articles","info","formattedNews","formatNewsArticles","newsKey","message","url","nutritionResponse","nutritionData","found","resultString","JSON","stringify","nutritionError","formatted","forEach","article","index","title","source","domain","Date","publishedDate","toLocaleDateString","Math","round","relevanceScore","summary","tags","length","join","handleBackToSearch","handleNewSearch","newQuery","onBackToSearch","onNewSearch","App","children","path","element"],"sources":["C:/repo/wihy_ui/client/src/App.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { BrowserRouter as Router, Routes, Route, useSearchParams, useNavigate } from 'react-router-dom';\r\nimport VHealthSearch from './VHealthSearch';\r\nimport SearchResults from './SearchResults';\r\nimport HealthNewsFeed from './components/HealthNewsFeed';\r\nimport openaiAPI from './services/openaiAPI';\r\nimport { wihyAPI } from './services/wihyAPI';\r\nimport { searchCache } from './services/searchCache';\r\nimport { fetchNewsFeed, refreshNewsFeed, searchNewsArticles } from './services/newsService';\r\nimport { logger } from './utils/logger';\r\nimport './styles/VHealthSearch.css';\r\nimport './index.css';\r\nimport VHealthApp from './vHealthApp';\r\nimport { API_CONFIG, getApiEndpoint } from './config/apiConfig';\r\n\r\nconst API_BASE_URL = API_CONFIG.BASE_URL.replace(/\\/api$/, ''); // Remove /api suffix\r\n\r\nexport const searchFoodDatabase = async (query: string) => {\r\n  try {\r\n    logger.apiRequest('Food Database Search', { query });\r\n    \r\n    const response = await fetch(`${API_BASE_URL}/api/food/search?q=${encodeURIComponent(query)}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP error! status: ${response.status}`);\r\n    }\r\n\r\n    const data = await response.json();\r\n    logger.apiResponse('Food Database Search', data);\r\n    \r\n    return data;\r\n  } catch (error) {\r\n    console.error('Food database API error:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const foodAPI = {\r\n  searchFood: searchFoodDatabase\r\n};\r\n\r\n// Export news API for use in other components\r\nexport const newsAPI = {\r\n  fetchNewsFeed,\r\n  refreshNewsFeed,\r\n  searchNewsArticles\r\n};\r\n\r\ntype AllowedDataSource = \"error\" | \"openai\" | \"local\" | \"vnutrition\" | \"wihy\";\r\n\r\nconst ResultsPage: React.FC = () => {\r\n  const [searchParams] = useSearchParams();\r\n  const navigate = useNavigate();\r\n  const query = searchParams.get('q') || '';\r\n  const isHealthNews = searchParams.get('type') === 'health_news';\r\n  const category = searchParams.get('category') || 'all';\r\n  \r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [results, setResults] = useState<string>('');\r\n  const [dataSource, setDataSource] = useState<AllowedDataSource>(\"local\");\r\n  const [citations, setCitations] = useState<string[]>([]);\r\n  const [recommendations, setRecommendations] = useState<string[]>([]);\r\n  const [disclaimer, setDisclaimer] = useState<string>('');\r\n  \r\n  // Track if this is initial load to prevent loading spinner on browser navigation\r\n  const [isInitialLoad, setIsInitialLoad] = useState(true);\r\n  \r\n  // Add ref to prevent duplicate API calls\r\n  const lastProcessedQuery = useRef<string>('');\r\n  const isProcessing = useRef<boolean>(false);\r\n  \r\n  // Detect browser navigation type\r\n  const isBrowserNavigation = () => {\r\n    const navigation = (window as any).performance?.getEntriesByType?.('navigation')?.[0];\r\n    return navigation?.type === 'back_forward';\r\n  };\r\n\r\n  // Fetch results when query changes\r\n  useEffect(() => {\r\n    const fetchResults = async () => {\r\n      if (!query && !isHealthNews) {\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n      \r\n      // Create cache key based on type\r\n      const cacheKey = isHealthNews ? `health_news_${category}` : query;\r\n      \r\n      // Prevent duplicate processing\r\n      if (isProcessing.current || lastProcessedQuery.current === cacheKey) {\r\n        logger.debug('Skipping duplicate query', { cacheKey });\r\n        return;\r\n      }\r\n      \r\n      logger.debug('Processing new query', { cacheKey });\r\n      lastProcessedQuery.current = cacheKey;\r\n      isProcessing.current = true;\r\n      \r\n      logger.debug('Query type analysis', { \r\n        isHealthNews, \r\n        isBrowserNavigation: isBrowserNavigation() \r\n      });\r\n      \r\n      // Always check cache first - especially for browser navigation\r\n      const cachedResult = searchCache.getCachedResult(cacheKey);\r\n      if (cachedResult) {\r\n        logger.cache('Using cached results', { cacheKey });\r\n        setResults(cachedResult);\r\n        setDataSource('local');\r\n        setIsLoading(false);\r\n        setCitations([]);\r\n        setRecommendations([]);\r\n        setDisclaimer('');\r\n        setIsInitialLoad(false);\r\n        isProcessing.current = false; // Reset processing flag\r\n        return; // Exit early - no API calls needed\r\n      }\r\n      \r\n      // If this is browser navigation and no cache, redirect to search page\r\n      if (isBrowserNavigation() || !isInitialLoad) {\r\n        logger.debug('Browser navigation detected with no cache - redirecting to search');\r\n        isProcessing.current = false; // Reset processing flag\r\n        navigate('/');\r\n        return;\r\n      }\r\n      \r\n      // Only show loading for genuine new searches (not browser navigation)\r\n      setIsLoading(true);\r\n      \r\n      try {\r\n        // Use WiHy Unified API for all types of searches\r\n        logger.apiRequest('WiHy Unified API', { \r\n          type: isHealthNews ? 'health_news' : 'search',\r\n          query: query || `health news - ${category}` \r\n        });\r\n        \r\n        let wihyResult: any;\r\n        \r\n        if (isHealthNews) {\r\n          // Handle health news requests\r\n          logger.debug('Fetching health news via WiHy API');\r\n          const categories = category === 'all' ? [] : [category];\r\n          wihyResult = await wihyAPI.getHealthNews(categories, 6);\r\n        } else {\r\n          // Handle regular search queries (health, nutrition, etc.)\r\n          logger.debug('Making WiHy API call for query', { query });\r\n          wihyResult = await wihyAPI.searchHealth(query);\r\n        }\r\n        \r\n        logger.apiResponse('WiHy API result', wihyResult);\r\n        \r\n        if (wihyResult.success) {\r\n          const formattedResult = wihyAPI.formatWihyResponse(wihyResult);\r\n          setResults(formattedResult);\r\n          setDataSource(\"wihy\");\r\n          \r\n          // Cache the WiHy results\r\n          searchCache.setCachedResult(cacheKey, formattedResult, window.location.href);\r\n          \r\n          setCitations(wihyAPI.extractCitations(wihyResult));\r\n          setRecommendations(wihyAPI.extractRecommendations(wihyResult));\r\n          \r\n          if (isHealthNews) {\r\n            setDisclaimer('Health news provided by WiHy AI. Always consult healthcare professionals for medical advice.');\r\n          } else {\r\n            setDisclaimer('This guidance is based on evidence-based health principles. Always consult healthcare professionals for personalized medical advice.');\r\n          }\r\n        } else {\r\n          // Fallback: If WiHy fails, try legacy APIs\r\n          logger.warn('WiHy API failed, trying fallback methods');\r\n          await handleFallbackAPIs();\r\n        }\r\n        \r\n      } catch (error) {\r\n        console.error(\"WiHy API error:\", error);\r\n        // Try fallback APIs if WiHy fails\r\n        try {\r\n          await handleFallbackAPIs();\r\n        } catch (fallbackError) {\r\n          console.error(\"All APIs failed:\", fallbackError);\r\n          const errorMessage = \"Sorry, there was an error processing your request.\";\r\n          setResults(errorMessage);\r\n          setDataSource(\"error\");\r\n          \r\n          setCitations([]);\r\n          setRecommendations([]);\r\n          setDisclaimer('');\r\n        }\r\n      } finally {\r\n        setIsLoading(false);\r\n        setIsInitialLoad(false);\r\n        isProcessing.current = false; // Always reset processing flag\r\n      }\r\n    };\r\n\r\n    // Fallback function for legacy APIs\r\n    const handleFallbackAPIs = async () => {\r\n      if (isHealthNews) {\r\n        logger.debug('Fallback: Fetching health news via newsService');\r\n        const healthNewsResult = await fetchNewsFeed([category], 6);\r\n        \r\n        if (healthNewsResult.success && healthNewsResult.articles) {\r\n          logger.info('Health news fetched successfully');\r\n          \r\n          // Format the news articles for display\r\n          const formattedNews = formatNewsArticles(healthNewsResult.articles);\r\n          \r\n          setResults(formattedNews);\r\n          setDataSource('openai'); // Use openai as the display source\r\n          \r\n          // Cache the health news results\r\n          const newsKey = `health_news_${category}`;\r\n          searchCache.setCachedResult(newsKey, formattedNews, window.location.href);\r\n          \r\n          setDisclaimer('Health news provided by AI. Always consult healthcare professionals for medical advice.');\r\n        } else {\r\n          throw new Error(healthNewsResult.message || 'Failed to fetch health news');\r\n        }\r\n      } else {\r\n        // Try nutrition database for food-related queries\r\n        try {\r\n          logger.debug('Fallback: Trying nutrition database');\r\n          logger.debug('API URL', { url: `${API_BASE_URL}/api/search/food?q=${encodeURIComponent(query)}` });\r\n          \r\n          const nutritionResponse = await fetch(`${API_BASE_URL}/api/search/food?q=${encodeURIComponent(query)}`);\r\n          \r\n          if (nutritionResponse.ok) {\r\n            const nutritionData = await nutritionResponse.json();\r\n            logger.apiResponse('Nutrition API', nutritionData);\r\n            \r\n            if (nutritionData && nutritionData.found === true) {\r\n              logger.info('Found nutrition data - using vnutrition source');\r\n              const resultString = JSON.stringify(nutritionData);\r\n              setResults(resultString);\r\n              setDataSource('vnutrition');\r\n              \r\n              // Cache the nutrition results\r\n              searchCache.setCachedResult(query, resultString, window.location.href);\r\n              return;\r\n            }\r\n          }\r\n        } catch (nutritionError) {\r\n          logger.debug('Nutrition API also failed', { error: nutritionError });\r\n        }\r\n        \r\n        throw new Error('All fallback APIs failed');\r\n      }\r\n    };\r\n    \r\n    fetchResults();\r\n  }, [query, isHealthNews, category]); // Removed 'navigate' from dependencies\r\n\r\n  // Function to format news articles for display\r\n  const formatNewsArticles = (articles: any[]): string => {\r\n    let formatted = '# Latest Health News\\n\\n';\r\n    \r\n    articles.forEach((article, index) => {\r\n      formatted += `## ${article.title}\\n\\n`;\r\n      formatted += `**Source:** ${article.source} (${article.domain})\\n`;\r\n      formatted += `**Category:** ${article.category}\\n`;\r\n      formatted += `**Published:** ${new Date(article.publishedDate).toLocaleDateString()}\\n`;\r\n      formatted += `**Relevance:** ${Math.round(article.relevanceScore * 100)}%\\n\\n`;\r\n      formatted += `${article.summary}\\n\\n`;\r\n      \r\n      if (article.tags && article.tags.length > 0) {\r\n        formatted += `**Tags:** ${article.tags.join(', ')}\\n\\n`;\r\n      }\r\n      \r\n      formatted += `[Read Full Article](${article.url})\\n\\n`;\r\n      formatted += '---\\n\\n';\r\n    });\r\n    \r\n    return formatted;\r\n  };\r\n\r\n  const handleBackToSearch = () => {\r\n    navigate('/');\r\n  };\r\n\r\n  const handleNewSearch = (newQuery: string) => {\r\n    if (newQuery !== query) {\r\n      // Reset the initial load flag for new searches\r\n      setIsInitialLoad(true);\r\n      navigate(`/results?q=${encodeURIComponent(newQuery)}`);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <SearchResults\r\n      query={isHealthNews ? 'Latest Health News' : query}\r\n      results={results}\r\n      onBackToSearch={handleBackToSearch}\r\n      onNewSearch={handleNewSearch}\r\n      isLoading={isLoading}\r\n      dataSource={dataSource}\r\n      citations={citations}\r\n      recommendations={recommendations}\r\n      disclaimer={disclaimer}\r\n    />\r\n  );\r\n};\r\n\r\nconst App: React.FC = () => {\r\n  logger.debug(\"App component rendered\");\r\n  \r\n  return (\r\n    <Router>\r\n      <Routes>\r\n        <Route path=\"/\" element={<VHealthSearch />} />\r\n        <Route path=\"/results\" element={<ResultsPage />} />\r\n      </Routes>\r\n    </Router>\r\n  );\r\n};\r\n\r\nexport default App;\r\n\r\ninterface ChatGPTResponse {\r\n  details?: string;\r\n  sources?: string[];\r\n  recommendations?: string[];\r\n  medicalDisclaimer?: string;\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}