{"ast":null,"code":"import axios from 'axios';\n\n// Define trusted domains directly here instead of importing from self\nexport const TRUSTED_DOMAINS = {\n  'nih.gov': 1,\n  'ncbi.nlm.nih.gov': 1,\n  // PubMed\n  'who.int': 1,\n  'cdc.gov': 1,\n  'fda.gov': 1,\n  'usda.gov': 1,\n  'jamanetwork.com': 1,\n  'nejm.org': 1,\n  'thelancet.com': 1,\n  'bmj.com': 1,\n  'nature.com': 1,\n  'mayoclinic.org': 1,\n  'health.harvard.edu': 1\n};\n\n// Update API URL configuration\n\nclass NewsService {\n  // Get the correct endpoint based on environment\n  getNewsEndpoint() {\n    const isDevelopment = process.env.NODE_ENV === 'development' || window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';\n    if (isDevelopment) {\n      // Based on working endpoint: /api/news\n      const localEndpoint = 'http://localhost:5001/api/news';\n      console.log('üîß Development mode: Using local endpoint:', localEndpoint);\n      return localEndpoint;\n    } else {\n      // In production: use production endpoint\n      const prodEndpoint = 'https://services.wihy.ai/api/news';\n      console.log('üöÄ Production mode: Using production endpoint:', prodEndpoint);\n      return prodEndpoint;\n    }\n  }\n\n  /**\r\n   * Fetch news articles based on provided parameters\r\n   */\n  async getArticles(params = {}) {\n    try {\n      // Get the endpoint\n      const endpoint = this.getNewsEndpoint();\n\n      // Set minimal parameters - backend may not support all OpenAPI parameters\n      const queryParams = {\n        ...params // Start with provided params\n      };\n\n      // Only add limit if specified or use a reasonable default\n      if (!queryParams.limit) {\n        queryParams.limit = 50;\n      }\n\n      // Try to prioritize sources that might have images\n      // Don't restrict to clinical trials only - get diverse news sources\n      if (!queryParams.feed_id) {\n        // Remove any feed_id restriction to get articles from all sources\n        delete queryParams.feed_id;\n      }\n\n      // Remove any undefined parameters that might cause issues\n      Object.keys(queryParams).forEach(key => {\n        if (queryParams[key] === undefined || queryParams[key] === null || queryParams[key] === '') {\n          delete queryParams[key];\n        }\n      });\n      console.log('Fetching news with params:', queryParams);\n      const isDevelopment = process.env.NODE_ENV === 'development' || window.location.hostname === 'localhost';\n      console.log(`üåç Environment: ${isDevelopment ? 'Development' : 'Production'}`);\n      console.log(`üì° Using endpoint: ${endpoint}`);\n      try {\n        var _response$data, _response$data$articl, _response$data2, _response$data3, _response$data4, _response$data5;\n        // Set timeout based on endpoint type (local vs remote)\n        const isLocal = endpoint.includes('localhost');\n        const timeout = isLocal ? 30000 : 15000; // Much longer timeout for local development\n\n        console.log(`üöÄ Making request to: ${endpoint}`);\n        console.log(`üìã Request params:`, queryParams);\n        console.log(`üîç Current window location:`, window.location.href);\n        console.log(`üîç Process NODE_ENV:`, process.env.NODE_ENV);\n        console.log(`üîç Final axios URL will be:`, endpoint);\n\n        // For local development, try a simple connectivity test first\n        if (isLocal) {\n          try {\n            console.log('üîç Testing basic connectivity to service...');\n            const healthCheck = await axios.get('http://localhost:5001/', {\n              timeout: 5000\n            });\n            console.log('‚úÖ Service is reachable');\n          } catch (connectError) {\n            console.log('‚ö†Ô∏è Service connectivity check failed:', connectError.message);\n            if (connectError.code === 'ECONNREFUSED') {\n              throw new Error('Local news service is not running on port 5001. Please start the service first.');\n            }\n          }\n        }\n        const response = await axios.get(endpoint, {\n          params: queryParams,\n          timeout: timeout,\n          headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n          }\n        });\n        console.log(`‚úÖ Response status: ${response.status}`);\n        console.log(`üì¶ Response data type:`, typeof response.data);\n        console.log(`üîç Response structure:`, {\n          keys: Object.keys(response.data || {}),\n          isArray: Array.isArray(response.data),\n          articlesCount: ((_response$data = response.data) === null || _response$data === void 0 ? void 0 : (_response$data$articl = _response$data.articles) === null || _response$data$articl === void 0 ? void 0 : _response$data$articl.length) || 0,\n          totalCount: ((_response$data2 = response.data) === null || _response$data2 === void 0 ? void 0 : _response$data2.count) || 0,\n          totalAvailable: ((_response$data3 = response.data) === null || _response$data3 === void 0 ? void 0 : _response$data3.total) || 0,\n          success: (_response$data4 = response.data) === null || _response$data4 === void 0 ? void 0 : _response$data4.success\n        });\n\n        // Log detailed information about sources and images\n        const articles = ((_response$data5 = response.data) === null || _response$data5 === void 0 ? void 0 : _response$data5.articles) || [];\n        if (articles.length > 0) {\n          console.log(`üì∞ Article sources and images:`);\n          articles.slice(0, 5).forEach((article, idx) => {\n            var _article$title;\n            console.log(`${idx + 1}. Source: ${article.source} (Feed ID: ${article.feed_id})`);\n            console.log(`   Domain: ${article.domain}`);\n            console.log(`   Has Image: ${article.has_image}`);\n            console.log(`   Media URL: ${article.media_url || 'none'}`);\n            console.log(`   Thumbnail URL: ${article.media_thumb_url || 'none'}`);\n            console.log(`   Thumbnail: ${article.thumbnail || 'none'}`);\n            console.log(`   Title: ${(_article$title = article.title) === null || _article$title === void 0 ? void 0 : _article$title.substring(0, 60)}...`);\n            console.log(`---`);\n          });\n\n          // Show unique sources and their image stats\n          const sourceStats = articles.reduce((acc, article) => {\n            const source = article.source || 'Unknown';\n            if (!acc[source]) {\n              acc[source] = {\n                count: 0,\n                withImages: 0,\n                feedId: article.feed_id\n              };\n            }\n            acc[source].count++;\n            if (article.has_media || article.media_url || article.media_thumb_url) {\n              acc[source].withImages++;\n            }\n            return acc;\n          }, {});\n          console.log('üìä Source statistics:');\n          Object.entries(sourceStats).forEach(([source, stats]) => {\n            console.log(`${source}: ${stats.count} articles, ${stats.withImages} with images (Feed ID: ${stats.feedId})`);\n          });\n        }\n        if (isLocal) {\n          var _response$data6;\n          console.log('‚úÖ Local endpoint successful:', endpoint);\n\n          // Check if database is empty\n          const articleCount = ((_response$data6 = response.data) === null || _response$data6 === void 0 ? void 0 : _response$data6.count) || 0;\n          if (articleCount === 0) {\n            console.log('üì≠ No articles found in local database');\n            console.log('üí° The database appears to be empty');\n          }\n        } else {\n          console.log('‚úÖ Production endpoint successful:', endpoint);\n        }\n\n        // Process the response to add compatibility fields\n        const apiResponse = response.data;\n\n        // Map API articles to client format\n        if (apiResponse.articles && apiResponse.articles.length > 0) {\n          apiResponse.articles = apiResponse.articles.map(article => this.adaptArticleForClient(article));\n        }\n        return apiResponse;\n      } catch (error) {\n        var _error$response, _error$response2, _error$config, _error$config2;\n        console.error(`‚ùå Failed to fetch from ${endpoint}:`, error.name);\n        console.log(`üîç Error details:`, {\n          message: error.message,\n          code: error.code,\n          status: (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status,\n          statusText: (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.statusText,\n          url: (_error$config = error.config) === null || _error$config === void 0 ? void 0 : _error$config.url,\n          method: (_error$config2 = error.config) === null || _error$config2 === void 0 ? void 0 : _error$config2.method\n        });\n        const isLocal = endpoint.includes('localhost');\n        if (isLocal && isDevelopment) {\n          var _error$response3;\n          if (error.code === 'ECONNREFUSED' || error.message.includes('Network Error')) {\n            console.error('üí° Local service not available. Make sure the RSS news service is running on port 5001');\n            console.error('üí° You can start it with the appropriate command for your local setup');\n          } else if (error.code === 'ECONNABORTED' || error.message.includes('timeout')) {\n            console.error('üí° Request timed out. The service might be running but responding slowly');\n            console.error('üí° Try testing the endpoint manually: http://localhost:5001/api/news/articles');\n            console.error('üí° Check if the service is processing data or needs time to start up');\n          } else if (((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : _error$response3.status) === 404) {\n            console.error('üí° 404 Error: The /api/news/articles endpoint may not exist');\n            console.error('üí° Check the API documentation at http://localhost:5001/api/service/docs/');\n            console.error('üí° Verify the correct endpoint path with the service documentation');\n          }\n        }\n        throw error; // Re-throw the error instead of trying fallbacks\n      }\n    } catch (error) {\n      console.error('Error fetching news articles:', error);\n      return {\n        success: false,\n        articles: [],\n        count: 0,\n        pagination: {\n          total_items: 0,\n          total_pages: 0,\n          current_page: 1,\n          per_page: 50,\n          has_next_page: false,\n          has_prev_page: false\n        },\n        filters_applied: {\n          category: null,\n          country: null,\n          feed_id: null,\n          limit: 0\n        },\n        error: error instanceof Error ? error.message : 'Unknown error',\n        message: error instanceof Error ? error.message : 'Unknown error' // For backward compatibility\n      };\n    }\n  }\n\n  /**\r\n   * Helper method to adapt API response article format to client format\r\n   */\n  adaptArticleForClient(article) {\n    return {\n      ...article,\n      // Map API fields to legacy compatibility fields\n      url: article.link,\n      summary: article.description,\n      publishedDate: article.pubDate,\n      thumbnailUrl: article.media_thumb_url || '',\n      imageUrl: article.media_url || '',\n      hasMedia: article.has_media,\n      source: article.feed_title,\n      tags: article.keywords || [],\n      readingTime: article.reading_time || Math.ceil((article.word_count || 0) / 200),\n      wordCount: article.word_count\n    };\n  }\n\n  /**\r\n   * Get available news categories from articles endpoint\r\n   */\n  async getCategories() {\n    try {\n      // Based on the OpenAPI spec, health categories are:\n      return ['All Health News', 'Nutrition', 'Medical Research', 'Public Health', 'Clinical Studies', 'Prevention', 'Mental Health', 'General Health', 'Environment'];\n    } catch (error) {\n      console.error('Error fetching news categories:', error);\n      return [];\n    }\n  }\n\n  /**\r\n   * Get available countries from articles endpoint\r\n   */\n  async getCountries() {\n    try {\n      // Based on the OpenAPI spec, supported countries are: US, IN, UK, CA, AU, DE, FR, JP\n      return [{\n        code: 'US',\n        name: 'United States'\n      }, {\n        code: 'IN',\n        name: 'India'\n      }, {\n        code: 'UK',\n        name: 'United Kingdom'\n      }, {\n        code: 'CA',\n        name: 'Canada'\n      }, {\n        code: 'AU',\n        name: 'Australia'\n      }, {\n        code: 'DE',\n        name: 'Germany'\n      }, {\n        code: 'FR',\n        name: 'France'\n      }, {\n        code: 'JP',\n        name: 'Japan'\n      }];\n    } catch (error) {\n      console.error('Error fetching countries:', error);\n      return [];\n    }\n  }\n\n  /**\r\n   * Calculate trust score based on domain\r\n   */\n  calculateTrustScore(article) {\n    try {\n      // Extract domain from article link\n      const url = new URL(article.link);\n      const domain = url.hostname.replace('www.', '');\n      return TRUSTED_DOMAINS[domain] || TRUSTED_DOMAINS[`www.${domain}`] || 0.5;\n    } catch {\n      return 0.5; // Default score if URL parsing fails\n    }\n  }\n}\nexport const newsService = new NewsService();\n\n// Update these functions to improve category filtering and sort by date\n\nexport const fetchNewsFeed = async (categories, limit) => {\n  // First, set up the API request parameters\n  const params = {};\n\n  // Only add category parameter if categories array is non-empty\n  if (categories && categories.length > 0) {\n    params.category = categories.join(',');\n  }\n\n  // Request more articles than needed for better sorting/filtering\n  params.limit = limit ? limit * 2 : 50;\n\n  // Note: Sorting is handled by the API internally, no sort parameters needed\n\n  console.log('Fetching news with params:', params);\n\n  // Fetch articles from API\n  const response = await newsService.getArticles(params);\n  if (response.success && response.articles && response.articles.length > 0) {\n    // Define priority categories in exact order\n    const priorityCategories = ['Nutrition & Diet', 'Medical Research', 'Public Health', 'Clinical Studies', 'Disease Prevention', 'Mental Health', 'General Health'];\n\n    // Sort articles by our priority scheme\n    const sortedArticles = sortArticlesByPriority(response.articles, priorityCategories);\n\n    // Limit to requested count after sorting\n    const limitedArticles = sortedArticles.slice(0, limit || sortedArticles.length);\n\n    // Log first few articles to verify order\n    console.log('Articles returned after prioritization:');\n    limitedArticles.slice(0, 5).forEach((article, i) => {\n      console.log(`  ${i + 1}. [${article.category || 'uncategorized'}]: ${article.title}`);\n    });\n\n    // Return a modified response with our prioritized articles\n    return {\n      ...response,\n      articles: limitedArticles,\n      count: limitedArticles.length\n    };\n  }\n  return response;\n};\n\n// Add the prioritization function to the newsService file\nfunction sortArticlesByPriority(articles, priorityCategories) {\n  // Create a copy of the articles array\n  const sortedArticles = [...articles];\n\n  // Define a function to get priority score (lower is higher priority)\n  const getPriorityScore = article => {\n    const category = article.category || '';\n    const categoryLower = category.toLowerCase();\n\n    // FIRST: Explicitly handle tech content - make sure it's always at the bottom\n    // Check if it's explicitly categorized as tech\n    if (categoryLower === 'tech' || categoryLower.includes('technology') || categoryLower.includes('computing') || categoryLower.includes('it ') || categoryLower.includes('software')) {\n      console.log(`üëâ Found tech article, assigning lowest priority: ${article.title}`);\n      return 1000; // Tech should be shown last\n    }\n\n    // 1. Exact match with priority categories (in strict order)\n    for (let i = 0; i < priorityCategories.length; i++) {\n      if (category === priorityCategories[i]) {\n        return i; // Return the exact index position (0, 1, 2, etc.)\n      }\n    }\n\n    // 2. Partial match with priority categories\n    for (let i = 0; i < priorityCategories.length; i++) {\n      if (category.includes(priorityCategories[i])) {\n        return i + 20; // Still keep order but with lower priority than exact matches\n      }\n    }\n\n    // 3. Check for health-related keywords in title/description\n    const title = article.title || '';\n    const description = article.description || '';\n    const content = title + ' ' + description;\n    const contentLower = content.toLowerCase();\n    const healthKeywords = ['health', 'medical', 'medicine', 'doctor', 'patient', 'hospital', 'disease', 'treatment', 'cure', 'wellness', 'fitness', 'diet', 'nutrition', 'mental', 'therapy', 'clinical', 'drug', 'vaccine', 'symptom', 'diagnosis', 'cancer', 'heart', 'diabetes', 'covid'];\n    if (healthKeywords.some(keyword => contentLower.includes(keyword))) {\n      return 100; // All health-related content after categorized content\n    }\n\n    // 4. Check for tech keywords in title/description if not already caught above\n    const techKeywords = ['tech', 'technology', 'computing', 'software', 'hardware', 'ai', 'artificial intelligence', 'computer', 'code', 'programming', 'developer', 'cybersecurity', 'digital', 'internet', 'smartphone', 'app ', 'apps ', 'device', 'gadget', 'google', 'apple', 'microsoft', 'facebook', 'twitter', 'social media', 'tesla', 'elon musk'];\n    if (techKeywords.some(keyword => contentLower.includes(keyword))) {\n      // Extra debug log for tech content detection\n      console.log(`üëâ Found tech content by keyword, assigning lowest priority: ${article.title}`);\n      return 900; // Tech content at the bottom, but just above explicitly categorized tech\n    }\n\n    // 5. Everything else (general content)\n    return 500;\n  };\n\n  // Sort articles by priority score\n  sortedArticles.sort((a, b) => {\n    const priorityA = getPriorityScore(a);\n    const priorityB = getPriorityScore(b);\n\n    // First sort by priority category\n    if (priorityA !== priorityB) {\n      return priorityA - priorityB;\n    }\n\n    // If same priority category, sort by date (newest first)\n    const dateA = a.publishedDate || a.pubDate;\n    const dateB = b.publishedDate || b.pubDate;\n    if (dateA && dateB) {\n      return new Date(dateB).getTime() - new Date(dateA).getTime();\n    }\n    return 0;\n  });\n\n  // Add debug information to see what categories are being returned\n  console.log('Article order after prioritization:');\n  sortedArticles.slice(0, 8).forEach((article, idx) => {\n    // Show the priority score as part of the debugging\n    const score = getPriorityScore(article);\n    const category = article.category || 'uncategorized';\n    console.log(`  ${idx + 1}. [${score}] [${category}]: ${article.title}`);\n  });\n  return sortedArticles;\n}\n\n// Update getArticlesByCategory to use the same prioritization logic\n\nexport const getArticlesByCategory = async (category, limit) => {\n  if (category === 'all') {\n    return fetchNewsFeed([], limit);\n  }\n  const params = {\n    category,\n    limit: limit ? Math.round(limit * 1.5) : 20,\n    // Fetch a few more than needed\n    quality: '1' // Get quality articles with good images\n  };\n  const response = await newsService.getArticles(params);\n  if (response.success && response.articles && response.articles.length > 0) {\n    // For category views, we still want to sort by date but within the category\n    const sortedArticles = response.articles.sort((a, b) => {\n      const dateA = a.publishedDate || a.pubDate;\n      const dateB = b.publishedDate || b.pubDate;\n      if (dateA && dateB) {\n        return new Date(dateB).getTime() - new Date(dateA).getTime();\n      }\n      return 0;\n    });\n\n    // Limit to requested count\n    const limitedArticles = sortedArticles.slice(0, limit || sortedArticles.length);\n\n    // Return a modified response with our sorted articles\n    return {\n      ...response,\n      articles: limitedArticles,\n      count: limitedArticles.length\n    };\n  }\n  return response;\n};\n\n// Add these functions at the end of the file\n\n/**\r\n * Refresh news feed with timestamp to get latest articles\r\n */\nexport const refreshNewsFeed = async (categories, limit) => {\n  const timestamp = new Date().getTime();\n  const params = {\n    timestamp,\n    // Add timestamp to bust cache\n    limit: limit || 50\n  };\n  if (categories && categories.length > 0) {\n    params.category = categories.join(',');\n  }\n\n  // Use quality parameter for better articles\n  params.quality = '1';\n  console.log('Refreshing news feed with timestamp:', timestamp);\n  const response = await newsService.getArticles(params);\n  if (response.success && response.articles && response.articles.length > 0) {\n    // Use the same priority sorting as fetchNewsFeed\n    const priorityCategories = ['Nutrition & Diet', 'Medical Research', 'Public Health', 'Clinical Studies', 'Disease Prevention', 'Mental Health', 'General Health'];\n    const sortedArticles = sortArticlesByPriority(response.articles, priorityCategories);\n\n    // Limit to requested count after sorting\n    const limitedArticles = sortedArticles.slice(0, limit || sortedArticles.length);\n\n    // Return a modified response with our prioritized articles\n    return {\n      ...response,\n      articles: limitedArticles,\n      count: limitedArticles.length\n    };\n  }\n  return response;\n};\n\n/**\r\n * Search for news articles based on query\r\n */\nexport const searchNewsArticles = async (query, limit) => {\n  if (!query || query.trim() === '') {\n    // If no query, return empty results\n    return {\n      success: true,\n      articles: [],\n      count: 0,\n      pagination: {\n        total_items: 0,\n        total_pages: 0,\n        current_page: 1,\n        per_page: 12,\n        has_next_page: false,\n        has_prev_page: false\n      },\n      filters_applied: {\n        category: null,\n        country: null,\n        feed_id: null,\n        limit: 0\n      }\n    };\n  }\n  const params = {\n    query: query.trim(),\n    limit: limit || 50,\n    quality: '1' // Get quality articles with good images for search\n  };\n  console.log(`Searching news articles with query: \"${query}\"`);\n  const response = await newsService.getArticles(params);\n  if (response.success && response.articles && response.articles.length > 0) {\n    // For search results, we want to prioritize by relevance to search term\n    // But still use our priority categories as a secondary sort\n    const priorityCategories = ['Nutrition & Diet', 'Medical Research', 'Public Health', 'Clinical Studies', 'Disease Prevention', 'Mental Health', 'General Health'];\n\n    // Sort articles based on search relevance and category\n    const sortedArticles = response.articles.sort((a, b) => {\n      // First, prioritize by relevance score if available\n      if (a.relevanceScore !== undefined && b.relevanceScore !== undefined) {\n        if (a.relevanceScore !== b.relevanceScore) {\n          return b.relevanceScore - a.relevanceScore;\n        }\n      }\n\n      // If relevance scores are the same, use our category priority\n      const categoryA = a.category || '';\n      const categoryB = b.category || '';\n\n      // Check if categories are in our priority list\n      const indexA = priorityCategories.findIndex(cat => categoryA.includes(cat));\n      const indexB = priorityCategories.findIndex(cat => categoryB.includes(cat));\n\n      // If both categories are in priority list\n      if (indexA >= 0 && indexB >= 0) {\n        if (indexA !== indexB) {\n          return indexA - indexB;\n        }\n      }\n      // If only one category is in priority list\n      else if (indexA >= 0) {\n        return -1;\n      } else if (indexB >= 0) {\n        return 1;\n      }\n\n      // Finally, sort by date\n      const dateA = a.publishedDate || a.pubDate;\n      const dateB = b.publishedDate || b.pubDate;\n      if (dateA && dateB) {\n        return new Date(dateB).getTime() - new Date(dateA).getTime();\n      }\n      return 0;\n    });\n\n    // Limit to requested count\n    const limitedArticles = sortedArticles.slice(0, limit || sortedArticles.length);\n    return {\n      ...response,\n      articles: limitedArticles,\n      count: limitedArticles.length\n    };\n  }\n  return response;\n};","map":{"version":3,"names":["axios","TRUSTED_DOMAINS","NewsService","getNewsEndpoint","isDevelopment","process","env","NODE_ENV","window","location","hostname","localEndpoint","console","log","prodEndpoint","getArticles","params","endpoint","queryParams","limit","feed_id","Object","keys","forEach","key","undefined","_response$data","_response$data$articl","_response$data2","_response$data3","_response$data4","_response$data5","isLocal","includes","timeout","href","healthCheck","get","connectError","message","code","Error","response","headers","status","data","isArray","Array","articlesCount","articles","length","totalCount","count","totalAvailable","total","success","slice","article","idx","_article$title","source","domain","has_image","media_url","media_thumb_url","thumbnail","title","substring","sourceStats","reduce","acc","withImages","feedId","has_media","entries","stats","_response$data6","articleCount","apiResponse","map","adaptArticleForClient","error","_error$response","_error$response2","_error$config","_error$config2","name","statusText","url","config","method","_error$response3","pagination","total_items","total_pages","current_page","per_page","has_next_page","has_prev_page","filters_applied","category","country","link","summary","description","publishedDate","pubDate","thumbnailUrl","imageUrl","hasMedia","feed_title","tags","keywords","readingTime","reading_time","Math","ceil","word_count","wordCount","getCategories","getCountries","calculateTrustScore","URL","replace","newsService","fetchNewsFeed","categories","join","priorityCategories","sortedArticles","sortArticlesByPriority","limitedArticles","i","getPriorityScore","categoryLower","toLowerCase","content","contentLower","healthKeywords","some","keyword","techKeywords","sort","a","b","priorityA","priorityB","dateA","dateB","Date","getTime","score","getArticlesByCategory","round","quality","refreshNewsFeed","timestamp","searchNewsArticles","query","trim","relevanceScore","categoryA","categoryB","indexA","findIndex","cat","indexB"],"sources":["C:/repo/wihy_ui/client/src/services/newsService.ts"],"sourcesContent":["import axios from 'axios';\r\n\r\n// Define trusted domains directly here instead of importing from self\r\nexport const TRUSTED_DOMAINS: Record<string, number> = {\r\n  'nih.gov': 1,\r\n  'ncbi.nlm.nih.gov': 1,  // PubMed\r\n  'who.int': 1,\r\n  'cdc.gov': 1,\r\n  'fda.gov': 1,\r\n  'usda.gov': 1,\r\n  'jamanetwork.com': 1,\r\n  'nejm.org': 1,\r\n  'thelancet.com': 1,\r\n  'bmj.com': 1,\r\n  'nature.com': 1,\r\n  'mayoclinic.org': 1,\r\n  'health.harvard.edu': 1\r\n};\r\n\r\n// Update API URL configuration\r\nimport { getApiEndpoint } from '../config/apiConfig';\r\n\r\nexport interface NewsArticle {\r\n  // Core API response fields (expected CNN Health API structure)\r\n  id: number;                        // Unique article identifier (number format like 12359)\r\n  title: string;                     // Article title\r\n  description: string;               // Article description/summary\r\n  link: string;                      // Article URL\r\n  pubDate: string;                   // Publication date (ISO format)\r\n  category: string;                  // Original category from feed\r\n  mapped_category: string;           // Health-specific category mapping\r\n  feed_title: string;                // Source publication name (e.g., \"CNN Health\")\r\n  feed_id: number;                   // RSS feed ID\r\n  media_url: string;                 // Main image URL (actual images from CNN/sources)\r\n  media_thumb_url: string;           // Thumbnail image URL\r\n  has_media: boolean;                // Whether article has images\r\n  word_count: number;                // Article word count\r\n  time_ago: string;                  // Human-readable time since publication\r\n  is_recent: boolean;                // Published within last 24 hours\r\n  keywords: string[];                // Article keywords/tags\r\n  \r\n  // Optional fields that may not always be present\r\n  author?: string;                   // Article author (can be empty)\r\n  has_author?: boolean;              // Whether article has author info\r\n  feed_priority?: string;            // Feed priority level\r\n  reading_time?: number;             // Estimated reading time in minutes\r\n  content_quality?: 'high' | 'medium' | 'low';  // Content quality assessment\r\n  completeness?: 'complete' | 'partial' | 'minimal';  // Data completeness\r\n  domain?: string;                   // Source domain\r\n  extracted_at?: string;             // When article was extracted\r\n  \r\n  // Legacy/compatibility fields for existing client code\r\n  url?: string;                      // Alias for link\r\n  summary?: string;                  // Alias for description\r\n  publishedDate?: string;            // Alias for pubDate\r\n  thumbnailUrl?: string;             // Alias for media_thumb_url\r\n  imageUrl?: string;                 // Alias for media_url\r\n  hasMedia?: boolean;                // Alias for has_media\r\n  source?: string;                   // Alias for feed_title\r\n  tags?: string[];                   // Alias for keywords\r\n  wordCount?: number;                // Alias for word_count\r\n  readingTime?: number;              // Calculated reading time\r\n  relevanceScore?: number;           // Client-side scoring\r\n  mediaType?: string;                // Media type classification\r\n  contentLength?: number;            // Content length\r\n}\r\n\r\nexport interface NewsFeedResponse {\r\n  success: boolean;\r\n  articles: NewsArticle[];\r\n  count: number;\r\n  total?: number;                    // Total available articles\r\n  message?: string;                  // API message\r\n  pagination?: {\r\n    total_items: number;\r\n    total_pages: number;\r\n    current_page: number;\r\n    per_page: number;\r\n    has_next_page: boolean;\r\n    has_prev_page: boolean;\r\n  };\r\n  filters_applied?: {\r\n    category: string | null;\r\n    country: string | null;\r\n    feed_id: number | null;\r\n    limit: number;\r\n    quality?: string;                // Added from OpenAPI spec\r\n  };\r\n  // Quality mode field (when quality=1)\r\n  flagged_for_review?: Array<{\r\n    id: number;\r\n    title: string;\r\n    reason: string;\r\n    category: string;\r\n  }>;\r\n  error?: string; // Added to handle errors from the API\r\n}\r\n\r\nexport interface NewsQueryParams {\r\n  limit?: number;                    // Number of articles to return (1-500)\r\n  quality?: string;                  // '1'/'true' for quality articles, '0'/'false' for all\r\n  category?: string;                 // Health categories: 'All Health News', 'Nutrition', etc.\r\n  country?: string;                  // Country code: US, IN, UK, CA, AU, DE, FR, JP\r\n  feed_id?: number;                  // Filter by specific feed ID\r\n  feed_priority?: string;            // Feed priority: single, range, or comma-separated\r\n  flat?: string | boolean;           // Return flat structure ('true'/'false')\r\n  page?: number;                     // Page number (starts at 1)\r\n  per_page?: number;                 // Number of articles per page (1-100)\r\n  your_new_param?: string;           // Additional parameter from API spec\r\n  timestamp?: number;                // Added to support refreshNewsFeed\r\n  query?: string;                    // Added to support searchNewsArticles\r\n}\r\n\r\nclass NewsService {\r\n  // Get the correct endpoint based on environment\r\n  private getNewsEndpoint(): string {\r\n    const isDevelopment = process.env.NODE_ENV === 'development' || \r\n                         window.location.hostname === 'localhost' ||\r\n                         window.location.hostname === '127.0.0.1';\r\n    \r\n    if (isDevelopment) {\r\n      // Based on working endpoint: /api/news\r\n      const localEndpoint = 'http://localhost:5001/api/news';\r\n      console.log('üîß Development mode: Using local endpoint:', localEndpoint);\r\n      return localEndpoint;\r\n    } else {\r\n      // In production: use production endpoint\r\n      const prodEndpoint = 'https://services.wihy.ai/api/news';\r\n      console.log('üöÄ Production mode: Using production endpoint:', prodEndpoint);\r\n      return prodEndpoint;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Fetch news articles based on provided parameters\r\n   */\r\n  async getArticles(params: NewsQueryParams = {}): Promise<NewsFeedResponse> {\r\n    try {\r\n      // Get the endpoint\r\n      const endpoint = this.getNewsEndpoint();\r\n      \r\n      // Set minimal parameters - backend may not support all OpenAPI parameters\r\n      const queryParams: any = {\r\n        ...params // Start with provided params\r\n      };\r\n\r\n      // Only add limit if specified or use a reasonable default\r\n      if (!queryParams.limit) {\r\n        queryParams.limit = 50;\r\n      }\r\n\r\n      // Try to prioritize sources that might have images\r\n      // Don't restrict to clinical trials only - get diverse news sources\r\n      if (!queryParams.feed_id) {\r\n        // Remove any feed_id restriction to get articles from all sources\r\n        delete queryParams.feed_id;\r\n      }\r\n\r\n      // Remove any undefined parameters that might cause issues\r\n      Object.keys(queryParams).forEach(key => {\r\n        if (queryParams[key] === undefined || queryParams[key] === null || queryParams[key] === '') {\r\n          delete queryParams[key];\r\n        }\r\n      });\r\n\r\n      console.log('Fetching news with params:', queryParams);\r\n      \r\n      const isDevelopment = process.env.NODE_ENV === 'development' || \r\n                           window.location.hostname === 'localhost';\r\n      \r\n      console.log(`üåç Environment: ${isDevelopment ? 'Development' : 'Production'}`);\r\n      console.log(`üì° Using endpoint: ${endpoint}`);\r\n      \r\n      try {\r\n        // Set timeout based on endpoint type (local vs remote)\r\n        const isLocal = endpoint.includes('localhost');\r\n        const timeout = isLocal ? 30000 : 15000; // Much longer timeout for local development\r\n        \r\n        console.log(`üöÄ Making request to: ${endpoint}`);\r\n        console.log(`üìã Request params:`, queryParams);\r\n        console.log(`üîç Current window location:`, window.location.href);\r\n        console.log(`üîç Process NODE_ENV:`, process.env.NODE_ENV);\r\n        console.log(`üîç Final axios URL will be:`, endpoint);\r\n        \r\n        // For local development, try a simple connectivity test first\r\n        if (isLocal) {\r\n          try {\r\n            console.log('üîç Testing basic connectivity to service...');\r\n            const healthCheck = await axios.get('http://localhost:5001/', { timeout: 5000 });\r\n            console.log('‚úÖ Service is reachable');\r\n          } catch (connectError: any) {\r\n            console.log('‚ö†Ô∏è Service connectivity check failed:', connectError.message);\r\n            if (connectError.code === 'ECONNREFUSED') {\r\n              throw new Error('Local news service is not running on port 5001. Please start the service first.');\r\n            }\r\n          }\r\n        }\r\n        \r\n        const response = await axios.get(endpoint, { \r\n          params: queryParams,\r\n          timeout: timeout,\r\n          headers: {\r\n            'Accept': 'application/json',\r\n            'Content-Type': 'application/json'\r\n          }\r\n        });\r\n        \r\n        console.log(`‚úÖ Response status: ${response.status}`);\r\n        console.log(`üì¶ Response data type:`, typeof response.data);\r\n        console.log(`üîç Response structure:`, {\r\n          keys: Object.keys(response.data || {}),\r\n          isArray: Array.isArray(response.data),\r\n          articlesCount: (response.data as any)?.articles?.length || 0,\r\n          totalCount: (response.data as any)?.count || 0,\r\n          totalAvailable: (response.data as any)?.total || 0,\r\n          success: (response.data as any)?.success\r\n        });\r\n\r\n        // Log detailed information about sources and images\r\n        const articles = (response.data as any)?.articles || [];\r\n        if (articles.length > 0) {\r\n          console.log(`üì∞ Article sources and images:`)\r\n          articles.slice(0, 5).forEach((article: any, idx: number) => {\r\n            console.log(`${idx + 1}. Source: ${article.source} (Feed ID: ${article.feed_id})`);\r\n            console.log(`   Domain: ${article.domain}`);\r\n            console.log(`   Has Image: ${article.has_image}`);\r\n            console.log(`   Media URL: ${article.media_url || 'none'}`);\r\n            console.log(`   Thumbnail URL: ${article.media_thumb_url || 'none'}`);\r\n            console.log(`   Thumbnail: ${article.thumbnail || 'none'}`);\r\n            console.log(`   Title: ${article.title?.substring(0, 60)}...`);\r\n            console.log(`---`);\r\n          });\r\n\r\n          // Show unique sources and their image stats\r\n          const sourceStats = articles.reduce((acc: any, article: any) => {\r\n            const source = article.source || 'Unknown';\r\n            if (!acc[source]) {\r\n              acc[source] = { count: 0, withImages: 0, feedId: article.feed_id };\r\n            }\r\n            acc[source].count++;\r\n            if (article.has_media || article.media_url || article.media_thumb_url) {\r\n              acc[source].withImages++;\r\n            }\r\n            return acc;\r\n          }, {});\r\n\r\n          console.log('üìä Source statistics:');\r\n          Object.entries(sourceStats).forEach(([source, stats]: [string, any]) => {\r\n            console.log(`${source}: ${stats.count} articles, ${stats.withImages} with images (Feed ID: ${stats.feedId})`);\r\n          });\r\n        }\r\n        \r\n        if (isLocal) {\r\n          console.log('‚úÖ Local endpoint successful:', endpoint);\r\n          \r\n          // Check if database is empty\r\n          const articleCount = (response.data as any)?.count || 0;\r\n          if (articleCount === 0) {\r\n            console.log('üì≠ No articles found in local database');\r\n            console.log('üí° The database appears to be empty');\r\n          }\r\n        } else {\r\n          console.log('‚úÖ Production endpoint successful:', endpoint);\r\n        }\r\n        \r\n        // Process the response to add compatibility fields\r\n        const apiResponse = response.data as NewsFeedResponse;\r\n        \r\n        // Map API articles to client format\r\n        if (apiResponse.articles && apiResponse.articles.length > 0) {\r\n          apiResponse.articles = apiResponse.articles.map(article => this.adaptArticleForClient(article));\r\n        }\r\n        \r\n        return apiResponse;\r\n        \r\n      } catch (error: any) {\r\n        console.error(`‚ùå Failed to fetch from ${endpoint}:`, error.name);\r\n        console.log(`üîç Error details:`, {\r\n          message: error.message,\r\n          code: error.code,\r\n          status: error.response?.status,\r\n          statusText: error.response?.statusText,\r\n          url: error.config?.url,\r\n          method: error.config?.method\r\n        });\r\n        \r\n        const isLocal = endpoint.includes('localhost');\r\n        \r\n        if (isLocal && isDevelopment) {\r\n          if (error.code === 'ECONNREFUSED' || error.message.includes('Network Error')) {\r\n            console.error('üí° Local service not available. Make sure the RSS news service is running on port 5001');\r\n            console.error('üí° You can start it with the appropriate command for your local setup');\r\n          } else if (error.code === 'ECONNABORTED' || error.message.includes('timeout')) {\r\n            console.error('üí° Request timed out. The service might be running but responding slowly');\r\n            console.error('üí° Try testing the endpoint manually: http://localhost:5001/api/news/articles');\r\n            console.error('üí° Check if the service is processing data or needs time to start up');\r\n          } else if (error.response?.status === 404) {\r\n            console.error('üí° 404 Error: The /api/news/articles endpoint may not exist');\r\n            console.error('üí° Check the API documentation at http://localhost:5001/api/service/docs/');\r\n            console.error('üí° Verify the correct endpoint path with the service documentation');\r\n          }\r\n        }\r\n        \r\n        throw error; // Re-throw the error instead of trying fallbacks\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching news articles:', error);\r\n      return {\r\n        success: false,\r\n        articles: [],\r\n        count: 0,\r\n        pagination: {\r\n          total_items: 0,\r\n          total_pages: 0,\r\n          current_page: 1,\r\n          per_page: 50,\r\n          has_next_page: false,\r\n          has_prev_page: false\r\n        },\r\n        filters_applied: {\r\n          category: null,\r\n          country: null,\r\n          feed_id: null,\r\n          limit: 0\r\n        },\r\n        error: error instanceof Error ? error.message : 'Unknown error',\r\n        message: error instanceof Error ? error.message : 'Unknown error' // For backward compatibility\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Helper method to adapt API response article format to client format\r\n   */\r\n  private adaptArticleForClient(article: NewsArticle): NewsArticle {\r\n    return {\r\n      ...article,\r\n      // Map API fields to legacy compatibility fields\r\n      url: article.link,\r\n      summary: article.description,\r\n      publishedDate: article.pubDate,\r\n      thumbnailUrl: article.media_thumb_url || '',\r\n      imageUrl: article.media_url || '',\r\n      hasMedia: article.has_media,\r\n      source: article.feed_title,\r\n      tags: article.keywords || [],\r\n      readingTime: article.reading_time || Math.ceil((article.word_count || 0) / 200),\r\n      wordCount: article.word_count\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get available news categories from articles endpoint\r\n   */\r\n  async getCategories(): Promise<string[]> {\r\n    try {\r\n      // Based on the OpenAPI spec, health categories are:\r\n      return [\r\n        'All Health News', \r\n        'Nutrition', \r\n        'Medical Research', \r\n        'Public Health', \r\n        'Clinical Studies', \r\n        'Prevention', \r\n        'Mental Health', \r\n        'General Health', \r\n        'Environment'\r\n      ];\r\n    } catch (error) {\r\n      console.error('Error fetching news categories:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get available countries from articles endpoint\r\n   */\r\n  async getCountries(): Promise<{code: string, name: string}[]> {\r\n    try {\r\n      // Based on the OpenAPI spec, supported countries are: US, IN, UK, CA, AU, DE, FR, JP\r\n      return [\r\n        { code: 'US', name: 'United States' },\r\n        { code: 'IN', name: 'India' },\r\n        { code: 'UK', name: 'United Kingdom' },\r\n        { code: 'CA', name: 'Canada' },\r\n        { code: 'AU', name: 'Australia' },\r\n        { code: 'DE', name: 'Germany' },\r\n        { code: 'FR', name: 'France' },\r\n        { code: 'JP', name: 'Japan' }\r\n      ];\r\n    } catch (error) {\r\n      console.error('Error fetching countries:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculate trust score based on domain\r\n   */\r\n  calculateTrustScore(article: NewsArticle): number {\r\n    try {\r\n      // Extract domain from article link\r\n      const url = new URL(article.link);\r\n      const domain = url.hostname.replace('www.', '');\r\n      \r\n      return TRUSTED_DOMAINS[domain] || \r\n             TRUSTED_DOMAINS[`www.${domain}`] || \r\n             0.5;\r\n    } catch {\r\n      return 0.5; // Default score if URL parsing fails\r\n    }\r\n  }\r\n}\r\n\r\nexport const newsService = new NewsService();\r\n\r\n// Update these functions to improve category filtering and sort by date\r\n\r\nexport const fetchNewsFeed = async (categories?: string[], limit?: number): Promise<NewsFeedResponse> => {\r\n  // First, set up the API request parameters\r\n  const params: NewsQueryParams = {};\r\n  \r\n  // Only add category parameter if categories array is non-empty\r\n  if (categories && categories.length > 0) {\r\n    params.category = categories.join(',');\r\n  }\r\n  \r\n  // Request more articles than needed for better sorting/filtering\r\n  params.limit = limit ? limit * 2 : 50;\r\n  \r\n  // Note: Sorting is handled by the API internally, no sort parameters needed\r\n  \r\n  console.log('Fetching news with params:', params);\r\n  \r\n  // Fetch articles from API\r\n  const response = await newsService.getArticles(params);\r\n  \r\n  if (response.success && response.articles && response.articles.length > 0) {\r\n    // Define priority categories in exact order\r\n    const priorityCategories = [\r\n      'Nutrition & Diet', \r\n      'Medical Research', \r\n      'Public Health', \r\n      'Clinical Studies', \r\n      'Disease Prevention', \r\n      'Mental Health', \r\n      'General Health'\r\n    ];\r\n    \r\n    // Sort articles by our priority scheme\r\n    const sortedArticles = sortArticlesByPriority(response.articles, priorityCategories);\r\n    \r\n    // Limit to requested count after sorting\r\n    const limitedArticles = sortedArticles.slice(0, limit || sortedArticles.length);\r\n    \r\n    // Log first few articles to verify order\r\n    console.log('Articles returned after prioritization:');\r\n    limitedArticles.slice(0, 5).forEach((article, i) => {\r\n      console.log(`  ${i+1}. [${article.category || 'uncategorized'}]: ${article.title}`);\r\n    });\r\n    \r\n    // Return a modified response with our prioritized articles\r\n    return {\r\n      ...response,\r\n      articles: limitedArticles,\r\n      count: limitedArticles.length\r\n    };\r\n  }\r\n  \r\n  return response;\r\n};\r\n\r\n// Add the prioritization function to the newsService file\r\nfunction sortArticlesByPriority(articles: NewsArticle[], priorityCategories: string[]): NewsArticle[] {\r\n  // Create a copy of the articles array\r\n  const sortedArticles = [...articles];\r\n  \r\n  // Define a function to get priority score (lower is higher priority)\r\n  const getPriorityScore = (article: NewsArticle): number => {\r\n    const category = article.category || '';\r\n    const categoryLower = category.toLowerCase();\r\n    \r\n    // FIRST: Explicitly handle tech content - make sure it's always at the bottom\r\n    // Check if it's explicitly categorized as tech\r\n    if (categoryLower === 'tech' || \r\n        categoryLower.includes('technology') || \r\n        categoryLower.includes('computing') || \r\n        categoryLower.includes('it ') || \r\n        categoryLower.includes('software')) {\r\n      console.log(`üëâ Found tech article, assigning lowest priority: ${article.title}`);\r\n      return 1000; // Tech should be shown last\r\n    }\r\n    \r\n    // 1. Exact match with priority categories (in strict order)\r\n    for (let i = 0; i < priorityCategories.length; i++) {\r\n      if (category === priorityCategories[i]) {\r\n        return i; // Return the exact index position (0, 1, 2, etc.)\r\n      }\r\n    }\r\n    \r\n    // 2. Partial match with priority categories\r\n    for (let i = 0; i < priorityCategories.length; i++) {\r\n      if (category.includes(priorityCategories[i])) {\r\n        return i + 20; // Still keep order but with lower priority than exact matches\r\n      }\r\n    }\r\n    \r\n    // 3. Check for health-related keywords in title/description\r\n    const title = article.title || '';\r\n    const description = article.description || '';\r\n    const content = title + ' ' + description;\r\n    const contentLower = content.toLowerCase();\r\n    \r\n    const healthKeywords = [\r\n      'health', 'medical', 'medicine', 'doctor', 'patient', 'hospital',\r\n      'disease', 'treatment', 'cure', 'wellness', 'fitness', 'diet',\r\n      'nutrition', 'mental', 'therapy', 'clinical', 'drug', 'vaccine',\r\n      'symptom', 'diagnosis', 'cancer', 'heart', 'diabetes', 'covid'\r\n    ];\r\n    \r\n    if (healthKeywords.some(keyword => contentLower.includes(keyword))) {\r\n      return 100; // All health-related content after categorized content\r\n    }\r\n    \r\n    // 4. Check for tech keywords in title/description if not already caught above\r\n    const techKeywords = ['tech', 'technology', 'computing', 'software', 'hardware', \r\n                        'ai', 'artificial intelligence', 'computer', 'code', 'programming',\r\n                        'developer', 'cybersecurity', 'digital', 'internet', 'smartphone',\r\n                        'app ', 'apps ', 'device', 'gadget', 'google', 'apple', 'microsoft',\r\n                        'facebook', 'twitter', 'social media', 'tesla', 'elon musk'];\r\n    \r\n    if (techKeywords.some(keyword => \r\n      contentLower.includes(keyword)\r\n    )) {\r\n      // Extra debug log for tech content detection\r\n      console.log(`üëâ Found tech content by keyword, assigning lowest priority: ${article.title}`);\r\n      return 900; // Tech content at the bottom, but just above explicitly categorized tech\r\n    }\r\n    \r\n    // 5. Everything else (general content)\r\n    return 500; \r\n  };\r\n  \r\n  // Sort articles by priority score\r\n  sortedArticles.sort((a, b) => {\r\n    const priorityA = getPriorityScore(a);\r\n    const priorityB = getPriorityScore(b);\r\n    \r\n    // First sort by priority category\r\n    if (priorityA !== priorityB) {\r\n      return priorityA - priorityB;\r\n    }\r\n    \r\n    // If same priority category, sort by date (newest first)\r\n    const dateA = a.publishedDate || a.pubDate;\r\n    const dateB = b.publishedDate || b.pubDate;\r\n    \r\n    if (dateA && dateB) {\r\n      return new Date(dateB).getTime() - new Date(dateA).getTime();\r\n    }\r\n    \r\n    return 0;\r\n  });\r\n  \r\n  // Add debug information to see what categories are being returned\r\n  console.log('Article order after prioritization:');\r\n  sortedArticles.slice(0, 8).forEach((article, idx) => {\r\n    // Show the priority score as part of the debugging\r\n    const score = getPriorityScore(article);\r\n    const category = article.category || 'uncategorized';\r\n    console.log(`  ${idx + 1}. [${score}] [${category}]: ${article.title}`);\r\n  });\r\n  \r\n  return sortedArticles;\r\n}\r\n\r\n// Update getArticlesByCategory to use the same prioritization logic\r\n\r\nexport const getArticlesByCategory = async (category: string, limit?: number): Promise<NewsFeedResponse> => {\r\n  if (category === 'all') {\r\n    return fetchNewsFeed([], limit);\r\n  }\r\n  \r\n  const params: NewsQueryParams = { \r\n    category, \r\n    limit: limit ? Math.round(limit * 1.5) : 20, // Fetch a few more than needed\r\n    quality: '1' // Get quality articles with good images\r\n  };\r\n  \r\n  const response = await newsService.getArticles(params);\r\n  \r\n  if (response.success && response.articles && response.articles.length > 0) {\r\n    // For category views, we still want to sort by date but within the category\r\n    const sortedArticles = response.articles.sort((a, b) => {\r\n      const dateA = a.publishedDate || a.pubDate;\r\n      const dateB = b.publishedDate || b.pubDate;\r\n      \r\n      if (dateA && dateB) {\r\n        return new Date(dateB).getTime() - new Date(dateA).getTime();\r\n      }\r\n      \r\n      return 0;\r\n    });\r\n    \r\n    // Limit to requested count\r\n    const limitedArticles = sortedArticles.slice(0, limit || sortedArticles.length);\r\n    \r\n    // Return a modified response with our sorted articles\r\n    return {\r\n      ...response,\r\n      articles: limitedArticles,\r\n      count: limitedArticles.length\r\n    };\r\n  }\r\n  \r\n  return response;\r\n};\r\n\r\n// Add these functions at the end of the file\r\n\r\n/**\r\n * Refresh news feed with timestamp to get latest articles\r\n */\r\nexport const refreshNewsFeed = async (categories?: string[], limit?: number): Promise<NewsFeedResponse> => {\r\n  const timestamp = new Date().getTime();\r\n  const params: NewsQueryParams = {\r\n    timestamp, // Add timestamp to bust cache\r\n    limit: limit || 50\r\n  };\r\n  \r\n  if (categories && categories.length > 0) {\r\n    params.category = categories.join(',');\r\n  }\r\n  \r\n  // Use quality parameter for better articles\r\n  params.quality = '1';\r\n  \r\n  console.log('Refreshing news feed with timestamp:', timestamp);\r\n  \r\n  const response = await newsService.getArticles(params);\r\n  \r\n  if (response.success && response.articles && response.articles.length > 0) {\r\n    // Use the same priority sorting as fetchNewsFeed\r\n    const priorityCategories = [\r\n      'Nutrition & Diet', \r\n      'Medical Research', \r\n      'Public Health', \r\n      'Clinical Studies', \r\n      'Disease Prevention', \r\n      'Mental Health', \r\n      'General Health'\r\n    ];\r\n    \r\n    const sortedArticles = sortArticlesByPriority(response.articles, priorityCategories);\r\n    \r\n    // Limit to requested count after sorting\r\n    const limitedArticles = sortedArticles.slice(0, limit || sortedArticles.length);\r\n    \r\n    // Return a modified response with our prioritized articles\r\n    return {\r\n      ...response,\r\n      articles: limitedArticles,\r\n      count: limitedArticles.length\r\n    };\r\n  }\r\n  \r\n  return response;\r\n};\r\n\r\n/**\r\n * Search for news articles based on query\r\n */\r\nexport const searchNewsArticles = async (query: string, limit?: number): Promise<NewsFeedResponse> => {\r\n  if (!query || query.trim() === '') {\r\n    // If no query, return empty results\r\n    return {\r\n      success: true,\r\n      articles: [],\r\n      count: 0,\r\n      pagination: {\r\n        total_items: 0,\r\n        total_pages: 0,\r\n        current_page: 1,\r\n        per_page: 12,\r\n        has_next_page: false,\r\n        has_prev_page: false\r\n      },\r\n      filters_applied: {\r\n        category: null,\r\n        country: null,\r\n        feed_id: null,\r\n        limit: 0\r\n      }\r\n    };\r\n  }\r\n  \r\n  const params: NewsQueryParams = {\r\n    query: query.trim(),\r\n    limit: limit || 50,\r\n    quality: '1' // Get quality articles with good images for search\r\n  };\r\n  \r\n  console.log(`Searching news articles with query: \"${query}\"`);\r\n  \r\n  const response = await newsService.getArticles(params);\r\n  \r\n  if (response.success && response.articles && response.articles.length > 0) {\r\n    // For search results, we want to prioritize by relevance to search term\r\n    // But still use our priority categories as a secondary sort\r\n    const priorityCategories = [\r\n      'Nutrition & Diet', \r\n      'Medical Research', \r\n      'Public Health', \r\n      'Clinical Studies', \r\n      'Disease Prevention', \r\n      'Mental Health', \r\n      'General Health'\r\n    ];\r\n    \r\n    // Sort articles based on search relevance and category\r\n    const sortedArticles = response.articles.sort((a, b) => {\r\n      // First, prioritize by relevance score if available\r\n      if (a.relevanceScore !== undefined && b.relevanceScore !== undefined) {\r\n        if (a.relevanceScore !== b.relevanceScore) {\r\n          return b.relevanceScore - a.relevanceScore;\r\n        }\r\n      }\r\n      \r\n      // If relevance scores are the same, use our category priority\r\n      const categoryA = a.category || '';\r\n      const categoryB = b.category || '';\r\n      \r\n      // Check if categories are in our priority list\r\n      const indexA = priorityCategories.findIndex(cat => categoryA.includes(cat));\r\n      const indexB = priorityCategories.findIndex(cat => categoryB.includes(cat));\r\n      \r\n      // If both categories are in priority list\r\n      if (indexA >= 0 && indexB >= 0) {\r\n        if (indexA !== indexB) {\r\n          return indexA - indexB;\r\n        }\r\n      } \r\n      // If only one category is in priority list\r\n      else if (indexA >= 0) {\r\n        return -1;\r\n      } else if (indexB >= 0) {\r\n        return 1;\r\n      }\r\n      \r\n      // Finally, sort by date\r\n      const dateA = a.publishedDate || a.pubDate;\r\n      const dateB = b.publishedDate || b.pubDate;\r\n      \r\n      if (dateA && dateB) {\r\n        return new Date(dateB).getTime() - new Date(dateA).getTime();\r\n      }\r\n      \r\n      return 0;\r\n    });\r\n    \r\n    // Limit to requested count\r\n    const limitedArticles = sortedArticles.slice(0, limit || sortedArticles.length);\r\n    \r\n    return {\r\n      ...response,\r\n      articles: limitedArticles,\r\n      count: limitedArticles.length\r\n    };\r\n  }\r\n  \r\n  return response;\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}