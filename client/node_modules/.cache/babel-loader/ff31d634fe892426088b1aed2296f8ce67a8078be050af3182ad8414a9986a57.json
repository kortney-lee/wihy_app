{"ast":null,"code":"import axios from 'axios';\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\n\n// RSS API response types\n\n// NEW: Feed Priority Constants\nexport const FEED_PRIORITIES = {\n  TOP_PRIORITY: {\n    min: 8,\n    max: 10,\n    label: 'Top Priority'\n  },\n  HIGH_PRIORITY: {\n    min: 6,\n    max: 7,\n    label: 'High Priority'\n  },\n  MEDIUM_PRIORITY: {\n    min: 4,\n    max: 5,\n    label: 'Medium Priority'\n  },\n  LOW_PRIORITY: {\n    min: 1,\n    max: 3,\n    label: 'Low Priority'\n  },\n  EXTRA_FEEDS: {\n    value: 0,\n    label: 'Extra Content'\n  }\n};\n\n// NEW: Priority-based fetching options\n\n// Add simple cache to prevent duplicate calls\nlet newsCache = {\n  data: null,\n  timestamp: 0\n};\nconst CACHE_DURATION = 5 * 60 * 1000; // 5 minutes\n\n// UPDATED: Main function to fetch RSS articles with priority filtering\nexport const fetchNewsFeed = async (options = {}) => {\n  try {\n    var _data$articles;\n    const {\n      categories,\n      limit = 100,\n      priority,\n      country = 'US',\n      includeExtra = false\n    } = options;\n\n    // Check cache first to prevent duplicate calls\n    const now = Date.now();\n    const cacheKey = `${(categories === null || categories === void 0 ? void 0 : categories.join(',')) || 'all'}_${limit}_${priority || 'all'}_${country}`;\n    if (newsCache.data && newsCache.data.articles && newsCache.data.articles.length >= limit && now - newsCache.timestamp < CACHE_DURATION) {\n      console.log('üì¶ Using cached RSS data');\n      return newsCache.data;\n    }\n    console.log('üîç Fetching RSS articles with priority filtering...', {\n      categories,\n      limit,\n      priority,\n      country\n    });\n\n    // Build API parameters with priority filtering\n    const params = {\n      limit,\n      flat: true,\n      country\n    };\n\n    // Handle priority filtering\n    if (priority) {\n      if (typeof priority === 'number') {\n        // Specific priority level\n        params.feed_priority = priority;\n      } else {\n        // Priority range mapping\n        switch (priority) {\n          case 'top':\n            params.feed_priority = 9; // Get feeds with priority 9-10\n            break;\n          case 'high':\n            params.feed_priority = 7; // Get feeds with priority 6-7\n            break;\n          case 'medium':\n            params.feed_priority = 5; // Get feeds with priority 4-5\n            break;\n          case 'low':\n            params.feed_priority = 2; // Get feeds with priority 1-3\n            break;\n          case 'extra':\n            params.feed_priority = 0; // Get extra feeds\n            break;\n        }\n      }\n    } else if (!includeExtra) {\n      // Default: exclude extra feeds (priority 0), show only priority 1-10\n      // Don't set feed_priority param to get all priority feeds 1-10\n    }\n\n    // Handle category filtering\n    if (categories && categories.length > 0 && categories[0] !== 'all') {\n      const mappedCategory = mapFrontendToBackendCategory(categories[0]);\n      if (mappedCategory) {\n        params.category = mappedCategory;\n      }\n    } else {\n      // Default to health category for better relevance\n      params.category = 'health';\n    }\n    console.log('üì° Making RSS API request:', `${API_URL}/news/articles`, 'with params:', params);\n    const response = await axios.get(`${API_URL}/news/articles`, {\n      params,\n      timeout: 10000\n    });\n    const data = response.data;\n    console.log('‚úÖ RSS API response:', {\n      success: data.success,\n      articleCount: ((_data$articles = data.articles) === null || _data$articles === void 0 ? void 0 : _data$articles.length) || 0,\n      count: data.count,\n      filtersApplied: data.filters_applied\n    });\n    if (!data.success) {\n      console.warn('‚ö†Ô∏è RSS API returned success=false, using fallback');\n      return await getFallbackNews();\n    }\n\n    // Convert RSS articles to NewsArticle format\n    const articles = (data.articles || []).filter(article => article.title && article.title.trim() !== '').map((article, index) => {\n      var _article$id;\n      // Enhanced image URL extraction with better validation\n      const extractValidImageUrl = url => {\n        if (!url) return '';\n        const trimmed = url.trim();\n        if (trimmed === 'null' || trimmed === 'undefined' || trimmed === '') return '';\n        if (trimmed.startsWith('http') || trimmed.startsWith('//')) {\n          // Validate it's actually an image URL\n          const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.svg'];\n          const hasImageExtension = imageExtensions.some(ext => trimmed.toLowerCase().includes(ext));\n          // Accept if it has image extension or contains image-related path\n          if (hasImageExtension || trimmed.includes('/image') || trimmed.includes('/photo')) {\n            return trimmed;\n          }\n        }\n        return '';\n      };\n      const thumbnailUrl = extractValidImageUrl(article.media_thumb_url);\n      const imageUrl = extractValidImageUrl(article.media_url);\n\n      // Better summary handling - ensure we have actual content\n      let summary = article.description || article.content_encoded || '';\n\n      // Clean up HTML tags and decode entities if present\n      summary = summary.replace(/<[^>]*>/g, '').trim();\n      summary = summary.replace(/&[^;]+;/g, ' ').trim();\n\n      // If still empty, create a meaningful fallback\n      if (!summary || summary.length < 10) {\n        summary = `Read about ${article.title} from ${article.feed_name}`;\n      }\n      const cleanSummary = summary.length > 200 ? summary.substring(0, 200) + '...' : summary;\n      return {\n        id: ((_article$id = article.id) === null || _article$id === void 0 ? void 0 : _article$id.toString()) || article.guid || `rss_${Date.now()}_${index}`,\n        title: article.title || 'No title',\n        summary: cleanSummary,\n        url: article.link || '#',\n        source: article.feed_name || 'Unknown Source',\n        domain: article.domain || extractDomain(article.link || ''),\n        category: mapBackendCategory(article.category),\n        publishedDate: article.published_date || article.extracted_at || new Date().toISOString(),\n        relevanceScore: calculateRelevanceScore(article.title, article.description, article.feed_priority),\n        tags: extractTags(article.title, article.description),\n        // RSS enhanced fields\n        thumbnailUrl,\n        imageUrl,\n        mediaType: article.media_type || '',\n        mediaDescription: article.media_description || '',\n        author: article.author || '',\n        fullContent: article.content_encoded || '',\n        wordCount: article.word_count || 0,\n        readingTime: article.reading_time || Math.ceil((article.word_count || 200) / 200),\n        hasMedia: !!(thumbnailUrl || imageUrl),\n        hasAuthor: !!(article.author && article.author.trim()),\n        contentLength: article.content_length || 0,\n        feedTitle: article.feed_name || '',\n        guid: article.guid || '',\n        commentsUrl: article.comments_url || '',\n        language: article.language || '',\n        rights: article.rights || '',\n        extractedAt: article.extracted_at || '',\n        lastModified: article.last_modified || '',\n        // RSS API specific fields\n        timeAgo: article.time_ago || formatTimeAgo(article.published_date || article.extracted_at || ''),\n        isRecent: article.is_recent || false,\n        contentQuality: article.content_quality || 'medium',\n        completeness: article.completeness || 'partial',\n        country: article.country || '',\n        feedName: article.feed_name || '',\n        feedId: article.feed_id || 0,\n        feedPriority: article.feed_priority || 0 // NEW: Include feed priority\n      };\n    });\n    console.log('üì∞ Processed RSS articles:', {\n      total: articles.length,\n      withImages: articles.filter(a => a.hasMedia).length,\n      withAuthors: articles.filter(a => a.hasAuthor).length,\n      withSummaries: articles.filter(a => a.summary !== 'Click to read full article').length,\n      categories: [...new Set(articles.map(a => a.category))],\n      priorityDistribution: {\n        topPriority: articles.filter(a => (a.feedPriority || 0) >= 8).length,\n        highPriority: articles.filter(a => (a.feedPriority || 0) >= 6 && (a.feedPriority || 0) < 8).length,\n        mediumPriority: articles.filter(a => (a.feedPriority || 0) >= 4 && (a.feedPriority || 0) < 6).length,\n        lowPriority: articles.filter(a => (a.feedPriority || 0) >= 1 && (a.feedPriority || 0) < 4).length,\n        extraFeeds: articles.filter(a => (a.feedPriority || 0) === 0).length\n      }\n    });\n\n    // Categorize articles\n    const categorizedArticles = {};\n    articles.forEach(article => {\n      const category = article.category;\n      if (!categorizedArticles[category]) {\n        categorizedArticles[category] = [];\n      }\n      categorizedArticles[category].push(article);\n    });\n    const result = {\n      success: true,\n      articles: articles,\n      categories: categorizedArticles,\n      lastUpdated: new Date().toISOString(),\n      count: articles.length,\n      filtersApplied: data.filters_applied,\n      message: 'Health news fetched successfully from RSS feeds with priority filtering'\n    };\n\n    // Cache the result\n    newsCache = {\n      data: result,\n      timestamp: now\n    };\n    return result;\n  } catch (error) {\n    console.error('‚ùå Error fetching RSS feed:', error);\n\n    // If we have cached data, use it even if it's old\n    if (newsCache.data) {\n      console.log('üì¶ Using stale cached data due to error');\n      return newsCache.data;\n    }\n    const fallback = await getFallbackNews();\n    return {\n      ...fallback,\n      message: `RSS service error (${error.message}). Showing sample news.`\n    };\n  }\n};\n\n// NEW: Priority-specific fetch functions\nexport const fetchTopPriorityNews = async (limit = 20) => {\n  return fetchNewsFeed({\n    priority: 'top',\n    limit\n  });\n};\nexport const fetchHighPriorityNews = async (limit = 30) => {\n  return fetchNewsFeed({\n    priority: 'high',\n    limit\n  });\n};\nexport const fetchExtraNews = async (limit = 10) => {\n  return fetchNewsFeed({\n    priority: 'extra',\n    limit\n  });\n};\nexport const fetchMixedPriorityNews = async (limit = 50) => {\n  return fetchNewsFeed({\n    includeExtra: true,\n    limit\n  });\n};\n\n// UPDATED: Legacy wrapper for backward compatibility\nexport const fetchNewsFeedLegacy = async (categories, limit) => {\n  return fetchNewsFeed({\n    categories,\n    limit\n  });\n};\n\n// Clear cache function\nexport const clearNewsCache = () => {\n  newsCache = {\n    data: null,\n    timestamp: 0\n  };\n  console.log('üóëÔ∏è News cache cleared');\n};\n\n// UPDATED: Trigger RSS polling with priority support\nexport const triggerRSSPolling = async (force, feedId, priority) => {\n  try {\n    console.log('üîÑ Triggering RSS polling...', {\n      force,\n      feedId,\n      priority\n    });\n    const params = {};\n    if (force) params.force = 'true';\n    if (feedId) params.feed_id = feedId.toString();\n    if (priority !== undefined) params.feed_priority = priority.toString();\n    const response = await axios.post(`${API_URL}/news/fetch`, {}, {\n      params,\n      timeout: 30000 // Longer timeout for polling\n    });\n    const data = response.data;\n    console.log('‚úÖ RSS polling response:', data);\n    return {\n      success: data.success,\n      results: data.results,\n      message: data.message\n    };\n  } catch (error) {\n    console.error('‚ùå Error triggering RSS polling:', error);\n    return {\n      success: false,\n      message: `Failed to trigger polling: ${error.message}`\n    };\n  }\n};\n\n// UPDATED: Get articles by category with priority support\nexport const getArticlesByCategory = async (category, limit, priority) => {\n  try {\n    console.log('üìÇ Fetching RSS articles for category with priority:', {\n      category,\n      priority,\n      limit\n    });\n    return await fetchNewsFeed({\n      categories: [category],\n      limit,\n      priority\n    });\n  } catch (error) {\n    console.error('‚ùå Error fetching articles by category:', error);\n    return {\n      success: false,\n      message: 'Error fetching articles by category'\n    };\n  }\n};\n\n// UPDATED: Enhanced relevance calculation with priority weighting\nconst calculateRelevanceScore = (title = '', description = '', feedPriority) => {\n  const content = `${title} ${description}`.toLowerCase();\n  const healthKeywords = ['health', 'medical', 'wellness', 'fitness', 'nutrition', 'diet', 'exercise', 'mental health', 'disease', 'treatment', 'research', 'study'];\n  const matchingKeywords = healthKeywords.filter(keyword => content.includes(keyword));\n  let score = 0.5;\n  score += matchingKeywords.length * 0.08;\n\n  // NEW: Boost score based on feed priority\n  if (feedPriority && feedPriority > 0) {\n    const priorityBoost = Math.min(feedPriority / 10 * 0.2, 0.2); // Max 0.2 boost for priority 10\n    score += priorityBoost;\n  }\n  return Math.min(score, 1.0);\n};\n\n// NEW: Priority-aware formatting\nexport const formatArticleForDisplay = article => {\n  const priorityLevel = getPriorityLevel(article.feedPriority || 0);\n  return {\n    ...article,\n    formattedDate: article.timeAgo || formatTimeAgo(article.publishedDate),\n    isTrusted: isTrustedDomain(article.url),\n    relevancePercentage: Math.round(article.relevanceScore * 100),\n    shortSummary: article.summary.length > 150 ? article.summary.substring(0, 150) + '...' : article.summary,\n    displayImage: article.thumbnailUrl || article.imageUrl || article.feedThumbnailUrl || article.feedImageUrl || '',\n    hasValidImage: !!(article.thumbnailUrl || article.imageUrl),\n    qualityScore: calculateQualityScore(article),\n    readingTimeText: article.readingTime ? `${article.readingTime} min read` : 'Quick read',\n    priorityLevel,\n    priorityLabel: priorityLevel.label,\n    isPriorityFeed: (article.feedPriority || 0) >= 1\n  };\n};\n\n// NEW: Get priority level information\nexport const getPriorityLevel = priority => {\n  if (priority >= 8) return FEED_PRIORITIES.TOP_PRIORITY;\n  if (priority >= 6) return FEED_PRIORITIES.HIGH_PRIORITY;\n  if (priority >= 4) return FEED_PRIORITIES.MEDIUM_PRIORITY;\n  if (priority >= 1) return FEED_PRIORITIES.LOW_PRIORITY;\n  return FEED_PRIORITIES.EXTRA_FEEDS;\n};\n\n// NEW: Filter articles by priority\nexport const filterArticlesByPriority = (articles, minPriority = 1, maxPriority = 10) => {\n  return articles.filter(article => {\n    const priority = article.feedPriority || 0;\n    return priority >= minPriority && priority <= maxPriority;\n  });\n};\n\n// UPDATED: Enhanced stats with priority breakdown\nexport const getNewsFeedStats = async () => {\n  try {\n    const feedResponse = await fetchNewsFeed({\n      includeExtra: true\n    });\n    if (!feedResponse.success || !feedResponse.articles) {\n      return {\n        success: false,\n        message: 'No articles available for stats'\n      };\n    }\n    const categoryCounts = {};\n    const priorityCounts = {};\n    const sourcesCounts = {};\n    let totalWordCount = 0;\n    let totalReadingTime = 0;\n    let articlesWithImages = 0;\n    let articlesWithAuthors = 0;\n    let trustedSources = 0;\n    const priorityDistribution = {\n      topPriority: 0,\n      highPriority: 0,\n      mediumPriority: 0,\n      lowPriority: 0,\n      extraFeeds: 0\n    };\n    feedResponse.articles.forEach(article => {\n      categoryCounts[article.category] = (categoryCounts[article.category] || 0) + 1;\n      sourcesCounts[article.source] = (sourcesCounts[article.source] || 0) + 1;\n      const priority = article.feedPriority || 0;\n      const priorityLevel = getPriorityLevel(priority);\n      priorityCounts[priorityLevel.label] = (priorityCounts[priorityLevel.label] || 0) + 1;\n\n      // Update priority distribution\n      if (priority >= 8) priorityDistribution.topPriority++;else if (priority >= 6) priorityDistribution.highPriority++;else if (priority >= 4) priorityDistribution.mediumPriority++;else if (priority >= 1) priorityDistribution.lowPriority++;else priorityDistribution.extraFeeds++;\n      if (article.hasMedia) articlesWithImages++;\n      if (article.hasAuthor) articlesWithAuthors++;\n      if (isTrustedDomain(article.url)) trustedSources++;\n      if (article.wordCount) totalWordCount += article.wordCount;\n      if (article.readingTime) totalReadingTime += article.readingTime;\n    });\n    return {\n      success: true,\n      stats: {\n        totalArticles: feedResponse.articles.length,\n        categoryCounts,\n        priorityCounts,\n        lastUpdated: feedResponse.lastUpdated || new Date().toISOString(),\n        sourcesCounts,\n        articlesWithImages,\n        articlesWithAuthors,\n        averageWordCount: Math.round(totalWordCount / feedResponse.articles.length) || 0,\n        averageReadingTime: Math.round(totalReadingTime / feedResponse.articles.length) || 0,\n        trustedSources,\n        priorityDistribution\n      }\n    };\n  } catch (error) {\n    console.error('‚ùå Error fetching RSS stats:', error);\n    return {\n      success: false,\n      message: 'Error fetching news feed statistics'\n    };\n  }\n};\n\n// All other existing functions remain the same...\n// (keeping the rest of the file unchanged for brevity)\n\n// Legacy compatibility exports\nexport { fetchNewsFeedLegacy as fetchNewsFeed };\nexport const newsService = new NewsService();\n\n// NEW: Export priority-based functions for easy use\nexport const NewsServiceWithPriority = {\n  fetchTopPriority: fetchTopPriorityNews,\n  fetchHighPriority: fetchHighPriorityNews,\n  fetchExtra: fetchExtraNews,\n  fetchMixed: fetchMixedPriorityNews,\n  filterByPriority: filterArticlesByPriority,\n  getPriorityLevel,\n  formatForDisplay: formatArticleForDisplay\n};","map":{"version":3,"names":["axios","API_URL","process","env","REACT_APP_API_URL","FEED_PRIORITIES","TOP_PRIORITY","min","max","label","HIGH_PRIORITY","MEDIUM_PRIORITY","LOW_PRIORITY","EXTRA_FEEDS","value","newsCache","data","timestamp","CACHE_DURATION","fetchNewsFeed","options","_data$articles","categories","limit","priority","country","includeExtra","now","Date","cacheKey","join","articles","length","console","log","params","flat","feed_priority","mappedCategory","mapFrontendToBackendCategory","category","response","get","timeout","success","articleCount","count","filtersApplied","filters_applied","warn","getFallbackNews","filter","article","title","trim","map","index","_article$id","extractValidImageUrl","url","trimmed","startsWith","imageExtensions","hasImageExtension","some","ext","toLowerCase","includes","thumbnailUrl","media_thumb_url","imageUrl","media_url","summary","description","content_encoded","replace","feed_name","cleanSummary","substring","id","toString","guid","link","source","domain","extractDomain","mapBackendCategory","publishedDate","published_date","extracted_at","toISOString","relevanceScore","calculateRelevanceScore","tags","extractTags","mediaType","media_type","mediaDescription","media_description","author","fullContent","wordCount","word_count","readingTime","reading_time","Math","ceil","hasMedia","hasAuthor","contentLength","content_length","feedTitle","commentsUrl","comments_url","language","rights","extractedAt","lastModified","last_modified","timeAgo","time_ago","formatTimeAgo","isRecent","is_recent","contentQuality","content_quality","completeness","feedName","feedId","feed_id","feedPriority","total","withImages","a","withAuthors","withSummaries","Set","priorityDistribution","topPriority","highPriority","mediumPriority","lowPriority","extraFeeds","categorizedArticles","forEach","push","result","lastUpdated","message","error","fallback","fetchTopPriorityNews","fetchHighPriorityNews","fetchExtraNews","fetchMixedPriorityNews","fetchNewsFeedLegacy","clearNewsCache","triggerRSSPolling","force","undefined","post","results","getArticlesByCategory","content","healthKeywords","matchingKeywords","keyword","score","priorityBoost","formatArticleForDisplay","priorityLevel","getPriorityLevel","formattedDate","isTrusted","isTrustedDomain","relevancePercentage","round","shortSummary","displayImage","feedThumbnailUrl","feedImageUrl","hasValidImage","qualityScore","calculateQualityScore","readingTimeText","priorityLabel","isPriorityFeed","filterArticlesByPriority","minPriority","maxPriority","getNewsFeedStats","feedResponse","categoryCounts","priorityCounts","sourcesCounts","totalWordCount","totalReadingTime","articlesWithImages","articlesWithAuthors","trustedSources","stats","totalArticles","averageWordCount","averageReadingTime","newsService","NewsService","NewsServiceWithPriority","fetchTopPriority","fetchHighPriority","fetchExtra","fetchMixed","filterByPriority","formatForDisplay"],"sources":["C:/vHealth/vhealth/client/src/services/newsService.ts"],"sourcesContent":["import axios from 'axios';\r\n\r\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\r\n\r\nexport interface NewsArticle {\r\n  id: string;\r\n  title: string;\r\n  summary: string;\r\n  url: string;\r\n  source: string;\r\n  domain: string;\r\n  category: string;\r\n  publishedDate: string;\r\n  relevanceScore: number;\r\n  tags: string[];\r\n  // Enhanced RSS fields\r\n  thumbnailUrl?: string;\r\n  imageUrl?: string;\r\n  mediaType?: string;\r\n  mediaDescription?: string;\r\n  author?: string;\r\n  fullContent?: string;\r\n  wordCount?: number;\r\n  readingTime?: number;\r\n  hasMedia: boolean;\r\n  hasAuthor: boolean;\r\n  contentLength?: number;\r\n  feedTitle?: string;\r\n  feedImageUrl?: string;\r\n  feedThumbnailUrl?: string;\r\n  guid?: string;\r\n  commentsUrl?: string;\r\n  language?: string;\r\n  rights?: string;\r\n  extractedAt?: string;\r\n  lastModified?: string;\r\n  // RSS API enhanced fields\r\n  timeAgo?: string;\r\n  isRecent?: boolean;\r\n  contentQuality?: 'low' | 'medium' | 'high';\r\n  completeness?: 'minimal' | 'partial' | 'complete';\r\n  country?: string;\r\n  feedName?: string;\r\n  feedId?: number;\r\n  feedPriority?: number; // NEW: Feed priority (1-10 = top priority, 0 = extra)\r\n}\r\n\r\nexport interface NewsFeedResponse {\r\n  success: boolean;\r\n  message?: string;\r\n  articles?: NewsArticle[];\r\n  categories?: Record<string, NewsArticle[]>;\r\n  lastUpdated?: string;\r\n  count?: number;\r\n  filtersApplied?: {\r\n    category?: string | null;\r\n    country?: string | null;\r\n    feed_id?: string | null;\r\n    feed_priority?: number | null; // NEW: Priority filter\r\n    limit?: number;\r\n  };\r\n}\r\n\r\n// RSS API response types\r\ninterface RSSArticleResponse {\r\n  id: number;\r\n  title: string;\r\n  description: string;\r\n  link: string;\r\n  published_date: string;\r\n  author?: string;\r\n  category?: string;\r\n  country?: string;\r\n  feed_name: string;\r\n  feed_id: number;\r\n  feed_priority?: number; // NEW: Feed priority\r\n  time_ago: string;\r\n  reading_time: number;\r\n  word_count: number;\r\n  is_recent: boolean;\r\n  content_quality: 'low' | 'medium' | 'high';\r\n  completeness: 'minimal' | 'partial' | 'complete';\r\n  domain: string;\r\n  extracted_at: string;\r\n  // Additional possible fields\r\n  media_thumb_url?: string;\r\n  media_url?: string;\r\n  media_type?: string;\r\n  media_description?: string;\r\n  content_encoded?: string;\r\n  guid?: string;\r\n  comments_url?: string;\r\n  language?: string;\r\n  rights?: string;\r\n  last_modified?: string;\r\n  has_media?: boolean;\r\n  has_author?: boolean;\r\n  content_length?: number;\r\n}\r\n\r\ninterface RSSResponse {\r\n  success: boolean;\r\n  articles: RSSArticleResponse[];\r\n  count: number;\r\n  filters_applied: {\r\n    category: string | null;\r\n    country: string | null;\r\n    feed_id: string | null;\r\n    feed_priority: number | null; // NEW: Priority filter\r\n    limit: number;\r\n  };\r\n  message?: string;\r\n}\r\n\r\n// NEW: Feed Priority Constants\r\nexport const FEED_PRIORITIES = {\r\n  TOP_PRIORITY: { min: 8, max: 10, label: 'Top Priority' },\r\n  HIGH_PRIORITY: { min: 6, max: 7, label: 'High Priority' },\r\n  MEDIUM_PRIORITY: { min: 4, max: 5, label: 'Medium Priority' },\r\n  LOW_PRIORITY: { min: 1, max: 3, label: 'Low Priority' },\r\n  EXTRA_FEEDS: { value: 0, label: 'Extra Content' }\r\n} as const;\r\n\r\n// NEW: Priority-based fetching options\r\nexport interface NewsFetchOptions {\r\n  categories?: string[];\r\n  limit?: number;\r\n  priority?: 'top' | 'high' | 'medium' | 'low' | 'extra' | number;\r\n  country?: string;\r\n  includeExtra?: boolean;\r\n}\r\n\r\n// Add simple cache to prevent duplicate calls\r\nlet newsCache: { data: NewsFeedResponse | null; timestamp: number } = {\r\n  data: null,\r\n  timestamp: 0\r\n};\r\n\r\nconst CACHE_DURATION = 5 * 60 * 1000; // 5 minutes\r\n\r\n// UPDATED: Main function to fetch RSS articles with priority filtering\r\nexport const fetchNewsFeed = async (options: NewsFeedOptions = {}): Promise<NewsFeedResponse> => {\r\n  try {\r\n    const {\r\n      categories,\r\n      limit = 100,\r\n      priority,\r\n      country = 'US',\r\n      includeExtra = false\r\n    } = options;\r\n\r\n    // Check cache first to prevent duplicate calls\r\n    const now = Date.now();\r\n    const cacheKey = `${categories?.join(',') || 'all'}_${limit}_${priority || 'all'}_${country}`;\r\n    \r\n    if (newsCache.data && \r\n        newsCache.data.articles && \r\n        newsCache.data.articles.length >= limit &&\r\n        (now - newsCache.timestamp) < CACHE_DURATION) {\r\n      console.log('üì¶ Using cached RSS data');\r\n      return newsCache.data;\r\n    }\r\n    \r\n    console.log('üîç Fetching RSS articles with priority filtering...', { categories, limit, priority, country });\r\n    \r\n    // Build API parameters with priority filtering\r\n    const params: any = {\r\n      limit,\r\n      flat: true,\r\n      country\r\n    };\r\n\r\n    // Handle priority filtering\r\n    if (priority) {\r\n      if (typeof priority === 'number') {\r\n        // Specific priority level\r\n        params.feed_priority = priority;\r\n      } else {\r\n        // Priority range mapping\r\n        switch (priority) {\r\n          case 'top':\r\n            params.feed_priority = 9; // Get feeds with priority 9-10\r\n            break;\r\n          case 'high':\r\n            params.feed_priority = 7; // Get feeds with priority 6-7\r\n            break;\r\n          case 'medium':\r\n            params.feed_priority = 5; // Get feeds with priority 4-5\r\n            break;\r\n          case 'low':\r\n            params.feed_priority = 2; // Get feeds with priority 1-3\r\n            break;\r\n          case 'extra':\r\n            params.feed_priority = 0; // Get extra feeds\r\n            break;\r\n        }\r\n      }\r\n    } else if (!includeExtra) {\r\n      // Default: exclude extra feeds (priority 0), show only priority 1-10\r\n      // Don't set feed_priority param to get all priority feeds 1-10\r\n    }\r\n    \r\n    // Handle category filtering\r\n    if (categories && categories.length > 0 && categories[0] !== 'all') {\r\n      const mappedCategory = mapFrontendToBackendCategory(categories[0]);\r\n      if (mappedCategory) {\r\n        params.category = mappedCategory;\r\n      }\r\n    } else {\r\n      // Default to health category for better relevance\r\n      params.category = 'health';\r\n    }\r\n    \r\n    console.log('üì° Making RSS API request:', `${API_URL}/news/articles`, 'with params:', params);\r\n    \r\n    const response = await axios.get<RSSResponse>(`${API_URL}/news/articles`, {\r\n      params,\r\n      timeout: 10000\r\n    });\r\n    \r\n    const data = response.data;\r\n    \r\n    console.log('‚úÖ RSS API response:', {\r\n      success: data.success,\r\n      articleCount: data.articles?.length || 0,\r\n      count: data.count,\r\n      filtersApplied: data.filters_applied\r\n    });\r\n\r\n    if (!data.success) {\r\n      console.warn('‚ö†Ô∏è RSS API returned success=false, using fallback');\r\n      return await getFallbackNews();\r\n    }\r\n\r\n    // Convert RSS articles to NewsArticle format\r\n    const articles: NewsArticle[] = (data.articles || [])\r\n      .filter(article => article.title && article.title.trim() !== '')\r\n      .map((article: RSSArticleResponse, index: number) => {\r\n        \r\n        // Enhanced image URL extraction with better validation\r\n        const extractValidImageUrl = (url: string | undefined): string => {\r\n          if (!url) return '';\r\n          const trimmed = url.trim();\r\n          if (trimmed === 'null' || trimmed === 'undefined' || trimmed === '') return '';\r\n          if (trimmed.startsWith('http') || trimmed.startsWith('//')) {\r\n            // Validate it's actually an image URL\r\n            const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.svg'];\r\n            const hasImageExtension = imageExtensions.some(ext => \r\n              trimmed.toLowerCase().includes(ext)\r\n            );\r\n            // Accept if it has image extension or contains image-related path\r\n            if (hasImageExtension || trimmed.includes('/image') || trimmed.includes('/photo')) {\r\n              return trimmed;\r\n            }\r\n          }\r\n          return '';\r\n        };\r\n        \r\n        const thumbnailUrl = extractValidImageUrl(article.media_thumb_url);\r\n        const imageUrl = extractValidImageUrl(article.media_url);\r\n        \r\n        // Better summary handling - ensure we have actual content\r\n        let summary = article.description || article.content_encoded || '';\r\n        \r\n        // Clean up HTML tags and decode entities if present\r\n        summary = summary.replace(/<[^>]*>/g, '').trim();\r\n        summary = summary.replace(/&[^;]+;/g, ' ').trim();\r\n        \r\n        // If still empty, create a meaningful fallback\r\n        if (!summary || summary.length < 10) {\r\n          summary = `Read about ${article.title} from ${article.feed_name}`;\r\n        }\r\n        \r\n        const cleanSummary = summary.length > 200 ? summary.substring(0, 200) + '...' : summary;\r\n        \r\n        return {\r\n          id: article.id?.toString() || article.guid || `rss_${Date.now()}_${index}`,\r\n          title: article.title || 'No title',\r\n          summary: cleanSummary,\r\n          url: article.link || '#',\r\n          source: article.feed_name || 'Unknown Source',\r\n          domain: article.domain || extractDomain(article.link || ''),\r\n          category: mapBackendCategory(article.category),\r\n          publishedDate: article.published_date || article.extracted_at || new Date().toISOString(),\r\n          relevanceScore: calculateRelevanceScore(article.title, article.description, article.feed_priority),\r\n          tags: extractTags(article.title, article.description),\r\n          \r\n          // RSS enhanced fields\r\n          thumbnailUrl,\r\n          imageUrl,\r\n          mediaType: article.media_type || '',\r\n          mediaDescription: article.media_description || '',\r\n          author: article.author || '',\r\n          fullContent: article.content_encoded || '',\r\n          wordCount: article.word_count || 0,\r\n          readingTime: article.reading_time || Math.ceil((article.word_count || 200) / 200),\r\n          hasMedia: !!(thumbnailUrl || imageUrl),\r\n          hasAuthor: !!(article.author && article.author.trim()),\r\n          contentLength: article.content_length || 0,\r\n          feedTitle: article.feed_name || '',\r\n          guid: article.guid || '',\r\n          commentsUrl: article.comments_url || '',\r\n          language: article.language || '',\r\n          rights: article.rights || '',\r\n          extractedAt: article.extracted_at || '',\r\n          lastModified: article.last_modified || '',\r\n          \r\n          // RSS API specific fields\r\n          timeAgo: article.time_ago || formatTimeAgo(article.published_date || article.extracted_at || ''),\r\n          isRecent: article.is_recent || false,\r\n          contentQuality: article.content_quality || 'medium',\r\n          completeness: article.completeness || 'partial',\r\n          country: article.country || '',\r\n          feedName: article.feed_name || '',\r\n          feedId: article.feed_id || 0,\r\n          feedPriority: article.feed_priority || 0 // NEW: Include feed priority\r\n        };\r\n      });\r\n    \r\n    console.log('üì∞ Processed RSS articles:', {\r\n      total: articles.length,\r\n      withImages: articles.filter(a => a.hasMedia).length,\r\n      withAuthors: articles.filter(a => a.hasAuthor).length,\r\n      withSummaries: articles.filter(a => a.summary !== 'Click to read full article').length,\r\n      categories: [...new Set(articles.map(a => a.category))],\r\n      priorityDistribution: {\r\n        topPriority: articles.filter(a => (a.feedPriority || 0) >= 8).length,\r\n        highPriority: articles.filter(a => (a.feedPriority || 0) >= 6 && (a.feedPriority || 0) < 8).length,\r\n        mediumPriority: articles.filter(a => (a.feedPriority || 0) >= 4 && (a.feedPriority || 0) < 6).length,\r\n        lowPriority: articles.filter(a => (a.feedPriority || 0) >= 1 && (a.feedPriority || 0) < 4).length,\r\n        extraFeeds: articles.filter(a => (a.feedPriority || 0) === 0).length\r\n      }\r\n    });\r\n    \r\n    // Categorize articles\r\n    const categorizedArticles: Record<string, NewsArticle[]> = {};\r\n    articles.forEach(article => {\r\n      const category = article.category;\r\n      if (!categorizedArticles[category]) {\r\n        categorizedArticles[category] = [];\r\n      }\r\n      categorizedArticles[category].push(article);\r\n    });\r\n    \r\n    const result = {\r\n      success: true,\r\n      articles: articles,\r\n      categories: categorizedArticles,\r\n      lastUpdated: new Date().toISOString(),\r\n      count: articles.length,\r\n      filtersApplied: data.filters_applied,\r\n      message: 'Health news fetched successfully from RSS feeds with priority filtering'\r\n    };\r\n    \r\n    // Cache the result\r\n    newsCache = {\r\n      data: result,\r\n      timestamp: now\r\n    };\r\n    \r\n    return result;\r\n    \r\n  } catch (error: any) {\r\n    console.error('‚ùå Error fetching RSS feed:', error);\r\n    \r\n    // If we have cached data, use it even if it's old\r\n    if (newsCache.data) {\r\n      console.log('üì¶ Using stale cached data due to error');\r\n      return newsCache.data;\r\n    }\r\n    \r\n    const fallback = await getFallbackNews();\r\n    return {\r\n      ...fallback,\r\n      message: `RSS service error (${error.message}). Showing sample news.`\r\n    };\r\n  }\r\n};\r\n\r\n// NEW: Priority-specific fetch functions\r\nexport const fetchTopPriorityNews = async (limit = 20): Promise<NewsFeedResponse> => {\r\n  return fetchNewsFeed({ priority: 'top', limit });\r\n};\r\n\r\nexport const fetchHighPriorityNews = async (limit = 30): Promise<NewsFeedResponse> => {\r\n  return fetchNewsFeed({ priority: 'high', limit });\r\n};\r\n\r\nexport const fetchExtraNews = async (limit = 10): Promise<NewsFeedResponse> => {\r\n  return fetchNewsFeed({ priority: 'extra', limit });\r\n};\r\n\r\nexport const fetchMixedPriorityNews = async (limit = 50): Promise<NewsFeedResponse> => {\r\n  return fetchNewsFeed({ includeExtra: true, limit });\r\n};\r\n\r\n// UPDATED: Legacy wrapper for backward compatibility\r\nexport const fetchNewsFeedLegacy = async (categories?: string[], limit?: number): Promise<NewsFeedResponse> => {\r\n  return fetchNewsFeed({ categories, limit });\r\n};\r\n\r\n// Clear cache function\r\nexport const clearNewsCache = () => {\r\n  newsCache = { data: null, timestamp: 0 };\r\n  console.log('üóëÔ∏è News cache cleared');\r\n};\r\n\r\n// UPDATED: Trigger RSS polling with priority support\r\nexport const triggerRSSPolling = async (force?: boolean, feedId?: number, priority?: number): Promise<{\r\n  success: boolean;\r\n  results?: any;\r\n  message?: string;\r\n}> => {\r\n  try {\r\n    console.log('üîÑ Triggering RSS polling...', { force, feedId, priority });\r\n    \r\n    const params: any = {};\r\n    if (force) params.force = 'true';\r\n    if (feedId) params.feed_id = feedId.toString();\r\n    if (priority !== undefined) params.feed_priority = priority.toString();\r\n    \r\n    const response = await axios.post<RSSPollingResponse>(`${API_URL}/news/fetch`, {}, {\r\n      params,\r\n      timeout: 30000 // Longer timeout for polling\r\n    });\r\n    \r\n    const data = response.data;\r\n    console.log('‚úÖ RSS polling response:', data);\r\n    \r\n    return {\r\n      success: data.success,\r\n      results: data.results,\r\n      message: data.message\r\n    };\r\n    \r\n  } catch (error: any) {\r\n    console.error('‚ùå Error triggering RSS polling:', error);\r\n    return {\r\n      success: false,\r\n      message: `Failed to trigger polling: ${error.message}`\r\n    };\r\n  }\r\n};\r\n\r\n// UPDATED: Get articles by category with priority support\r\nexport const getArticlesByCategory = async (\r\n  category: string, \r\n  limit?: number, \r\n  priority?: 'top' | 'high' | 'medium' | 'low' | 'extra'\r\n): Promise<NewsFeedResponse> => {\r\n  try {\r\n    console.log('üìÇ Fetching RSS articles for category with priority:', { category, priority, limit });\r\n    return await fetchNewsFeed({ \r\n      categories: [category], \r\n      limit, \r\n      priority \r\n    });\r\n  } catch (error: any) {\r\n    console.error('‚ùå Error fetching articles by category:', error);\r\n    return {\r\n      success: false,\r\n      message: 'Error fetching articles by category'\r\n    };\r\n  }\r\n};\r\n\r\n// UPDATED: Enhanced relevance calculation with priority weighting\r\nconst calculateRelevanceScore = (title: string = '', description: string = '', feedPriority?: number): number => {\r\n  const content = `${title} ${description}`.toLowerCase();\r\n  \r\n  const healthKeywords = ['health', 'medical', 'wellness', 'fitness', 'nutrition', 'diet', 'exercise', 'mental health', 'disease', 'treatment', 'research', 'study'];\r\n  const matchingKeywords = healthKeywords.filter(keyword => content.includes(keyword));\r\n  \r\n  let score = 0.5;\r\n  score += (matchingKeywords.length * 0.08);\r\n  \r\n  // NEW: Boost score based on feed priority\r\n  if (feedPriority && feedPriority > 0) {\r\n    const priorityBoost = Math.min(feedPriority / 10 * 0.2, 0.2); // Max 0.2 boost for priority 10\r\n    score += priorityBoost;\r\n  }\r\n  \r\n  return Math.min(score, 1.0);\r\n};\r\n\r\n// NEW: Priority-aware formatting\r\nexport const formatArticleForDisplay = (article: NewsArticle) => {\r\n  const priorityLevel = getPriorityLevel(article.feedPriority || 0);\r\n  \r\n  return {\r\n    ...article,\r\n    formattedDate: article.timeAgo || formatTimeAgo(article.publishedDate),\r\n    isTrusted: isTrustedDomain(article.url),\r\n    relevancePercentage: Math.round(article.relevanceScore * 100),\r\n    shortSummary: article.summary.length > 150 \r\n      ? article.summary.substring(0, 150) + '...'\r\n      : article.summary,\r\n    displayImage: article.thumbnailUrl || article.imageUrl || article.feedThumbnailUrl || article.feedImageUrl || '',\r\n    hasValidImage: !!(article.thumbnailUrl || article.imageUrl),\r\n    qualityScore: calculateQualityScore(article),\r\n    readingTimeText: article.readingTime ? `${article.readingTime} min read` : 'Quick read',\r\n    priorityLevel,\r\n    priorityLabel: priorityLevel.label,\r\n    isPriorityFeed: (article.feedPriority || 0) >= 1\r\n  };\r\n};\r\n\r\n// NEW: Get priority level information\r\nexport const getPriorityLevel = (priority: number) => {\r\n  if (priority >= 8) return FEED_PRIORITIES.TOP_PRIORITY;\r\n  if (priority >= 6) return FEED_PRIORITIES.HIGH_PRIORITY;\r\n  if (priority >= 4) return FEED_PRIORITIES.MEDIUM_PRIORITY;\r\n  if (priority >= 1) return FEED_PRIORITIES.LOW_PRIORITY;\r\n  return FEED_PRIORITIES.EXTRA_FEEDS;\r\n};\r\n\r\n// NEW: Filter articles by priority\r\nexport const filterArticlesByPriority = (\r\n  articles: NewsArticle[], \r\n  minPriority = 1, \r\n  maxPriority = 10\r\n): NewsArticle[] => {\r\n  return articles.filter(article => {\r\n    const priority = article.feedPriority || 0;\r\n    return priority >= minPriority && priority <= maxPriority;\r\n  });\r\n};\r\n\r\n// UPDATED: Enhanced stats with priority breakdown\r\nexport const getNewsFeedStats = async (): Promise<{\r\n  success: boolean;\r\n  message?: string;\r\n  stats?: {\r\n    totalArticles: number;\r\n    categoryCounts: Record<string, number>;\r\n    priorityCounts: Record<string, number>;\r\n    lastUpdated: string;\r\n    sourcesCounts: Record<string, number>;\r\n    articlesWithImages: number;\r\n    articlesWithAuthors: number;\r\n    averageWordCount: number;\r\n    averageReadingTime: number;\r\n    trustedSources: number;\r\n    priorityDistribution: {\r\n      topPriority: number;\r\n      highPriority: number;\r\n      mediumPriority: number;\r\n      lowPriority: number;\r\n      extraFeeds: number;\r\n    };\r\n  };\r\n}> => {\r\n  try {\r\n    const feedResponse = await fetchNewsFeed({ includeExtra: true });\r\n    \r\n    if (!feedResponse.success || !feedResponse.articles) {\r\n      return {\r\n        success: false,\r\n        message: 'No articles available for stats'\r\n      };\r\n    }\r\n    \r\n    const categoryCounts: Record<string, number> = {};\r\n    const priorityCounts: Record<string, number> = {};\r\n    const sourcesCounts: Record<string, number> = {};\r\n    \r\n    let totalWordCount = 0;\r\n    let totalReadingTime = 0;\r\n    let articlesWithImages = 0;\r\n    let articlesWithAuthors = 0;\r\n    let trustedSources = 0;\r\n    \r\n    const priorityDistribution = {\r\n      topPriority: 0,\r\n      highPriority: 0,\r\n      mediumPriority: 0,\r\n      lowPriority: 0,\r\n      extraFeeds: 0\r\n    };\r\n    \r\n    feedResponse.articles.forEach(article => {\r\n      categoryCounts[article.category] = (categoryCounts[article.category] || 0) + 1;\r\n      sourcesCounts[article.source] = (sourcesCounts[article.source] || 0) + 1;\r\n      \r\n      const priority = article.feedPriority || 0;\r\n      const priorityLevel = getPriorityLevel(priority);\r\n      priorityCounts[priorityLevel.label] = (priorityCounts[priorityLevel.label] || 0) + 1;\r\n      \r\n      // Update priority distribution\r\n      if (priority >= 8) priorityDistribution.topPriority++;\r\n      else if (priority >= 6) priorityDistribution.highPriority++;\r\n      else if (priority >= 4) priorityDistribution.mediumPriority++;\r\n      else if (priority >= 1) priorityDistribution.lowPriority++;\r\n      else priorityDistribution.extraFeeds++;\r\n      \r\n      if (article.hasMedia) articlesWithImages++;\r\n      if (article.hasAuthor) articlesWithAuthors++;\r\n      if (isTrustedDomain(article.url)) trustedSources++;\r\n      if (article.wordCount) totalWordCount += article.wordCount;\r\n      if (article.readingTime) totalReadingTime += article.readingTime;\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      stats: {\r\n        totalArticles: feedResponse.articles.length,\r\n        categoryCounts,\r\n        priorityCounts,\r\n        lastUpdated: feedResponse.lastUpdated || new Date().toISOString(),\r\n        sourcesCounts,\r\n        articlesWithImages,\r\n        articlesWithAuthors,\r\n        averageWordCount: Math.round(totalWordCount / feedResponse.articles.length) || 0,\r\n        averageReadingTime: Math.round(totalReadingTime / feedResponse.articles.length) || 0,\r\n        trustedSources,\r\n        priorityDistribution\r\n      }\r\n    };\r\n  } catch (error: any) {\r\n    console.error('‚ùå Error fetching RSS stats:', error);\r\n    return {\r\n      success: false,\r\n      message: 'Error fetching news feed statistics'\r\n    };\r\n  }\r\n};\r\n\r\n// All other existing functions remain the same...\r\n// (keeping the rest of the file unchanged for brevity)\r\n\r\n// Legacy compatibility exports\r\nexport { fetchNewsFeedLegacy as fetchNewsFeed };\r\nexport const newsService = new NewsService();\r\n\r\n// NEW: Export priority-based functions for easy use\r\nexport const NewsServiceWithPriority = {\r\n  fetchTopPriority: fetchTopPriorityNews,\r\n  fetchHighPriority: fetchHighPriorityNews,\r\n  fetchExtra: fetchExtraNews,\r\n  fetchMixed: fetchMixedPriorityNews,\r\n  filterByPriority: filterArticlesByPriority,\r\n  getPriorityLevel,\r\n  formatForDisplay: formatArticleForDisplay\r\n};"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AAEzB,MAAMC,OAAO,GAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,IAAI,2BAA2B;;AA6D5E;;AAmDA;AACA,OAAO,MAAMC,eAAe,GAAG;EAC7BC,YAAY,EAAE;IAAEC,GAAG,EAAE,CAAC;IAAEC,GAAG,EAAE,EAAE;IAAEC,KAAK,EAAE;EAAe,CAAC;EACxDC,aAAa,EAAE;IAAEH,GAAG,EAAE,CAAC;IAAEC,GAAG,EAAE,CAAC;IAAEC,KAAK,EAAE;EAAgB,CAAC;EACzDE,eAAe,EAAE;IAAEJ,GAAG,EAAE,CAAC;IAAEC,GAAG,EAAE,CAAC;IAAEC,KAAK,EAAE;EAAkB,CAAC;EAC7DG,YAAY,EAAE;IAAEL,GAAG,EAAE,CAAC;IAAEC,GAAG,EAAE,CAAC;IAAEC,KAAK,EAAE;EAAe,CAAC;EACvDI,WAAW,EAAE;IAAEC,KAAK,EAAE,CAAC;IAAEL,KAAK,EAAE;EAAgB;AAClD,CAAU;;AAEV;;AASA;AACA,IAAIM,SAA+D,GAAG;EACpEC,IAAI,EAAE,IAAI;EACVC,SAAS,EAAE;AACb,CAAC;AAED,MAAMC,cAAc,GAAG,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;;AAEtC;AACA,OAAO,MAAMC,aAAa,GAAG,MAAAA,CAAOC,OAAwB,GAAG,CAAC,CAAC,KAAgC;EAC/F,IAAI;IAAA,IAAAC,cAAA;IACF,MAAM;MACJC,UAAU;MACVC,KAAK,GAAG,GAAG;MACXC,QAAQ;MACRC,OAAO,GAAG,IAAI;MACdC,YAAY,GAAG;IACjB,CAAC,GAAGN,OAAO;;IAEX;IACA,MAAMO,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;IACtB,MAAME,QAAQ,GAAG,GAAG,CAAAP,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEQ,IAAI,CAAC,GAAG,CAAC,KAAI,KAAK,IAAIP,KAAK,IAAIC,QAAQ,IAAI,KAAK,IAAIC,OAAO,EAAE;IAE7F,IAAIV,SAAS,CAACC,IAAI,IACdD,SAAS,CAACC,IAAI,CAACe,QAAQ,IACvBhB,SAAS,CAACC,IAAI,CAACe,QAAQ,CAACC,MAAM,IAAIT,KAAK,IACtCI,GAAG,GAAGZ,SAAS,CAACE,SAAS,GAAIC,cAAc,EAAE;MAChDe,OAAO,CAACC,GAAG,CAAC,0BAA0B,CAAC;MACvC,OAAOnB,SAAS,CAACC,IAAI;IACvB;IAEAiB,OAAO,CAACC,GAAG,CAAC,qDAAqD,EAAE;MAAEZ,UAAU;MAAEC,KAAK;MAAEC,QAAQ;MAAEC;IAAQ,CAAC,CAAC;;IAE5G;IACA,MAAMU,MAAW,GAAG;MAClBZ,KAAK;MACLa,IAAI,EAAE,IAAI;MACVX;IACF,CAAC;;IAED;IACA,IAAID,QAAQ,EAAE;MACZ,IAAI,OAAOA,QAAQ,KAAK,QAAQ,EAAE;QAChC;QACAW,MAAM,CAACE,aAAa,GAAGb,QAAQ;MACjC,CAAC,MAAM;QACL;QACA,QAAQA,QAAQ;UACd,KAAK,KAAK;YACRW,MAAM,CAACE,aAAa,GAAG,CAAC,CAAC,CAAC;YAC1B;UACF,KAAK,MAAM;YACTF,MAAM,CAACE,aAAa,GAAG,CAAC,CAAC,CAAC;YAC1B;UACF,KAAK,QAAQ;YACXF,MAAM,CAACE,aAAa,GAAG,CAAC,CAAC,CAAC;YAC1B;UACF,KAAK,KAAK;YACRF,MAAM,CAACE,aAAa,GAAG,CAAC,CAAC,CAAC;YAC1B;UACF,KAAK,OAAO;YACVF,MAAM,CAACE,aAAa,GAAG,CAAC,CAAC,CAAC;YAC1B;QACJ;MACF;IACF,CAAC,MAAM,IAAI,CAACX,YAAY,EAAE;MACxB;MACA;IAAA;;IAGF;IACA,IAAIJ,UAAU,IAAIA,UAAU,CAACU,MAAM,GAAG,CAAC,IAAIV,UAAU,CAAC,CAAC,CAAC,KAAK,KAAK,EAAE;MAClE,MAAMgB,cAAc,GAAGC,4BAA4B,CAACjB,UAAU,CAAC,CAAC,CAAC,CAAC;MAClE,IAAIgB,cAAc,EAAE;QAClBH,MAAM,CAACK,QAAQ,GAAGF,cAAc;MAClC;IACF,CAAC,MAAM;MACL;MACAH,MAAM,CAACK,QAAQ,GAAG,QAAQ;IAC5B;IAEAP,OAAO,CAACC,GAAG,CAAC,4BAA4B,EAAE,GAAGjC,OAAO,gBAAgB,EAAE,cAAc,EAAEkC,MAAM,CAAC;IAE7F,MAAMM,QAAQ,GAAG,MAAMzC,KAAK,CAAC0C,GAAG,CAAc,GAAGzC,OAAO,gBAAgB,EAAE;MACxEkC,MAAM;MACNQ,OAAO,EAAE;IACX,CAAC,CAAC;IAEF,MAAM3B,IAAI,GAAGyB,QAAQ,CAACzB,IAAI;IAE1BiB,OAAO,CAACC,GAAG,CAAC,qBAAqB,EAAE;MACjCU,OAAO,EAAE5B,IAAI,CAAC4B,OAAO;MACrBC,YAAY,EAAE,EAAAxB,cAAA,GAAAL,IAAI,CAACe,QAAQ,cAAAV,cAAA,uBAAbA,cAAA,CAAeW,MAAM,KAAI,CAAC;MACxCc,KAAK,EAAE9B,IAAI,CAAC8B,KAAK;MACjBC,cAAc,EAAE/B,IAAI,CAACgC;IACvB,CAAC,CAAC;IAEF,IAAI,CAAChC,IAAI,CAAC4B,OAAO,EAAE;MACjBX,OAAO,CAACgB,IAAI,CAAC,mDAAmD,CAAC;MACjE,OAAO,MAAMC,eAAe,CAAC,CAAC;IAChC;;IAEA;IACA,MAAMnB,QAAuB,GAAG,CAACf,IAAI,CAACe,QAAQ,IAAI,EAAE,EACjDoB,MAAM,CAACC,OAAO,IAAIA,OAAO,CAACC,KAAK,IAAID,OAAO,CAACC,KAAK,CAACC,IAAI,CAAC,CAAC,KAAK,EAAE,CAAC,CAC/DC,GAAG,CAAC,CAACH,OAA2B,EAAEI,KAAa,KAAK;MAAA,IAAAC,WAAA;MAEnD;MACA,MAAMC,oBAAoB,GAAIC,GAAuB,IAAa;QAChE,IAAI,CAACA,GAAG,EAAE,OAAO,EAAE;QACnB,MAAMC,OAAO,GAAGD,GAAG,CAACL,IAAI,CAAC,CAAC;QAC1B,IAAIM,OAAO,KAAK,MAAM,IAAIA,OAAO,KAAK,WAAW,IAAIA,OAAO,KAAK,EAAE,EAAE,OAAO,EAAE;QAC9E,IAAIA,OAAO,CAACC,UAAU,CAAC,MAAM,CAAC,IAAID,OAAO,CAACC,UAAU,CAAC,IAAI,CAAC,EAAE;UAC1D;UACA,MAAMC,eAAe,GAAG,CAAC,MAAM,EAAE,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,MAAM,CAAC;UAC1E,MAAMC,iBAAiB,GAAGD,eAAe,CAACE,IAAI,CAACC,GAAG,IAChDL,OAAO,CAACM,WAAW,CAAC,CAAC,CAACC,QAAQ,CAACF,GAAG,CACpC,CAAC;UACD;UACA,IAAIF,iBAAiB,IAAIH,OAAO,CAACO,QAAQ,CAAC,QAAQ,CAAC,IAAIP,OAAO,CAACO,QAAQ,CAAC,QAAQ,CAAC,EAAE;YACjF,OAAOP,OAAO;UAChB;QACF;QACA,OAAO,EAAE;MACX,CAAC;MAED,MAAMQ,YAAY,GAAGV,oBAAoB,CAACN,OAAO,CAACiB,eAAe,CAAC;MAClE,MAAMC,QAAQ,GAAGZ,oBAAoB,CAACN,OAAO,CAACmB,SAAS,CAAC;;MAExD;MACA,IAAIC,OAAO,GAAGpB,OAAO,CAACqB,WAAW,IAAIrB,OAAO,CAACsB,eAAe,IAAI,EAAE;;MAElE;MACAF,OAAO,GAAGA,OAAO,CAACG,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAACrB,IAAI,CAAC,CAAC;MAChDkB,OAAO,GAAGA,OAAO,CAACG,OAAO,CAAC,UAAU,EAAE,GAAG,CAAC,CAACrB,IAAI,CAAC,CAAC;;MAEjD;MACA,IAAI,CAACkB,OAAO,IAAIA,OAAO,CAACxC,MAAM,GAAG,EAAE,EAAE;QACnCwC,OAAO,GAAG,cAAcpB,OAAO,CAACC,KAAK,SAASD,OAAO,CAACwB,SAAS,EAAE;MACnE;MAEA,MAAMC,YAAY,GAAGL,OAAO,CAACxC,MAAM,GAAG,GAAG,GAAGwC,OAAO,CAACM,SAAS,CAAC,CAAC,EAAE,GAAG,CAAC,GAAG,KAAK,GAAGN,OAAO;MAEvF,OAAO;QACLO,EAAE,EAAE,EAAAtB,WAAA,GAAAL,OAAO,CAAC2B,EAAE,cAAAtB,WAAA,uBAAVA,WAAA,CAAYuB,QAAQ,CAAC,CAAC,KAAI5B,OAAO,CAAC6B,IAAI,IAAI,OAAOrD,IAAI,CAACD,GAAG,CAAC,CAAC,IAAI6B,KAAK,EAAE;QAC1EH,KAAK,EAAED,OAAO,CAACC,KAAK,IAAI,UAAU;QAClCmB,OAAO,EAAEK,YAAY;QACrBlB,GAAG,EAAEP,OAAO,CAAC8B,IAAI,IAAI,GAAG;QACxBC,MAAM,EAAE/B,OAAO,CAACwB,SAAS,IAAI,gBAAgB;QAC7CQ,MAAM,EAAEhC,OAAO,CAACgC,MAAM,IAAIC,aAAa,CAACjC,OAAO,CAAC8B,IAAI,IAAI,EAAE,CAAC;QAC3D1C,QAAQ,EAAE8C,kBAAkB,CAAClC,OAAO,CAACZ,QAAQ,CAAC;QAC9C+C,aAAa,EAAEnC,OAAO,CAACoC,cAAc,IAAIpC,OAAO,CAACqC,YAAY,IAAI,IAAI7D,IAAI,CAAC,CAAC,CAAC8D,WAAW,CAAC,CAAC;QACzFC,cAAc,EAAEC,uBAAuB,CAACxC,OAAO,CAACC,KAAK,EAAED,OAAO,CAACqB,WAAW,EAAErB,OAAO,CAACf,aAAa,CAAC;QAClGwD,IAAI,EAAEC,WAAW,CAAC1C,OAAO,CAACC,KAAK,EAAED,OAAO,CAACqB,WAAW,CAAC;QAErD;QACAL,YAAY;QACZE,QAAQ;QACRyB,SAAS,EAAE3C,OAAO,CAAC4C,UAAU,IAAI,EAAE;QACnCC,gBAAgB,EAAE7C,OAAO,CAAC8C,iBAAiB,IAAI,EAAE;QACjDC,MAAM,EAAE/C,OAAO,CAAC+C,MAAM,IAAI,EAAE;QAC5BC,WAAW,EAAEhD,OAAO,CAACsB,eAAe,IAAI,EAAE;QAC1C2B,SAAS,EAAEjD,OAAO,CAACkD,UAAU,IAAI,CAAC;QAClCC,WAAW,EAAEnD,OAAO,CAACoD,YAAY,IAAIC,IAAI,CAACC,IAAI,CAAC,CAACtD,OAAO,CAACkD,UAAU,IAAI,GAAG,IAAI,GAAG,CAAC;QACjFK,QAAQ,EAAE,CAAC,EAAEvC,YAAY,IAAIE,QAAQ,CAAC;QACtCsC,SAAS,EAAE,CAAC,EAAExD,OAAO,CAAC+C,MAAM,IAAI/C,OAAO,CAAC+C,MAAM,CAAC7C,IAAI,CAAC,CAAC,CAAC;QACtDuD,aAAa,EAAEzD,OAAO,CAAC0D,cAAc,IAAI,CAAC;QAC1CC,SAAS,EAAE3D,OAAO,CAACwB,SAAS,IAAI,EAAE;QAClCK,IAAI,EAAE7B,OAAO,CAAC6B,IAAI,IAAI,EAAE;QACxB+B,WAAW,EAAE5D,OAAO,CAAC6D,YAAY,IAAI,EAAE;QACvCC,QAAQ,EAAE9D,OAAO,CAAC8D,QAAQ,IAAI,EAAE;QAChCC,MAAM,EAAE/D,OAAO,CAAC+D,MAAM,IAAI,EAAE;QAC5BC,WAAW,EAAEhE,OAAO,CAACqC,YAAY,IAAI,EAAE;QACvC4B,YAAY,EAAEjE,OAAO,CAACkE,aAAa,IAAI,EAAE;QAEzC;QACAC,OAAO,EAAEnE,OAAO,CAACoE,QAAQ,IAAIC,aAAa,CAACrE,OAAO,CAACoC,cAAc,IAAIpC,OAAO,CAACqC,YAAY,IAAI,EAAE,CAAC;QAChGiC,QAAQ,EAAEtE,OAAO,CAACuE,SAAS,IAAI,KAAK;QACpCC,cAAc,EAAExE,OAAO,CAACyE,eAAe,IAAI,QAAQ;QACnDC,YAAY,EAAE1E,OAAO,CAAC0E,YAAY,IAAI,SAAS;QAC/CrG,OAAO,EAAE2B,OAAO,CAAC3B,OAAO,IAAI,EAAE;QAC9BsG,QAAQ,EAAE3E,OAAO,CAACwB,SAAS,IAAI,EAAE;QACjCoD,MAAM,EAAE5E,OAAO,CAAC6E,OAAO,IAAI,CAAC;QAC5BC,YAAY,EAAE9E,OAAO,CAACf,aAAa,IAAI,CAAC,CAAC;MAC3C,CAAC;IACH,CAAC,CAAC;IAEJJ,OAAO,CAACC,GAAG,CAAC,4BAA4B,EAAE;MACxCiG,KAAK,EAAEpG,QAAQ,CAACC,MAAM;MACtBoG,UAAU,EAAErG,QAAQ,CAACoB,MAAM,CAACkF,CAAC,IAAIA,CAAC,CAAC1B,QAAQ,CAAC,CAAC3E,MAAM;MACnDsG,WAAW,EAAEvG,QAAQ,CAACoB,MAAM,CAACkF,CAAC,IAAIA,CAAC,CAACzB,SAAS,CAAC,CAAC5E,MAAM;MACrDuG,aAAa,EAAExG,QAAQ,CAACoB,MAAM,CAACkF,CAAC,IAAIA,CAAC,CAAC7D,OAAO,KAAK,4BAA4B,CAAC,CAACxC,MAAM;MACtFV,UAAU,EAAE,CAAC,GAAG,IAAIkH,GAAG,CAACzG,QAAQ,CAACwB,GAAG,CAAC8E,CAAC,IAAIA,CAAC,CAAC7F,QAAQ,CAAC,CAAC,CAAC;MACvDiG,oBAAoB,EAAE;QACpBC,WAAW,EAAE3G,QAAQ,CAACoB,MAAM,CAACkF,CAAC,IAAI,CAACA,CAAC,CAACH,YAAY,IAAI,CAAC,KAAK,CAAC,CAAC,CAAClG,MAAM;QACpE2G,YAAY,EAAE5G,QAAQ,CAACoB,MAAM,CAACkF,CAAC,IAAI,CAACA,CAAC,CAACH,YAAY,IAAI,CAAC,KAAK,CAAC,IAAI,CAACG,CAAC,CAACH,YAAY,IAAI,CAAC,IAAI,CAAC,CAAC,CAAClG,MAAM;QAClG4G,cAAc,EAAE7G,QAAQ,CAACoB,MAAM,CAACkF,CAAC,IAAI,CAACA,CAAC,CAACH,YAAY,IAAI,CAAC,KAAK,CAAC,IAAI,CAACG,CAAC,CAACH,YAAY,IAAI,CAAC,IAAI,CAAC,CAAC,CAAClG,MAAM;QACpG6G,WAAW,EAAE9G,QAAQ,CAACoB,MAAM,CAACkF,CAAC,IAAI,CAACA,CAAC,CAACH,YAAY,IAAI,CAAC,KAAK,CAAC,IAAI,CAACG,CAAC,CAACH,YAAY,IAAI,CAAC,IAAI,CAAC,CAAC,CAAClG,MAAM;QACjG8G,UAAU,EAAE/G,QAAQ,CAACoB,MAAM,CAACkF,CAAC,IAAI,CAACA,CAAC,CAACH,YAAY,IAAI,CAAC,MAAM,CAAC,CAAC,CAAClG;MAChE;IACF,CAAC,CAAC;;IAEF;IACA,MAAM+G,mBAAkD,GAAG,CAAC,CAAC;IAC7DhH,QAAQ,CAACiH,OAAO,CAAC5F,OAAO,IAAI;MAC1B,MAAMZ,QAAQ,GAAGY,OAAO,CAACZ,QAAQ;MACjC,IAAI,CAACuG,mBAAmB,CAACvG,QAAQ,CAAC,EAAE;QAClCuG,mBAAmB,CAACvG,QAAQ,CAAC,GAAG,EAAE;MACpC;MACAuG,mBAAmB,CAACvG,QAAQ,CAAC,CAACyG,IAAI,CAAC7F,OAAO,CAAC;IAC7C,CAAC,CAAC;IAEF,MAAM8F,MAAM,GAAG;MACbtG,OAAO,EAAE,IAAI;MACbb,QAAQ,EAAEA,QAAQ;MAClBT,UAAU,EAAEyH,mBAAmB;MAC/BI,WAAW,EAAE,IAAIvH,IAAI,CAAC,CAAC,CAAC8D,WAAW,CAAC,CAAC;MACrC5C,KAAK,EAAEf,QAAQ,CAACC,MAAM;MACtBe,cAAc,EAAE/B,IAAI,CAACgC,eAAe;MACpCoG,OAAO,EAAE;IACX,CAAC;;IAED;IACArI,SAAS,GAAG;MACVC,IAAI,EAAEkI,MAAM;MACZjI,SAAS,EAAEU;IACb,CAAC;IAED,OAAOuH,MAAM;EAEf,CAAC,CAAC,OAAOG,KAAU,EAAE;IACnBpH,OAAO,CAACoH,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;;IAElD;IACA,IAAItI,SAAS,CAACC,IAAI,EAAE;MAClBiB,OAAO,CAACC,GAAG,CAAC,yCAAyC,CAAC;MACtD,OAAOnB,SAAS,CAACC,IAAI;IACvB;IAEA,MAAMsI,QAAQ,GAAG,MAAMpG,eAAe,CAAC,CAAC;IACxC,OAAO;MACL,GAAGoG,QAAQ;MACXF,OAAO,EAAE,sBAAsBC,KAAK,CAACD,OAAO;IAC9C,CAAC;EACH;AACF,CAAC;;AAED;AACA,OAAO,MAAMG,oBAAoB,GAAG,MAAAA,CAAOhI,KAAK,GAAG,EAAE,KAAgC;EACnF,OAAOJ,aAAa,CAAC;IAAEK,QAAQ,EAAE,KAAK;IAAED;EAAM,CAAC,CAAC;AAClD,CAAC;AAED,OAAO,MAAMiI,qBAAqB,GAAG,MAAAA,CAAOjI,KAAK,GAAG,EAAE,KAAgC;EACpF,OAAOJ,aAAa,CAAC;IAAEK,QAAQ,EAAE,MAAM;IAAED;EAAM,CAAC,CAAC;AACnD,CAAC;AAED,OAAO,MAAMkI,cAAc,GAAG,MAAAA,CAAOlI,KAAK,GAAG,EAAE,KAAgC;EAC7E,OAAOJ,aAAa,CAAC;IAAEK,QAAQ,EAAE,OAAO;IAAED;EAAM,CAAC,CAAC;AACpD,CAAC;AAED,OAAO,MAAMmI,sBAAsB,GAAG,MAAAA,CAAOnI,KAAK,GAAG,EAAE,KAAgC;EACrF,OAAOJ,aAAa,CAAC;IAAEO,YAAY,EAAE,IAAI;IAAEH;EAAM,CAAC,CAAC;AACrD,CAAC;;AAED;AACA,OAAO,MAAMoI,mBAAmB,GAAG,MAAAA,CAAOrI,UAAqB,EAAEC,KAAc,KAAgC;EAC7G,OAAOJ,aAAa,CAAC;IAAEG,UAAU;IAAEC;EAAM,CAAC,CAAC;AAC7C,CAAC;;AAED;AACA,OAAO,MAAMqI,cAAc,GAAGA,CAAA,KAAM;EAClC7I,SAAS,GAAG;IAAEC,IAAI,EAAE,IAAI;IAAEC,SAAS,EAAE;EAAE,CAAC;EACxCgB,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAC;AACvC,CAAC;;AAED;AACA,OAAO,MAAM2H,iBAAiB,GAAG,MAAAA,CAAOC,KAAe,EAAE9B,MAAe,EAAExG,QAAiB,KAIrF;EACJ,IAAI;IACFS,OAAO,CAACC,GAAG,CAAC,8BAA8B,EAAE;MAAE4H,KAAK;MAAE9B,MAAM;MAAExG;IAAS,CAAC,CAAC;IAExE,MAAMW,MAAW,GAAG,CAAC,CAAC;IACtB,IAAI2H,KAAK,EAAE3H,MAAM,CAAC2H,KAAK,GAAG,MAAM;IAChC,IAAI9B,MAAM,EAAE7F,MAAM,CAAC8F,OAAO,GAAGD,MAAM,CAAChD,QAAQ,CAAC,CAAC;IAC9C,IAAIxD,QAAQ,KAAKuI,SAAS,EAAE5H,MAAM,CAACE,aAAa,GAAGb,QAAQ,CAACwD,QAAQ,CAAC,CAAC;IAEtE,MAAMvC,QAAQ,GAAG,MAAMzC,KAAK,CAACgK,IAAI,CAAqB,GAAG/J,OAAO,aAAa,EAAE,CAAC,CAAC,EAAE;MACjFkC,MAAM;MACNQ,OAAO,EAAE,KAAK,CAAC;IACjB,CAAC,CAAC;IAEF,MAAM3B,IAAI,GAAGyB,QAAQ,CAACzB,IAAI;IAC1BiB,OAAO,CAACC,GAAG,CAAC,yBAAyB,EAAElB,IAAI,CAAC;IAE5C,OAAO;MACL4B,OAAO,EAAE5B,IAAI,CAAC4B,OAAO;MACrBqH,OAAO,EAAEjJ,IAAI,CAACiJ,OAAO;MACrBb,OAAO,EAAEpI,IAAI,CAACoI;IAChB,CAAC;EAEH,CAAC,CAAC,OAAOC,KAAU,EAAE;IACnBpH,OAAO,CAACoH,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAAC;IACvD,OAAO;MACLzG,OAAO,EAAE,KAAK;MACdwG,OAAO,EAAE,8BAA8BC,KAAK,CAACD,OAAO;IACtD,CAAC;EACH;AACF,CAAC;;AAED;AACA,OAAO,MAAMc,qBAAqB,GAAG,MAAAA,CACnC1H,QAAgB,EAChBjB,KAAc,EACdC,QAAsD,KACxB;EAC9B,IAAI;IACFS,OAAO,CAACC,GAAG,CAAC,sDAAsD,EAAE;MAAEM,QAAQ;MAAEhB,QAAQ;MAAED;IAAM,CAAC,CAAC;IAClG,OAAO,MAAMJ,aAAa,CAAC;MACzBG,UAAU,EAAE,CAACkB,QAAQ,CAAC;MACtBjB,KAAK;MACLC;IACF,CAAC,CAAC;EACJ,CAAC,CAAC,OAAO6H,KAAU,EAAE;IACnBpH,OAAO,CAACoH,KAAK,CAAC,wCAAwC,EAAEA,KAAK,CAAC;IAC9D,OAAO;MACLzG,OAAO,EAAE,KAAK;MACdwG,OAAO,EAAE;IACX,CAAC;EACH;AACF,CAAC;;AAED;AACA,MAAMxD,uBAAuB,GAAGA,CAACvC,KAAa,GAAG,EAAE,EAAEoB,WAAmB,GAAG,EAAE,EAAEyD,YAAqB,KAAa;EAC/G,MAAMiC,OAAO,GAAG,GAAG9G,KAAK,IAAIoB,WAAW,EAAE,CAACP,WAAW,CAAC,CAAC;EAEvD,MAAMkG,cAAc,GAAG,CAAC,QAAQ,EAAE,SAAS,EAAE,UAAU,EAAE,SAAS,EAAE,WAAW,EAAE,MAAM,EAAE,UAAU,EAAE,eAAe,EAAE,SAAS,EAAE,WAAW,EAAE,UAAU,EAAE,OAAO,CAAC;EAClK,MAAMC,gBAAgB,GAAGD,cAAc,CAACjH,MAAM,CAACmH,OAAO,IAAIH,OAAO,CAAChG,QAAQ,CAACmG,OAAO,CAAC,CAAC;EAEpF,IAAIC,KAAK,GAAG,GAAG;EACfA,KAAK,IAAKF,gBAAgB,CAACrI,MAAM,GAAG,IAAK;;EAEzC;EACA,IAAIkG,YAAY,IAAIA,YAAY,GAAG,CAAC,EAAE;IACpC,MAAMsC,aAAa,GAAG/D,IAAI,CAAClG,GAAG,CAAC2H,YAAY,GAAG,EAAE,GAAG,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC;IAC9DqC,KAAK,IAAIC,aAAa;EACxB;EAEA,OAAO/D,IAAI,CAAClG,GAAG,CAACgK,KAAK,EAAE,GAAG,CAAC;AAC7B,CAAC;;AAED;AACA,OAAO,MAAME,uBAAuB,GAAIrH,OAAoB,IAAK;EAC/D,MAAMsH,aAAa,GAAGC,gBAAgB,CAACvH,OAAO,CAAC8E,YAAY,IAAI,CAAC,CAAC;EAEjE,OAAO;IACL,GAAG9E,OAAO;IACVwH,aAAa,EAAExH,OAAO,CAACmE,OAAO,IAAIE,aAAa,CAACrE,OAAO,CAACmC,aAAa,CAAC;IACtEsF,SAAS,EAAEC,eAAe,CAAC1H,OAAO,CAACO,GAAG,CAAC;IACvCoH,mBAAmB,EAAEtE,IAAI,CAACuE,KAAK,CAAC5H,OAAO,CAACuC,cAAc,GAAG,GAAG,CAAC;IAC7DsF,YAAY,EAAE7H,OAAO,CAACoB,OAAO,CAACxC,MAAM,GAAG,GAAG,GACtCoB,OAAO,CAACoB,OAAO,CAACM,SAAS,CAAC,CAAC,EAAE,GAAG,CAAC,GAAG,KAAK,GACzC1B,OAAO,CAACoB,OAAO;IACnB0G,YAAY,EAAE9H,OAAO,CAACgB,YAAY,IAAIhB,OAAO,CAACkB,QAAQ,IAAIlB,OAAO,CAAC+H,gBAAgB,IAAI/H,OAAO,CAACgI,YAAY,IAAI,EAAE;IAChHC,aAAa,EAAE,CAAC,EAAEjI,OAAO,CAACgB,YAAY,IAAIhB,OAAO,CAACkB,QAAQ,CAAC;IAC3DgH,YAAY,EAAEC,qBAAqB,CAACnI,OAAO,CAAC;IAC5CoI,eAAe,EAAEpI,OAAO,CAACmD,WAAW,GAAG,GAAGnD,OAAO,CAACmD,WAAW,WAAW,GAAG,YAAY;IACvFmE,aAAa;IACbe,aAAa,EAAEf,aAAa,CAACjK,KAAK;IAClCiL,cAAc,EAAE,CAACtI,OAAO,CAAC8E,YAAY,IAAI,CAAC,KAAK;EACjD,CAAC;AACH,CAAC;;AAED;AACA,OAAO,MAAMyC,gBAAgB,GAAInJ,QAAgB,IAAK;EACpD,IAAIA,QAAQ,IAAI,CAAC,EAAE,OAAOnB,eAAe,CAACC,YAAY;EACtD,IAAIkB,QAAQ,IAAI,CAAC,EAAE,OAAOnB,eAAe,CAACK,aAAa;EACvD,IAAIc,QAAQ,IAAI,CAAC,EAAE,OAAOnB,eAAe,CAACM,eAAe;EACzD,IAAIa,QAAQ,IAAI,CAAC,EAAE,OAAOnB,eAAe,CAACO,YAAY;EACtD,OAAOP,eAAe,CAACQ,WAAW;AACpC,CAAC;;AAED;AACA,OAAO,MAAM8K,wBAAwB,GAAGA,CACtC5J,QAAuB,EACvB6J,WAAW,GAAG,CAAC,EACfC,WAAW,GAAG,EAAE,KACE;EAClB,OAAO9J,QAAQ,CAACoB,MAAM,CAACC,OAAO,IAAI;IAChC,MAAM5B,QAAQ,GAAG4B,OAAO,CAAC8E,YAAY,IAAI,CAAC;IAC1C,OAAO1G,QAAQ,IAAIoK,WAAW,IAAIpK,QAAQ,IAAIqK,WAAW;EAC3D,CAAC,CAAC;AACJ,CAAC;;AAED;AACA,OAAO,MAAMC,gBAAgB,GAAG,MAAAA,CAAA,KAsB1B;EACJ,IAAI;IACF,MAAMC,YAAY,GAAG,MAAM5K,aAAa,CAAC;MAAEO,YAAY,EAAE;IAAK,CAAC,CAAC;IAEhE,IAAI,CAACqK,YAAY,CAACnJ,OAAO,IAAI,CAACmJ,YAAY,CAAChK,QAAQ,EAAE;MACnD,OAAO;QACLa,OAAO,EAAE,KAAK;QACdwG,OAAO,EAAE;MACX,CAAC;IACH;IAEA,MAAM4C,cAAsC,GAAG,CAAC,CAAC;IACjD,MAAMC,cAAsC,GAAG,CAAC,CAAC;IACjD,MAAMC,aAAqC,GAAG,CAAC,CAAC;IAEhD,IAAIC,cAAc,GAAG,CAAC;IACtB,IAAIC,gBAAgB,GAAG,CAAC;IACxB,IAAIC,kBAAkB,GAAG,CAAC;IAC1B,IAAIC,mBAAmB,GAAG,CAAC;IAC3B,IAAIC,cAAc,GAAG,CAAC;IAEtB,MAAM9D,oBAAoB,GAAG;MAC3BC,WAAW,EAAE,CAAC;MACdC,YAAY,EAAE,CAAC;MACfC,cAAc,EAAE,CAAC;MACjBC,WAAW,EAAE,CAAC;MACdC,UAAU,EAAE;IACd,CAAC;IAEDiD,YAAY,CAAChK,QAAQ,CAACiH,OAAO,CAAC5F,OAAO,IAAI;MACvC4I,cAAc,CAAC5I,OAAO,CAACZ,QAAQ,CAAC,GAAG,CAACwJ,cAAc,CAAC5I,OAAO,CAACZ,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC;MAC9E0J,aAAa,CAAC9I,OAAO,CAAC+B,MAAM,CAAC,GAAG,CAAC+G,aAAa,CAAC9I,OAAO,CAAC+B,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;MAExE,MAAM3D,QAAQ,GAAG4B,OAAO,CAAC8E,YAAY,IAAI,CAAC;MAC1C,MAAMwC,aAAa,GAAGC,gBAAgB,CAACnJ,QAAQ,CAAC;MAChDyK,cAAc,CAACvB,aAAa,CAACjK,KAAK,CAAC,GAAG,CAACwL,cAAc,CAACvB,aAAa,CAACjK,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC;;MAEpF;MACA,IAAIe,QAAQ,IAAI,CAAC,EAAEiH,oBAAoB,CAACC,WAAW,EAAE,CAAC,KACjD,IAAIlH,QAAQ,IAAI,CAAC,EAAEiH,oBAAoB,CAACE,YAAY,EAAE,CAAC,KACvD,IAAInH,QAAQ,IAAI,CAAC,EAAEiH,oBAAoB,CAACG,cAAc,EAAE,CAAC,KACzD,IAAIpH,QAAQ,IAAI,CAAC,EAAEiH,oBAAoB,CAACI,WAAW,EAAE,CAAC,KACtDJ,oBAAoB,CAACK,UAAU,EAAE;MAEtC,IAAI1F,OAAO,CAACuD,QAAQ,EAAE0F,kBAAkB,EAAE;MAC1C,IAAIjJ,OAAO,CAACwD,SAAS,EAAE0F,mBAAmB,EAAE;MAC5C,IAAIxB,eAAe,CAAC1H,OAAO,CAACO,GAAG,CAAC,EAAE4I,cAAc,EAAE;MAClD,IAAInJ,OAAO,CAACiD,SAAS,EAAE8F,cAAc,IAAI/I,OAAO,CAACiD,SAAS;MAC1D,IAAIjD,OAAO,CAACmD,WAAW,EAAE6F,gBAAgB,IAAIhJ,OAAO,CAACmD,WAAW;IAClE,CAAC,CAAC;IAEF,OAAO;MACL3D,OAAO,EAAE,IAAI;MACb4J,KAAK,EAAE;QACLC,aAAa,EAAEV,YAAY,CAAChK,QAAQ,CAACC,MAAM;QAC3CgK,cAAc;QACdC,cAAc;QACd9C,WAAW,EAAE4C,YAAY,CAAC5C,WAAW,IAAI,IAAIvH,IAAI,CAAC,CAAC,CAAC8D,WAAW,CAAC,CAAC;QACjEwG,aAAa;QACbG,kBAAkB;QAClBC,mBAAmB;QACnBI,gBAAgB,EAAEjG,IAAI,CAACuE,KAAK,CAACmB,cAAc,GAAGJ,YAAY,CAAChK,QAAQ,CAACC,MAAM,CAAC,IAAI,CAAC;QAChF2K,kBAAkB,EAAElG,IAAI,CAACuE,KAAK,CAACoB,gBAAgB,GAAGL,YAAY,CAAChK,QAAQ,CAACC,MAAM,CAAC,IAAI,CAAC;QACpFuK,cAAc;QACd9D;MACF;IACF,CAAC;EACH,CAAC,CAAC,OAAOY,KAAU,EAAE;IACnBpH,OAAO,CAACoH,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;IACnD,OAAO;MACLzG,OAAO,EAAE,KAAK;MACdwG,OAAO,EAAE;IACX,CAAC;EACH;AACF,CAAC;;AAED;AACA;;AAEA;AACA,SAASO,mBAAmB,IAAIxI,aAAa;AAC7C,OAAO,MAAMyL,WAAW,GAAG,IAAIC,WAAW,CAAC,CAAC;;AAE5C;AACA,OAAO,MAAMC,uBAAuB,GAAG;EACrCC,gBAAgB,EAAExD,oBAAoB;EACtCyD,iBAAiB,EAAExD,qBAAqB;EACxCyD,UAAU,EAAExD,cAAc;EAC1ByD,UAAU,EAAExD,sBAAsB;EAClCyD,gBAAgB,EAAExB,wBAAwB;EAC1ChB,gBAAgB;EAChByC,gBAAgB,EAAE3C;AACpB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}