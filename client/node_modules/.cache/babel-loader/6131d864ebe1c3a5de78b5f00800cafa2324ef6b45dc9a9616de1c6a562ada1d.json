{"ast":null,"code":"var _jsxFileName = \"C:\\\\repo\\\\wihy_ui\\\\client\\\\src\\\\components\\\\ImageUploadModal.tsx\",\n  _s = $RefreshSig$();\n// src/components/ImageUploadModal.tsx\nimport React, { useState, useRef, useCallback } from 'react';\nimport './Spinner.css';\nimport '../styles/VHealthSearch.css';\nimport '../styles/modals.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst ImageUploadModal = ({\n  isOpen,\n  onClose,\n  onAnalysisComplete,\n  title = \"Upload Image\",\n  subtitle = \"Upload images for analysis\"\n}) => {\n  _s();\n  const [isDragging, setIsDragging] = useState(false);\n  const [imageUrl, setImageUrl] = useState('');\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [showCamera, setShowCamera] = useState(false);\n  const [stream, setStream] = useState(null);\n  const [capturedImage, setCapturedImage] = useState(null);\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const fileInputRef = useRef(null);\n\n  // Start camera\n  const startCamera = useCallback(async () => {\n    try {\n      const mediaStream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          facingMode: 'environment'\n        }\n      });\n      setStream(mediaStream);\n      setShowCamera(true);\n      if (videoRef.current) {\n        videoRef.current.srcObject = mediaStream;\n      }\n    } catch (error) {\n      console.error('Error accessing camera:', error);\n      alert('Unable to access camera. Please check permissions.');\n    }\n  }, []);\n\n  // Stop camera\n  const stopCamera = useCallback(() => {\n    if (stream) {\n      stream.getTracks().forEach(track => track.stop());\n      setStream(null);\n    }\n    setShowCamera(false);\n    setCapturedImage(null);\n  }, [stream]);\n\n  // Capture photo\n  const capturePhoto = useCallback(() => {\n    if (videoRef.current && canvasRef.current) {\n      const video = videoRef.current;\n      const canvas = canvasRef.current;\n      const context = canvas.getContext('2d');\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n      if (context) {\n        context.drawImage(video, 0, 0, canvas.width, canvas.height);\n        const imageDataUrl = canvas.toDataURL('image/jpeg');\n        setCapturedImage(imageDataUrl);\n      }\n    }\n  }, []);\n\n  // Process file and analyze it\n  const processFile = useCallback(async file => {\n    console.log('🔍 STEP 1: File received:', {\n      name: file.name,\n      type: file.type,\n      size: file.size\n    });\n    setIsProcessing(true);\n    try {\n      console.log('🔍 STEP 2: Using WiHy Scan API...');\n\n      // Import wihyAPI dynamically to avoid circular imports\n      const {\n        wihyAPI\n      } = await import('../services/wihyAPI');\n      console.log('🔍 STEP 3: Making scan API call...');\n      const result = await wihyAPI.scanFood(file);\n      console.log('🔍 STEP 4: Scan API response received:', result);\n\n      // Extract food name from the scan result using unified format\n      let foodName = 'unknown';\n\n      // Type-safe check for unified response format\n      if (result.success && 'data' in result && result.data) {\n        var _unifiedResult$data$a;\n        const unifiedResult = result; // Use any to handle type checking\n\n        // Primary: Get health advice from AI response\n        if ((_unifiedResult$data$a = unifiedResult.data.ai_response) !== null && _unifiedResult$data$a !== void 0 && _unifiedResult$data$a.response) {\n          foodName = unifiedResult.data.ai_response.response;\n          console.log('🔍 Using AI response:', foodName);\n        }\n        // Fallback: Try to get product name or other analysis\n        else if (unifiedResult.data.product_name) {\n          foodName = unifiedResult.data.product_name;\n          console.log('🔍 Using product name:', foodName);\n        } else if (unifiedResult.data.analysis) {\n          foodName = unifiedResult.data.analysis;\n          console.log('🔍 Using analysis:', foodName);\n        } else {\n          foodName = 'Food item scanned';\n          console.log('🔍 Using fallback name');\n        }\n      } else {\n        console.log('❌ No valid response data found');\n        foodName = 'Food analysis unavailable';\n      }\n      console.log('🔍 STEP 5: Extracted food name:', foodName);\n      console.log('🔍 STEP 6: Triggering analysis completion for:', foodName);\n      onAnalysisComplete(foodName);\n    } catch (error) {\n      console.error('❌ Error in processFile:', error);\n    } finally {\n      setIsProcessing(false);\n    }\n  }, [onAnalysisComplete]);\n\n  // Analyze captured image\n  const analyzeCapturedImage = useCallback(async () => {\n    if (!capturedImage) return;\n    setIsProcessing(true);\n    try {\n      // Convert data URL to blob\n      const response = await fetch(capturedImage);\n      const blob = await response.blob();\n      const file = new File([blob], 'captured-image.jpg', {\n        type: 'image/jpeg'\n      });\n      await processFile(file);\n    } catch (error) {\n      console.error('Error analyzing captured image:', error);\n      alert('Failed to analyze the captured image. Please try again.');\n    } finally {\n      setIsProcessing(false);\n    }\n  }, [capturedImage, processFile]);\n\n  // Back to upload view\n  const backToUpload = useCallback(() => {\n    stopCamera();\n  }, [stopCamera]);\n  if (!isOpen) return null;\n\n  // Handle file drop\n  const handleDrop = async e => {\n    e.preventDefault();\n    setIsDragging(false);\n    const files = Array.from(e.dataTransfer.files);\n    const imageFile = files.find(file => file.type.startsWith('image/'));\n    if (imageFile) {\n      await processFile(imageFile);\n    } else {\n      alert('Please upload an image file (JPG, PNG, GIF, etc.)');\n    }\n  };\n\n  // Handle drag events\n  const handleDragOver = e => {\n    e.preventDefault();\n    setIsDragging(true);\n  };\n  const handleDragLeave = e => {\n    e.preventDefault();\n    setIsDragging(false);\n  };\n\n  // Handle file input\n  const handleFileInput = async e => {\n    var _e$target$files;\n    console.log('📁 File input triggered');\n    const file = (_e$target$files = e.target.files) === null || _e$target$files === void 0 ? void 0 : _e$target$files[0];\n    console.log('📁 Selected file:', file);\n    if (file) {\n      await processFile(file);\n    } else {\n      console.log('❌ No file selected');\n    }\n  };\n\n  // Handle modal close\n  const handleClose = () => {\n    if (!isProcessing) {\n      onClose();\n      setImageUrl('');\n      setIsDragging(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `photo-modal-overlay ${isOpen ? 'open' : ''}`,\n    onClick: handleClose,\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"photo-modal\",\n      onClick: e => e.stopPropagation(),\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"modal-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: title\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"modal-subtitle\",\n          children: subtitle\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"modal-close\",\n          onClick: handleClose,\n          \"aria-label\": \"Close\",\n          disabled: isProcessing,\n          children: \"\\xD7\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 9\n      }, this), showCamera ?\n      /*#__PURE__*/\n      /* Camera View */\n      _jsxDEV(\"div\", {\n        className: \"camera-view\",\n        children: capturedImage ?\n        /*#__PURE__*/\n        /* Captured Image Preview */\n        _jsxDEV(\"div\", {\n          className: \"captured-image-container\",\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: capturedImage,\n            alt: \"Captured\",\n            className: \"captured-image\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 237,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"camera-controls\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"analyze-wihy-btn\",\n              onClick: analyzeCapturedImage,\n              disabled: isProcessing,\n              style: {\n                background: 'transparent',\n                border: '2px solid transparent',\n                borderRadius: '28px',\n                padding: '12px 24px',\n                color: '#1a73e8',\n                fontSize: '16px',\n                fontWeight: '600',\n                cursor: 'pointer',\n                backgroundClip: 'padding-box',\n                position: 'relative',\n                animation: 'wiH-border-sweep 2.2s linear infinite',\n                marginBottom: '12px'\n              },\n              children: isProcessing ? 'Analyzing...' : 'Analyze with WiHy'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 239,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => setCapturedImage(null),\n              style: {\n                background: '#f8f9fa',\n                border: '1px solid #ddd',\n                borderRadius: '8px',\n                padding: '8px 16px',\n                color: '#666',\n                fontSize: '14px',\n                cursor: 'pointer'\n              },\n              children: \"Retake\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 260,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: backToUpload,\n              style: {\n                background: '#f8f9fa',\n                border: '1px solid #ddd',\n                borderRadius: '8px',\n                padding: '8px 16px',\n                color: '#666',\n                fontSize: '14px',\n                cursor: 'pointer',\n                marginLeft: '8px'\n              },\n              children: \"Back to Upload\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 274,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 238,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 15\n        }, this) :\n        /*#__PURE__*/\n        /* Live Camera View */\n        _jsxDEV(\"div\", {\n          className: \"live-camera-container\",\n          children: [/*#__PURE__*/_jsxDEV(\"video\", {\n            ref: videoRef,\n            autoPlay: true,\n            playsInline: true,\n            className: \"camera-video\",\n            style: {\n              width: '100%',\n              height: '300px',\n              objectFit: 'cover',\n              borderRadius: '8px'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 294,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n            ref: canvasRef,\n            style: {\n              display: 'none'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 306,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"camera-controls\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"analyze-wihy-btn\",\n              onClick: capturePhoto,\n              style: {\n                background: 'transparent',\n                border: '2px solid transparent',\n                borderRadius: '28px',\n                padding: '16px 32px',\n                color: '#1a73e8',\n                fontSize: '18px',\n                fontWeight: '600',\n                cursor: 'pointer',\n                backgroundClip: 'padding-box',\n                position: 'relative',\n                animation: 'wiH-border-sweep 2.2s linear infinite',\n                marginBottom: '12px',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                width: '100%'\n              },\n              children: \"Capture & Analyze\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 308,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: backToUpload,\n              style: {\n                background: '#f8f9fa',\n                border: '1px solid #ddd',\n                borderRadius: '8px',\n                padding: '8px 16px',\n                color: '#666',\n                fontSize: '14px',\n                cursor: 'pointer',\n                width: '100%'\n              },\n              children: \"Back to Upload\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 332,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 307,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 293,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 11\n      }, this) :\n      /*#__PURE__*/\n      /* Upload View */\n      _jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: `upload-area ${isDragging ? 'dragging' : ''} ${isProcessing ? 'processing' : ''}`,\n          onDrop: handleDrop,\n          onDragOver: handleDragOver,\n          onDragLeave: handleDragLeave,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"upload-content\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"upload-icon\",\n              children: isProcessing ? /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"upload-spinner\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"spinner\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 365,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 364,\n                columnNumber: 21\n              }, this) : /*#__PURE__*/_jsxDEV(\"svg\", {\n                viewBox: \"0 0 24 24\",\n                fill: \"currentColor\",\n                children: /*#__PURE__*/_jsxDEV(\"path\", {\n                  d: \"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 369,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 368,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 362,\n              columnNumber: 17\n            }, this), isProcessing ? /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"upload-text\",\n              children: \"Analyzing image...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 375,\n              columnNumber: 19\n            }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"upload-text\",\n              children: [isDragging ? 'Drop image here' : 'Drag an image here or', ' ', /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"upload-link\",\n                onClick: () => {\n                  var _fileInputRef$current;\n                  return (_fileInputRef$current = fileInputRef.current) === null || _fileInputRef$current === void 0 ? void 0 : _fileInputRef$current.click();\n                },\n                disabled: isProcessing,\n                children: \"upload a file\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 379,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 377,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 361,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            ref: fileInputRef,\n            type: \"file\",\n            accept: \"image/*\",\n            style: {\n              display: 'none'\n            },\n            onChange: handleFileInput,\n            disabled: isProcessing\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 390,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 355,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            flexDirection: 'column',\n            gap: '12px',\n            marginTop: '20px',\n            marginBottom: '20px'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"analyze-wihy-btn\",\n            onClick: startCamera,\n            disabled: isProcessing,\n            style: {\n              background: 'transparent',\n              border: '2px solid transparent',\n              borderRadius: '28px',\n              padding: '16px 32px',\n              color: '#1a73e8',\n              fontSize: '18px',\n              fontWeight: '600',\n              cursor: 'pointer',\n              backgroundClip: 'padding-box',\n              position: 'relative',\n              animation: 'wiH-border-sweep 2.2s linear infinite',\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              width: '100%'\n            },\n            children: \"Use Camera\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 408,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 401,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"url-input-section\",\n          style: {\n            marginBottom: '20px'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"url\",\n            value: imageUrl,\n            onChange: e => setImageUrl(e.target.value),\n            placeholder: \"Paste image link\",\n            className: \"url-input\",\n            disabled: isProcessing,\n            style: {\n              width: '100%',\n              padding: '12px 16px',\n              borderRadius: '25px',\n              border: '1px solid #ddd',\n              fontSize: '16px',\n              marginBottom: '12px'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 436,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"analyze-wihy-btn\",\n            onClick: handleUrlUpload,\n            disabled: isProcessing || !imageUrl.trim(),\n            style: {\n              background: 'transparent',\n              border: '2px solid transparent',\n              borderRadius: '28px',\n              padding: '12px 24px',\n              color: '#1a73e8',\n              fontSize: '16px',\n              fontWeight: '600',\n              cursor: 'pointer',\n              backgroundClip: 'padding-box',\n              position: 'relative',\n              animation: 'wiH-border-sweep 2.2s linear infinite',\n              opacity: isProcessing || !imageUrl.trim() ? 0.5 : 1,\n              width: '100%'\n            },\n            children: isProcessing ? 'Analyzing...' : 'Analyze with WiHy'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 452,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 435,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"upload-info\",\n          children: /*#__PURE__*/_jsxDEV(\"small\", {\n            children: \"Supported formats: JPG, PNG, GIF, WebP (max 10MB)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 478,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 477,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 216,\n    columnNumber: 5\n  }, this);\n};\n_s(ImageUploadModal, \"vGKAD7lnBZmm+xGnXdD5pCExA+g=\");\n_c = ImageUploadModal;\nexport default ImageUploadModal;\nvar _c;\n$RefreshReg$(_c, \"ImageUploadModal\");","map":{"version":3,"names":["React","useState","useRef","useCallback","jsxDEV","_jsxDEV","Fragment","_Fragment","ImageUploadModal","isOpen","onClose","onAnalysisComplete","title","subtitle","_s","isDragging","setIsDragging","imageUrl","setImageUrl","isProcessing","setIsProcessing","showCamera","setShowCamera","stream","setStream","capturedImage","setCapturedImage","videoRef","canvasRef","fileInputRef","startCamera","mediaStream","navigator","mediaDevices","getUserMedia","video","facingMode","current","srcObject","error","console","alert","stopCamera","getTracks","forEach","track","stop","capturePhoto","canvas","context","getContext","width","videoWidth","height","videoHeight","drawImage","imageDataUrl","toDataURL","processFile","file","log","name","type","size","wihyAPI","result","scanFood","foodName","success","data","_unifiedResult$data$a","unifiedResult","ai_response","response","product_name","analysis","analyzeCapturedImage","fetch","blob","File","backToUpload","handleDrop","e","preventDefault","files","Array","from","dataTransfer","imageFile","find","startsWith","handleDragOver","handleDragLeave","handleFileInput","_e$target$files","target","handleClose","className","onClick","children","stopPropagation","fileName","_jsxFileName","lineNumber","columnNumber","disabled","src","alt","style","background","border","borderRadius","padding","color","fontSize","fontWeight","cursor","backgroundClip","position","animation","marginBottom","marginLeft","ref","autoPlay","playsInline","objectFit","display","alignItems","justifyContent","onDrop","onDragOver","onDragLeave","viewBox","fill","d","_fileInputRef$current","click","accept","onChange","flexDirection","gap","marginTop","value","placeholder","handleUrlUpload","trim","opacity","_c","$RefreshReg$"],"sources":["C:/repo/wihy_ui/client/src/components/ImageUploadModal.tsx"],"sourcesContent":["// src/components/ImageUploadModal.tsx\r\nimport React, { useState, useRef, useCallback } from 'react';\r\nimport './Spinner.css';\r\nimport '../styles/VHealthSearch.css';\r\nimport '../styles/modals.css';\r\n\r\ninterface ImageUploadModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onAnalysisComplete: (foodName: string) => void;\r\n  title?: string;\r\n  subtitle?: string;\r\n}\r\n\r\nconst ImageUploadModal: React.FC<ImageUploadModalProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  onAnalysisComplete,\r\n  title = \"Upload Image\",\r\n  subtitle = \"Upload images for analysis\"\r\n}) => {\r\n  const [isDragging, setIsDragging] = useState(false);\r\n  const [imageUrl, setImageUrl] = useState('');\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [showCamera, setShowCamera] = useState(false);\r\n  const [stream, setStream] = useState<MediaStream | null>(null);\r\n  const [capturedImage, setCapturedImage] = useState<string | null>(null);\r\n  \r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  // Start camera\r\n  const startCamera = useCallback(async () => {\r\n    try {\r\n      const mediaStream = await navigator.mediaDevices.getUserMedia({\r\n        video: { facingMode: 'environment' }\r\n      });\r\n      setStream(mediaStream);\r\n      setShowCamera(true);\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = mediaStream;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error accessing camera:', error);\r\n      alert('Unable to access camera. Please check permissions.');\r\n    }\r\n  }, []);\r\n\r\n  // Stop camera\r\n  const stopCamera = useCallback(() => {\r\n    if (stream) {\r\n      stream.getTracks().forEach(track => track.stop());\r\n      setStream(null);\r\n    }\r\n    setShowCamera(false);\r\n    setCapturedImage(null);\r\n  }, [stream]);\r\n\r\n  // Capture photo\r\n  const capturePhoto = useCallback(() => {\r\n    if (videoRef.current && canvasRef.current) {\r\n      const video = videoRef.current;\r\n      const canvas = canvasRef.current;\r\n      const context = canvas.getContext('2d');\r\n      \r\n      canvas.width = video.videoWidth;\r\n      canvas.height = video.videoHeight;\r\n      \r\n      if (context) {\r\n        context.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n        const imageDataUrl = canvas.toDataURL('image/jpeg');\r\n        setCapturedImage(imageDataUrl);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  // Process file and analyze it\r\n  const processFile = useCallback(async (file: File) => {\r\n    console.log('🔍 STEP 1: File received:', {\r\n      name: file.name,\r\n      type: file.type,\r\n      size: file.size\r\n    });\r\n    \r\n    setIsProcessing(true);\r\n    \r\n    try {\r\n      console.log('🔍 STEP 2: Using WiHy Scan API...');\r\n      \r\n      // Import wihyAPI dynamically to avoid circular imports\r\n      const { wihyAPI } = await import('../services/wihyAPI');\r\n      \r\n      console.log('🔍 STEP 3: Making scan API call...');\r\n      const result = await wihyAPI.scanFood(file);\r\n\r\n      console.log('🔍 STEP 4: Scan API response received:', result);\r\n      \r\n      // Extract food name from the scan result using unified format\r\n      let foodName = 'unknown';\r\n      \r\n      // Type-safe check for unified response format\r\n      if (result.success && 'data' in result && result.data) {\r\n        const unifiedResult = result as any; // Use any to handle type checking\r\n        \r\n        // Primary: Get health advice from AI response\r\n        if (unifiedResult.data.ai_response?.response) {\r\n          foodName = unifiedResult.data.ai_response.response;\r\n          console.log('🔍 Using AI response:', foodName);\r\n        }\r\n        // Fallback: Try to get product name or other analysis\r\n        else if (unifiedResult.data.product_name) {\r\n          foodName = unifiedResult.data.product_name;\r\n          console.log('🔍 Using product name:', foodName);\r\n        }\r\n        else if (unifiedResult.data.analysis) {\r\n          foodName = unifiedResult.data.analysis;\r\n          console.log('🔍 Using analysis:', foodName);\r\n        }\r\n        else {\r\n          foodName = 'Food item scanned';\r\n          console.log('🔍 Using fallback name');\r\n        }\r\n      } else {\r\n        console.log('❌ No valid response data found');\r\n        foodName = 'Food analysis unavailable';\r\n      }\r\n      \r\n      console.log('🔍 STEP 5: Extracted food name:', foodName);\r\n      \r\n      console.log('🔍 STEP 6: Triggering analysis completion for:', foodName);\r\n      onAnalysisComplete(foodName);\r\n      \r\n    } catch (error) {\r\n      console.error('❌ Error in processFile:', error);\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  }, [onAnalysisComplete]);\r\n\r\n  // Analyze captured image\r\n  const analyzeCapturedImage = useCallback(async () => {\r\n    if (!capturedImage) return;\r\n\r\n    setIsProcessing(true);\r\n    try {\r\n      // Convert data URL to blob\r\n      const response = await fetch(capturedImage);\r\n      const blob = await response.blob();\r\n      const file = new File([blob], 'captured-image.jpg', { type: 'image/jpeg' });\r\n      \r\n      await processFile(file);\r\n    } catch (error) {\r\n      console.error('Error analyzing captured image:', error);\r\n      alert('Failed to analyze the captured image. Please try again.');\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  }, [capturedImage, processFile]);\r\n\r\n  // Back to upload view\r\n  const backToUpload = useCallback(() => {\r\n    stopCamera();\r\n  }, [stopCamera]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  // Handle file drop\r\n  const handleDrop = async (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragging(false);\r\n    \r\n    const files = Array.from(e.dataTransfer.files);\r\n    const imageFile = files.find(file => file.type.startsWith('image/'));\r\n    \r\n    if (imageFile) {\r\n      await processFile(imageFile);\r\n    } else {\r\n      alert('Please upload an image file (JPG, PNG, GIF, etc.)');\r\n    }\r\n  };\r\n\r\n  // Handle drag events\r\n  const handleDragOver = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragging(true);\r\n  };\r\n\r\n  const handleDragLeave = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragging(false);\r\n  };\r\n\r\n  // Handle file input\r\n  const handleFileInput = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    console.log('📁 File input triggered');\r\n    const file = e.target.files?.[0];\r\n    console.log('📁 Selected file:', file);\r\n    if (file) {\r\n      await processFile(file);\r\n    } else {\r\n      console.log('❌ No file selected');\r\n    }\r\n  };\r\n\r\n  // Handle modal close\r\n  const handleClose = () => {\r\n    if (!isProcessing) {\r\n      onClose();\r\n      setImageUrl('');\r\n      setIsDragging(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`photo-modal-overlay ${isOpen ? 'open' : ''}`} onClick={handleClose}>\r\n      <div className=\"photo-modal\" onClick={(e) => e.stopPropagation()}>\r\n        <div className=\"modal-header\">\r\n          <h2>{title}</h2>\r\n          <p className=\"modal-subtitle\">{subtitle}</p>\r\n          <button \r\n            className=\"modal-close\"\r\n            onClick={handleClose}\r\n            aria-label=\"Close\"\r\n            disabled={isProcessing}\r\n          >\r\n            ×\r\n          </button>\r\n        </div>\r\n        \r\n        {showCamera ? (\r\n          /* Camera View */\r\n          <div className=\"camera-view\">\r\n            {capturedImage ? (\r\n              /* Captured Image Preview */\r\n              <div className=\"captured-image-container\">\r\n                <img src={capturedImage} alt=\"Captured\" className=\"captured-image\" />\r\n                <div className=\"camera-controls\">\r\n                  <button \r\n                    className=\"analyze-wihy-btn\"\r\n                    onClick={analyzeCapturedImage}\r\n                    disabled={isProcessing}\r\n                    style={{\r\n                      background: 'transparent',\r\n                      border: '2px solid transparent',\r\n                      borderRadius: '28px',\r\n                      padding: '12px 24px',\r\n                      color: '#1a73e8',\r\n                      fontSize: '16px',\r\n                      fontWeight: '600',\r\n                      cursor: 'pointer',\r\n                      backgroundClip: 'padding-box',\r\n                      position: 'relative',\r\n                      animation: 'wiH-border-sweep 2.2s linear infinite',\r\n                      marginBottom: '12px'\r\n                    }}\r\n                  >\r\n                    {isProcessing ? 'Analyzing...' : 'Analyze with WiHy'}\r\n                  </button>\r\n                  <button \r\n                    onClick={() => setCapturedImage(null)}\r\n                    style={{\r\n                      background: '#f8f9fa',\r\n                      border: '1px solid #ddd',\r\n                      borderRadius: '8px',\r\n                      padding: '8px 16px',\r\n                      color: '#666',\r\n                      fontSize: '14px',\r\n                      cursor: 'pointer'\r\n                    }}\r\n                  >\r\n                    Retake\r\n                  </button>\r\n                  <button \r\n                    onClick={backToUpload}\r\n                    style={{\r\n                      background: '#f8f9fa',\r\n                      border: '1px solid #ddd',\r\n                      borderRadius: '8px',\r\n                      padding: '8px 16px',\r\n                      color: '#666',\r\n                      fontSize: '14px',\r\n                      cursor: 'pointer',\r\n                      marginLeft: '8px'\r\n                    }}\r\n                  >\r\n                    Back to Upload\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              /* Live Camera View */\r\n              <div className=\"live-camera-container\">\r\n                <video \r\n                  ref={videoRef} \r\n                  autoPlay \r\n                  playsInline \r\n                  className=\"camera-video\"\r\n                  style={{\r\n                    width: '100%',\r\n                    height: '300px',\r\n                    objectFit: 'cover',\r\n                    borderRadius: '8px'\r\n                  }}\r\n                />\r\n                <canvas ref={canvasRef} style={{ display: 'none' }} />\r\n                <div className=\"camera-controls\">\r\n                  <button \r\n                    className=\"analyze-wihy-btn\"\r\n                    onClick={capturePhoto}\r\n                    style={{\r\n                      background: 'transparent',\r\n                      border: '2px solid transparent',\r\n                      borderRadius: '28px',\r\n                      padding: '16px 32px',\r\n                      color: '#1a73e8',\r\n                      fontSize: '18px',\r\n                      fontWeight: '600',\r\n                      cursor: 'pointer',\r\n                      backgroundClip: 'padding-box',\r\n                      position: 'relative',\r\n                      animation: 'wiH-border-sweep 2.2s linear infinite',\r\n                      marginBottom: '12px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      justifyContent: 'center',\r\n                      width: '100%'\r\n                    }}\r\n                  >\r\n                    Capture & Analyze\r\n                  </button>\r\n                  <button \r\n                    onClick={backToUpload}\r\n                    style={{\r\n                      background: '#f8f9fa',\r\n                      border: '1px solid #ddd',\r\n                      borderRadius: '8px',\r\n                      padding: '8px 16px',\r\n                      color: '#666',\r\n                      fontSize: '14px',\r\n                      cursor: 'pointer',\r\n                      width: '100%'\r\n                    }}\r\n                  >\r\n                    Back to Upload\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          /* Upload View */\r\n          <>\r\n            {/* Upload Area */}\r\n            <div \r\n              className={`upload-area ${isDragging ? 'dragging' : ''} ${isProcessing ? 'processing' : ''}`}\r\n              onDrop={handleDrop}\r\n              onDragOver={handleDragOver}\r\n              onDragLeave={handleDragLeave}\r\n            >\r\n              <div className=\"upload-content\">\r\n                <div className=\"upload-icon\">\r\n                  {isProcessing ? (\r\n                    <div className=\"upload-spinner\">\r\n                      <div className=\"spinner\"></div>\r\n                    </div>\r\n                  ) : (\r\n                    <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                      <path d=\"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z\"/>\r\n                    </svg>\r\n                  )}\r\n                </div>\r\n                \r\n                {isProcessing ? (\r\n                  <p className=\"upload-text\">Analyzing image...</p>\r\n                ) : (\r\n                  <p className=\"upload-text\">\r\n                    {isDragging ? 'Drop image here' : 'Drag an image here or'}{' '}\r\n                    <button \r\n                      className=\"upload-link\"\r\n                      onClick={() => fileInputRef.current?.click()}\r\n                      disabled={isProcessing}\r\n                    >\r\n                      upload a file\r\n                    </button>\r\n                  </p>\r\n                )}\r\n              </div>\r\n              \r\n              <input\r\n                ref={fileInputRef}\r\n                type=\"file\"\r\n                accept=\"image/*\"\r\n                style={{ display: 'none' }}\r\n                onChange={handleFileInput}\r\n                disabled={isProcessing}\r\n              />\r\n            </div>\r\n\r\n            {/* Button Bar */}\r\n            <div style={{ \r\n              display: 'flex', \r\n              flexDirection: 'column', \r\n              gap: '12px', \r\n              marginTop: '20px',\r\n              marginBottom: '20px'\r\n            }}>\r\n              <button \r\n                className=\"analyze-wihy-btn\"\r\n                onClick={startCamera}\r\n                disabled={isProcessing}\r\n                style={{\r\n                  background: 'transparent',\r\n                  border: '2px solid transparent',\r\n                  borderRadius: '28px',\r\n                  padding: '16px 32px',\r\n                  color: '#1a73e8',\r\n                  fontSize: '18px',\r\n                  fontWeight: '600',\r\n                  cursor: 'pointer',\r\n                  backgroundClip: 'padding-box',\r\n                  position: 'relative',\r\n                  animation: 'wiH-border-sweep 2.2s linear infinite',\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'center',\r\n                  width: '100%'\r\n                }}\r\n              >\r\n                Use Camera\r\n              </button>\r\n            </div>\r\n\r\n            {/* URL Input Section */}\r\n            <div className=\"url-input-section\" style={{ marginBottom: '20px' }}>\r\n              <input\r\n                type=\"url\"\r\n                value={imageUrl}\r\n                onChange={(e) => setImageUrl(e.target.value)}\r\n                placeholder=\"Paste image link\"\r\n                className=\"url-input\"\r\n                disabled={isProcessing}\r\n                style={{\r\n                  width: '100%',\r\n                  padding: '12px 16px',\r\n                  borderRadius: '25px',\r\n                  border: '1px solid #ddd',\r\n                  fontSize: '16px',\r\n                  marginBottom: '12px'\r\n                }}\r\n              />\r\n              <button\r\n                className=\"analyze-wihy-btn\"\r\n                onClick={handleUrlUpload}\r\n                disabled={isProcessing || !imageUrl.trim()}\r\n                style={{\r\n                  background: 'transparent',\r\n                  border: '2px solid transparent',\r\n                  borderRadius: '28px',\r\n                  padding: '12px 24px',\r\n                  color: '#1a73e8',\r\n                  fontSize: '16px',\r\n                  fontWeight: '600',\r\n                  cursor: 'pointer',\r\n                  backgroundClip: 'padding-box',\r\n                  position: 'relative',\r\n                  animation: 'wiH-border-sweep 2.2s linear infinite',\r\n                  opacity: isProcessing || !imageUrl.trim() ? 0.5 : 1,\r\n                  width: '100%'\r\n                }}\r\n              >\r\n                {isProcessing ? 'Analyzing...' : 'Analyze with WiHy'}\r\n              </button>\r\n            </div>\r\n\r\n            {/* Supported formats */}\r\n            <div className=\"upload-info\">\r\n              <small>Supported formats: JPG, PNG, GIF, WebP (max 10MB)</small>\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ImageUploadModal;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}