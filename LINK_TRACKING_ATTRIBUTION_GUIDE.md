# Link Tracking & Attribution Chain Guide

## Overview
The WIHY link tracking system monitors the complete user journey from initial source (e.g., Facebook) through wihy.ai to final destination (e.g., Kickstarter, Instagram). This enables full attribution chain analysis.

## How It Works

### Attribution Chain Flow
```
Facebook Post → wihy.ai → Kickstarter
     (1)          (2)         (3)

1. User clicks tracking link on Facebook
2. Lands on wihy.ai with ?ref=facebook_jan15 parameter
3. Clicks "Join Beta" button to go to Kickstarter
4. System tracks: Facebook → wihy.ai → Kickstarter
```

### Key Features
- **Inbound Tracking**: Captures when users arrive at wihy.ai from external sources
- **Outbound Tracking**: Monitors clicks from wihy.ai to external destinations
- **Attribution Chain**: Preserves the original source throughout the journey
- **Flexible Destinations**: Works with any URL (Kickstarter, Instagram, custom pages)

## Creating Tracking Links

### Admin Interface
1. Navigate to `/tracking-admin`
2. Enter Source ID (e.g., `facebook_post_jan15`, `instagram_influencer_jane`)
3. Enter Campaign (optional, e.g., `beta_launch`, `kickstarter`)
4. Enter Destination URL (optional, defaults to Kickstarter)
5. Click "Generate Link"
6. Copy and share the generated link

### Link Format
```
https://wihy.ai/?ref=SOURCE_ID&campaign=CAMPAIGN_NAME

Examples:
- https://wihy.ai/?ref=facebook_jan15&campaign=beta_launch
- https://wihy.ai/?ref=instagram_jane&campaign=influencer_program
- https://wihy.ai/?ref=email_newsletter&campaign=january_2024
```

### Destination Links (Generated by System)
```
https://kickstarter.com/...?ref=SOURCE_ID&utm_campaign=CAMPAIGN&utm_source=wihy&utm_medium=referral
```

## Real-World Examples

### Example 1: Facebook to Kickstarter
**Scenario**: Post WIHY link on Facebook to drive Kickstarter pledges

1. **Create Link**: 
   - Source ID: `facebook_post_jan15`
   - Campaign: `kickstarter_launch`
   - Link: `https://wihy.ai/?ref=facebook_post_jan15&campaign=kickstarter_launch`

2. **Share on Facebook**: Post the link on your Facebook page

3. **User Journey**:
   - User clicks link on Facebook
   - Lands on wihy.ai (system captures: ref=facebook_post_jan15)
   - User clicks "Join the WIHY Beta" button
   - Goes to Kickstarter (system tracks: Facebook → wihy.ai → Kickstarter)

4. **Dashboard Shows**:
   ```
   Event Type: OUTBOUND
   Source: facebook_post_jan15
   Original Source: facebook_post_jan15
   Destination: Kickstarter
   ```

### Example 2: Instagram to Instagram (Cross-Promotion)
**Scenario**: Share WIHY on Instagram Story, user explores wihy.ai, then follows WIHY Instagram

1. **Create Link**:
   - Source ID: `instagram_story_jan20`
   - Campaign: `social_media`
   - Link: `https://wihy.ai/?ref=instagram_story_jan20&campaign=social_media`

2. **Share**: Add to Instagram Story with "Swipe Up"

3. **User Journey**:
   - Swipes up on Instagram Story
   - Explores wihy.ai
   - Clicks Instagram link in footer
   - System tracks: Instagram → wihy.ai → Instagram (follow)

### Example 3: Email to Kickstarter Chain
**Scenario**: Email newsletter drives Kickstarter pledges

1. **Create Link**:
   - Source ID: `email_newsletter_jan`
   - Campaign: `january_newsletter`

2. **Send Email**: Include link in newsletter

3. **User Journey**:
   - Clicks link in email
   - Reads about WIHY on wihy.ai
   - Clicks "Join the WIHY Beta"
   - Makes Kickstarter pledge

4. **Dashboard Attribution**:
   ```
   Inbound Event:
   - Source: email_newsletter_jan
   - Landing Page: /
   
   Outbound Event:
   - Source: direct_website (current session)
   - Original Source: email_newsletter_jan ← Key insight!
   - Destination: Kickstarter
   ```

## Dashboard Analytics

### Navigation
- Admin Link Generator: `/tracking-admin`
- Analytics Dashboard: `/tracking-dashboard`

### Metrics Displayed
1. **Total Events**: Combined inbound + outbound clicks
2. **Unique Sources**: Number of different referrers
3. **Active Campaigns**: Campaigns currently tracking
4. **Recent Activity Table**: Shows complete attribution chain

### Recent Activity Columns
- **Type**: ← IN (inbound) or → OUT (outbound)
- **Source**: Direct referrer for this event
- **Original Source**: First source in the chain (e.g., Facebook)
- **Campaign**: Campaign identifier
- **Destination**: Where traffic went (for outbound) or came from (for inbound)
- **Timestamp**: When the event occurred

### Reading the Dashboard

**Inbound Event** (← IN):
```
Type: ← IN
Source: facebook_jan15
Original Source: -
Campaign: beta_launch
Destination: /about
```
*Meaning: User clicked a Facebook link and landed on /about page*

**Outbound Event** (→ OUT):
```
Type: → OUT
Source: direct_website
Original Source: facebook_jan15 →
Campaign: about_page
Destination: Kickstarter
```
*Meaning: User (who originally came from Facebook) clicked to Kickstarter*

## Technical Implementation

### Client-Side Tracking (LinkTracker.tsx)

#### Capture Inbound Traffic
```typescript
LinkTrackingService.captureTracking(location.search);
// Reads ?ref=source from URL
// Stores in sessionStorage for attribution chain
// Sends to /api/tracking/capture
```

#### Track Outbound Clicks
```typescript
LinkTrackingService.trackOutboundClick(
  userId,           // Current referrer
  destinationUrl,   // Where they're going
  campaign          // Campaign name
);
// Retrieves original source from sessionStorage
// Sends complete chain to backend
```

### Server-Side Storage (server.ts)

#### TrackingEvent Interface
```typescript
interface TrackingEvent {
  id: string;
  referrer: string;           // Direct referrer
  campaign: string;
  timestamp: string;
  landingPage: string;
  originalSource?: string;    // First source in chain
  destinationUrl?: string;    // Outbound destination
  eventType?: 'inbound' | 'outbound';
}
```

### API Endpoints

#### POST /api/tracking/capture
Captures tracking events (both inbound and outbound)

**Request**:
```json
{
  "referrer": "facebook_jan15",
  "campaign": "beta_launch",
  "timestamp": "2024-01-15T10:30:00Z",
  "landingPage": "/",
  "originalSource": "facebook_jan15",
  "eventType": "inbound"
}
```

#### GET /api/tracking/stats
Returns aggregated statistics

**Response**:
```json
{
  "totalEvents": 150,
  "byReferrer": { "facebook_jan15": 45, "instagram_jane": 32 },
  "byCampaign": { "beta_launch": 77, "social_media": 50 },
  "recent": [...]
}
```

## Use Cases by Platform

### Facebook
- **Inbound**: Share wihy.ai links on posts, stories, ads
- **Outbound**: Track which Facebook visitors convert to Kickstarter
- **Link Format**: `https://wihy.ai/?ref=facebook_POST_ID&campaign=CAMPAIGN`

### Instagram
- **Inbound**: Bio link, story swipe-ups, DM links
- **Outbound**: Track Instagram → wihy.ai → Kickstarter flow
- **Link Format**: `https://wihy.ai/?ref=instagram_INFLUENCER&campaign=CAMPAIGN`

### Email
- **Inbound**: Newsletter links, promotional emails
- **Outbound**: See which email campaigns drive conversions
- **Link Format**: `https://wihy.ai/?ref=email_CAMPAIGN&campaign=DATE`

### Partner Websites
- **Inbound**: Referral links from partner sites
- **Outbound**: Track partner-driven Kickstarter pledges
- **Link Format**: `https://wihy.ai/?ref=partner_NAME&campaign=partnership`

### Influencer Marketing
- **Inbound**: Unique link per influencer
- **Outbound**: Measure influencer → conversion rate
- **Link Format**: `https://wihy.ai/?ref=influencer_NAME&campaign=influencer_program`

## Best Practices

### Naming Conventions

#### Source IDs
- Use descriptive, lowercase, underscore-separated names
- Include platform and identifier: `facebook_post_jan15`
- For influencers: `influencer_firstname_lastname`
- For partners: `partner_company_name`
- For campaigns: `email_newsletter_month`

#### Campaigns
- Use consistent campaign names across sources
- Examples: `beta_launch`, `kickstarter_q1`, `social_media_jan`
- Helps aggregate multiple sources into one campaign view

### Tracking Strategy

1. **Test First**: Create a test link and verify it appears in dashboard
2. **Unique IDs**: Never reuse the same source ID for different campaigns
3. **Documentation**: Keep a spreadsheet of which links were shared where
4. **Regular Monitoring**: Check dashboard daily during campaigns
5. **A/B Testing**: Use different source IDs to compare messaging effectiveness

### Privacy & Compliance
- No personal data is collected
- Only tracks click events, not user identity
- No cookies required (uses sessionStorage)
- Compliant with basic privacy regulations

## Troubleshooting

### Link Not Tracking
1. Check URL has ?ref= parameter
2. Verify dashboard shows the source ID
3. Check browser console for errors
4. Ensure JavaScript is enabled

### Attribution Chain Broken
1. Verify sessionStorage not cleared between pages
2. Check that handleKickstarterClick is called on button
3. Ensure originalSource is being sent to backend

### Dashboard Empty
1. No clicks yet - share links first
2. Check API endpoint: `/api/tracking/stats`
3. Verify server.ts is running
4. Check network tab for API errors

## Future Enhancements

### Potential Improvements
- [ ] Conversion tracking (Kickstarter pledge confirmation)
- [ ] Geographic data (which regions convert best)
- [ ] Time-based analytics (best times to post)
- [ ] Export data to CSV
- [ ] Integration with Google Analytics
- [ ] Webhook notifications for high-value conversions
- [ ] A/B test different landing pages
- [ ] Persistent database storage (currently in-memory)

## Summary

The WIHY link tracking system provides comprehensive attribution chain visibility, enabling you to:

[OK] Track where visitors come from (Facebook, Instagram, email, etc.)  
[OK] Monitor where they go next (Kickstarter, social media, etc.)  
[OK] Preserve attribution through multi-step journeys  
[OK] Measure ROI for each marketing channel  
[OK] Optimize campaigns based on conversion data  

For questions or issues, check the `/tracking-dashboard` for real-time data or review this guide for setup instructions.
